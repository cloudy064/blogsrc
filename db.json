{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/favicon.jpg","path":"favicon.jpg","modified":1,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":1,"renderable":0},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/LICENSE","path":"vendors/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/README.md","path":"vendors/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/bower.json","path":"vendors/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","path":"vendors/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/bower.json","path":"vendors/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","path":"vendors/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","path":"vendors/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","path":"vendors/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","path":"vendors/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","path":"vendors/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/bower.json","path":"vendors/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","path":"vendors/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","path":"vendors/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","path":"vendors/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery/index.js","path":"vendors/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","path":"vendors/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","path":"vendors/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","path":"vendors/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","path":"vendors/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","path":"vendors/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","path":"vendors/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","path":"vendors/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","path":"vendors/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","path":"vendors/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","path":"vendors/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","path":"vendors/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","path":"vendors/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","path":"vendors/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","path":"vendors/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","path":"vendors/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","path":"vendors/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","path":"vendors/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","path":"vendors/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.js","path":"vendors/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","path":"vendors/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","path":"vendors/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","path":"vendors/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"source/favicon.jpg","hash":"70dd00d587646a479e35288a373ac532b588fb2a","modified":1529925065957},{"_id":"source/robots.txt","hash":"43b0aab7022cef694d3b47b9f8c494967e74ec36","modified":1529925065960},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1529925066055},{"_id":"themes/next/.gitignore","hash":"63d003fa46cf9665b4dab1786f9dc694812a5a79","modified":1529925066056},{"_id":"themes/next/.bowerrc","hash":"20038353db532b4c40625419d396da7359f89cbe","modified":1529925066054},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1529925066056},{"_id":"themes/next/.javascript_ignore","hash":"beb0b95736650284ceb712a162cc033847a83cd3","modified":1529925066057},{"_id":"themes/next/README.en.md","hash":"fa31bbc6dd8778b8dee469740c92b3b5b59702af","modified":1529925066059},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1529925066058},{"_id":"themes/next/_config.yml","hash":"3ff8d17f4013ca7b64d1e323f13b61ba9bf49bd5","modified":1530015080198},{"_id":"themes/next/README.md","hash":"06aaf1241e9e1619956c86d8b1397a643840a9d1","modified":1529925066060},{"_id":"themes/next/bower.json","hash":"da39b00fcdf2e7a42af412de0a4d3617cc6d7084","modified":1529925066061},{"_id":"themes/next/gulpfile.coffee","hash":"4e8c1082fa82e383494ff5b5963b7936d9c7bb2e","modified":1529925066062},{"_id":"themes/next/package.json","hash":"95eaba1607544965e432d56406bae391dd11bcbb","modified":1529925066114},{"_id":"source/categories/index.md","hash":"f2b6ff2c43fa7d697e64af4478e237cfb6ceeef1","modified":1529925065956},{"_id":"source/images/avatar.jpg","hash":"70dd00d587646a479e35288a373ac532b588fb2a","modified":1529925065959},{"_id":"source/tags/index.md","hash":"69f9ecb2237e74d41231ff8a140ec48d1189e7dc","modified":1529925065961},{"_id":"themes/next/languages/de.yml","hash":"4c3ffeb0d214c807a226dd98214958cb5483df1c","modified":1529925066063},{"_id":"themes/next/languages/default.yml","hash":"d2f6784b9c6567b64e58736e36025dbf96d863d4","modified":1529925066064},{"_id":"themes/next/languages/en.yml","hash":"df81ab6b1cf3c88ed053d3766381cd12eb659fe3","modified":1529925066064},{"_id":"themes/next/languages/fr-FR.yml","hash":"d8a40fe025fad6f42df0cf16d4be2d513769b062","modified":1529925066065},{"_id":"themes/next/languages/id.yml","hash":"19537c8bae42c4c2e7d06a64537e8dfd503b7e19","modified":1529925066066},{"_id":"themes/next/languages/ja.yml","hash":"e594aa42a33c489e4a65065659a01bb76c3c0cb5","modified":1529925066067},{"_id":"themes/next/languages/pt.yml","hash":"4c64594f477905d5d2d9ca2422f03175b7b0c617","modified":1529925066068},{"_id":"themes/next/languages/ru.yml","hash":"c3aedb94decf05a301662afc3398ab563dd9995a","modified":1529925066069},{"_id":"themes/next/languages/zh-Hans.yml","hash":"23b45e77c1846c9457b98c745a60a9461678c389","modified":1529925066070},{"_id":"themes/next/languages/zh-hk.yml","hash":"88e603eb0f3fd25c35bb37bd30372fd77bba7c46","modified":1529925066071},{"_id":"themes/next/languages/zh-tw.yml","hash":"04479b419c72b71fd34046f3fc33ebda4fe8de84","modified":1529925066072},{"_id":"themes/next/layout/_layout.swig","hash":"1138b849e1240249480849cc2b6c6d09b28207a5","modified":1529925066073},{"_id":"themes/next/layout/category.swig","hash":"58cf08388901f7549b1fca95548b2c79173aa840","modified":1529925066110},{"_id":"themes/next/layout/archive.swig","hash":"b867a08f6b43de8b5d700c84b943df55917407ae","modified":1529925066109},{"_id":"themes/next/layout/index.swig","hash":"fec0e6e8748b8d3381565dcfae5c4c8644a50247","modified":1529925066111},{"_id":"themes/next/layout/page.swig","hash":"a91e3fd7aef26e8a02e339e3372801c517f400cf","modified":1529925066112},{"_id":"themes/next/layout/tag.swig","hash":"6f764ea3ab11eeb7c530df45528d449b14f5dc62","modified":1529925066113},{"_id":"themes/next/layout/post.swig","hash":"b8334c479840b7724638eec71971cbd8512ae58d","modified":1529925066112},{"_id":"themes/next/scripts/merge-configs.js","hash":"f8cde6953939802f92da5b7a2458c6c539e9be69","modified":1529925066115},{"_id":"themes/next/test/.jshintrc","hash":"1dae9d1cf7df1ae6d5c5efd6cffb949e9b8dcebb","modified":1529925066294},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1529925066295},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1529925066296},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066221},{"_id":"source/_posts/inject/2016-07-14-remote-inject.md","hash":"3240bae50575185a26f3b095980c93275e465bd7","modified":1529925353213},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo.md","hash":"074540b523797de7a18b53381a281d3b82112986","modified":1529925382613},{"_id":"source/_posts/leetcode/2016-10-18-leetcode-chapter1.md","hash":"6cf2ab0de105302d6291d5a9903fc7c1dc200c0c","modified":1530014827138},{"_id":"source/_posts/leetcode/2018-06-26-leetcode-chapter2.md","hash":"78f494354ad0c09fccc05f2eb92401e57097f2e4","modified":1530014703446},{"_id":"source/_posts/windbg/windbg-chapter1.md","hash":"2da1f21bf8b6635c99dba7f8d8e27fef131e1db5","modified":1529925289163},{"_id":"source/_posts/windbg/windbg-chapter2.md","hash":"a94cdba4b95da5bd112e0caa46031d8cfb611611","modified":1529925289163},{"_id":"source/_posts/windbg/windbg-chapter3.md","hash":"5743290c56617a5cd9ab29bb0d6e9f14c6ff3587","modified":1529925289163},{"_id":"source/_posts/windbg/windbg-chapter4.md","hash":"ce65bcb80b33bf740ef086289d4c7a6a11500f23","modified":1529925289164},{"_id":"source/_posts/windbg/windbg-chapter5.md","hash":"5e2012e136504be20ef8538f4bd61c627ee2d96f","modified":1529925289164},{"_id":"source/_posts/windbg/windbg-extra1.md","hash":"2d4ff8aa2ddf8fdc950c292ff46e0d528d201ad8","modified":1529925289164},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"b87a5122dbff1d5fccf8f3d09d1640bd4b01c4a0","modified":1529925066074},{"_id":"themes/next/layout/_macro/post.swig","hash":"843389ec3cb4c2baa6a6a2bb916f803c89ca723b","modified":1529925066075},{"_id":"themes/next/layout/_partials/comments.swig","hash":"5d84f3938e99f1908a6a1d44dd530740625f0188","modified":1529925066078},{"_id":"themes/next/layout/_macro/reward.swig","hash":"b6cb171f0ed227b82b8f7601814af2df93f3a09a","modified":1529925066075},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"d569af20d20a960d534a5b60f90c20fef519d351","modified":1529925066077},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"9fc9f89c169439d7584197930359b758eb198a1c","modified":1529925066076},{"_id":"themes/next/layout/_partials/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1529925066079},{"_id":"themes/next/layout/_partials/footer.swig","hash":"27669118b957e8a39d843b63dddf561c9d62b336","modified":1529925066079},{"_id":"themes/next/layout/_partials/head.swig","hash":"881abebed3a7fa71827365b0ba0e84ec525eeb7f","modified":1529925066080},{"_id":"themes/next/layout/_partials/header.swig","hash":"46f8bbe51c0334c64c3a237bc0fe8ef73c6e58e1","modified":1529925066082},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1529925066084},{"_id":"themes/next/layout/_partials/search.swig","hash":"95b55fe35f2d2c22f2cc055d4379b5435314c7ec","modified":1529925066085},{"_id":"themes/next/layout/_scripts/baidu-push.swig","hash":"c5db707b46eac6a5df1d2a77f8556945a66fd181","modified":1529925066091},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1529925066092},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1529925066093},{"_id":"themes/next/layout/_scripts/lean-analytics.swig","hash":"19afa1a4a829d6b789d0b87ecb0f4dbd6dc7e5df","modified":1529925066094},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"c9d45628330ce8bf5fbe71c9f131c7d75334c1c4","modified":1529925066109},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1529925066116},{"_id":"themes/next/scripts/tags/full-image.js","hash":"86194a05a8c6499de0b2aaa525d6de135778c0ae","modified":1529925066117},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1529925066117},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1529925066223},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1529925066222},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1529925066224},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1529925066225},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1529925066226},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1529925066226},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1529925066227},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1529925066229},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1529925066230},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1529925066229},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1529925066232},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1529925066231},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1529925066233},{"_id":"themes/next/source/css/main.styl","hash":"a91dbb7ef799f0a171b5e726c801139efe545176","modified":1529925066221},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066095},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066095},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066166},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066166},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066168},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066218},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1529925066220},{"_id":"source/_posts/windbg/windbg-chapter1/aftera10.png","hash":"1ada02ab73eac1f44ba0ec418a39df240c69e3ff","modified":1529925065813},{"_id":"source/_posts/windbg/windbg-chapter1/afterda30.png","hash":"3d0dedcc0ce36204f56f048eb5d3cb1d060fccbe","modified":1529925065814},{"_id":"source/_posts/windbg/windbg-chapter1/afterrepstos.png","hash":"05c3ef6236fd3df1709317b7ec45fe2765aab5d0","modified":1529925065815},{"_id":"source/_posts/windbg/windbg-chapter1/afterrepstosmem.png","hash":"03b611c399aa0557d095cc395c86ab6b35469825","modified":1529925065816},{"_id":"source/_posts/windbg/windbg-chapter1/callstack.png","hash":"50eefeb3146b85fd799a820a265be3a67c2d194b","modified":1529925065819},{"_id":"source/_posts/windbg/windbg-chapter1/callstackstatus.png","hash":"c3f84c96ec2df1ed2b3f479a73c08b99c71acb99","modified":1529925065820},{"_id":"source/_posts/windbg/windbg-chapter1/checkesp.png","hash":"49c0949b200e1481c5e6dd21e3a70c6feb8144aa","modified":1529925065821},{"_id":"source/_posts/windbg/windbg-chapter1/disassembly.png","hash":"c2da8b2c8d8e1d519785a73811bd9f562485dbe0","modified":1529925065822},{"_id":"source/_posts/windbg/windbg-chapter1/pushebp.png","hash":"36812c0d93ef229bcfe5d3c60fcb83b3b1f296fc","modified":1529925065823},{"_id":"source/_posts/windbg/windbg-chapter1/pushebxesiedi.png","hash":"52796c4629af4238f02e714650e58975119096bf","modified":1529925065824},{"_id":"source/_posts/windbg/windbg-chapter1/pushresult.png","hash":"a82ea8c03e3f7ddf3402c8f74bda27423232f32a","modified":1529925065825},{"_id":"source/_posts/windbg/windbg-chapter1/registers.png","hash":"d786dc63787a6625967d628e610021c82c0934a8","modified":1529925065826},{"_id":"source/_posts/windbg/windbg-chapter1/testfuncsource.png","hash":"2df3ac0f708a0066f13aa991cbf0ef925b462001","modified":1529925065831},{"_id":"source/_posts/windbg/windbg-chapter1/stackmemory.png","hash":"a227d19024656d326f0c002a0d6fe12698c840e3","modified":1529925065830},{"_id":"source/_posts/windbg/windbg-chapter2/AfterCallTestReturnStack.png","hash":"397f68e6b53401e366d2337b69970ac01a2fc7e3","modified":1529925065834},{"_id":"source/_posts/windbg/windbg-chapter2/AfterCallTestReturn.png","hash":"f0011e34f593f9339908578914650d991602b80f","modified":1529925065833},{"_id":"source/_posts/windbg/windbg-chapter2/BeforeCallTestReturn.png","hash":"126fafa08b6d53a99621fdc043d03816655dc215","modified":1529925065836},{"_id":"source/_posts/windbg/windbg-chapter2/BeforeCallTestReturnStack.png","hash":"43ae7abb7e283864b5ce7fd431456b6da59f57aa","modified":1529925065837},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestConstReference.png","hash":"f563d14336e0c56b06ce97f0c48fac3931a342da","modified":1529925065838},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestPointer.png","hash":"46aa9bb532b8feb9f172f4520078659dccdecbfa","modified":1529925065839},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestReference.png","hash":"9bab798b147982a54777672ad4d0a3ddb274055b","modified":1529925065840},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestValue.png","hash":"5e38e018521a531b1dbfd34f2704270e73ace120","modified":1529925065841},{"_id":"source/_posts/windbg/windbg-chapter2/InitSimple.png","hash":"d6089453e90542c78c043f2a84163efcb0a9d5ee","modified":1529925065842},{"_id":"source/_posts/windbg/windbg-chapter2/SimpleStructMemory.png","hash":"adc869feb4f393189e9135fcf54dc99f67fbff14","modified":1529925065843},{"_id":"source/_posts/windbg/windbg-chapter2/begin.png","hash":"7bad97faeb75cc867ac0d501202e80f8ae0c029c","modified":1529925065845},{"_id":"source/_posts/windbg/windbg-chapter2/ddebp-14hL4.png","hash":"54cd5c43213ea54811453eb2c4b78b2f9576c132","modified":1529925065846},{"_id":"source/_posts/windbg/windbg-chapter3/ActualValueForCmp.png","hash":"4910955731ecc64fac00ab4deefc3941bb261c6e","modified":1529925065850},{"_id":"source/_posts/windbg/windbg-chapter2/ddebp-2ChL4.png","hash":"a63864a38e85e8aaaca0b5d395ecb287eda6bf64","modified":1529925065847},{"_id":"source/_posts/windbg/windbg-chapter2/dtHelloWorld2005Simple.png","hash":"1d5625a78957940d0d90a82187724419ca0b7170","modified":1529925065848},{"_id":"source/_posts/windbg/windbg-chapter3/AfterCmpOperation.png","hash":"2f53fcbef85a3aca2a0683e7534f0e7f9a4109e8","modified":1529925065851},{"_id":"source/_posts/windbg/windbg-chapter3/AllRegisters.png","hash":"602632016d9ff05d074efa764402b5f50bea4e7b","modified":1529925065853},{"_id":"source/_posts/windbg/windbg-chapter3/CmpResult.png","hash":"5ea7066689dc6ab06820c3a5f7437935e024843c","modified":1529925065855},{"_id":"source/_posts/windbg/windbg-chapter3/DtSimpleClass.png","hash":"6862d82767f58227926a28b2f4172b25b81ec25a","modified":1529925065857},{"_id":"source/_posts/windbg/windbg-chapter3/DynamicInitializerForK.png","hash":"bd1353400721115792407f308e6b401efc542242","modified":1529925065863},{"_id":"source/_posts/windbg/windbg-chapter3/HelloWorld2005PreCppInit.png","hash":"4e176853c602fbacc1b1b58fb8e72d26010f61c5","modified":1529925065868},{"_id":"source/_posts/windbg/windbg-chapter3/HitConstructorBreakPoint.png","hash":"c9a562342cd9ee60f220f7eb7693f6f19f1f8a4c","modified":1529925065870},{"_id":"source/_posts/windbg/windbg-chapter3/GlobalVarCallStack.png","hash":"468eb54ded2f6404d9a54c353e41358f21f66811","modified":1529925065865},{"_id":"source/_posts/windbg/windbg-chapter3/InInitTermFunction.png","hash":"7d583d2ebe4e5f8bec81b77c9ea440f07f3eec0d","modified":1529925065872},{"_id":"source/_posts/windbg/windbg-chapter3/InitTermJmpBackToFuncHead.png","hash":"6a7abf39307f969220b3675ef2d6791e52a58fd7","modified":1529925065875},{"_id":"source/_posts/windbg/windbg-chapter3/MainCallTestStatic.png","hash":"f443376ff000970af6966921a4ee03dec501b5af","modified":1529925065877},{"_id":"source/_posts/windbg/windbg-chapter3/MainCallTestVirtual.png","hash":"d78c1971b86d75437b1c57197d26b94f572374fb","modified":1529925065879},{"_id":"source/_posts/windbg/windbg-chapter3/MainSimpleClassJ=233.png","hash":"d4777dc6043400caa3bfa01b735a3f1a2e15b148","modified":1529925065884},{"_id":"source/_posts/windbg/windbg-chapter3/MainCompareTestAndTestConst.png","hash":"658221b280f7a378b667e6d24a082e8fa9620045","modified":1529925065881},{"_id":"source/_posts/windbg/windbg-chapter3/MainSimpleClassJ=233Stack.png","hash":"81c41b88d74e283b9b07ab9f538e708116dfaaf2","modified":1529925065886},{"_id":"source/_posts/windbg/windbg-chapter3/PreCppInitDtValueResult.png","hash":"b977cd122e4027e099ad6c6c5865b836b006eac4","modified":1529925065888},{"_id":"source/_posts/windbg/windbg-chapter3/PreCppInitDvResult.png","hash":"95e74a3a8b7c088069b25bee86cd4d4accecc7e4","modified":1529925065890},{"_id":"source/_posts/windbg/windbg-chapter3/SetConstructorBreakPoint.png","hash":"5457da66f7afd00a6b9a36fd27597fa4e4a4c1f8","modified":1529925065892},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassConstructorCode.png","hash":"0c342c022ec003065491cc0505ee8a719f4c23d7","modified":1529925065895},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassCopyConstructorCode.png","hash":"7ded1f16b8b8c58b7a975184b128724bb9f90fb9","modified":1529925065898},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassMemoryMap.png","hash":"b0440b7899f574132feb69d722971c50a8f8f2ef","modified":1529925065900},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassThisPointToMemory.png","hash":"a14de9b822aeb39f5ec0621ecceb588857196e77","modified":1529925065902},{"_id":"source/_posts/windbg/windbg-chapter3/TestDeriveCtorBeforeBaseCtorStackMemory.png","hash":"a83251da4635416f097d7d6fc777d3c629b0871a","modified":1529925065904},{"_id":"source/_posts/windbg/windbg-chapter3/da0040412c.png","hash":"155effd833b3b696ab2bb851b4dff806feae2875","modified":1529925065910},{"_id":"source/_posts/windbg/windbg-chapter3/dd00406000.png","hash":"1b65a703f42c9e70db292089430b7d24c456e3ae","modified":1529925065912},{"_id":"source/_posts/windbg/windbg-chapter3/lmvmHelloWorld2005.png","hash":"0485fe54fdb275434e9cb2d358e1dc957094a5d6","modified":1529925065913},{"_id":"source/_posts/windbg/windbg-chapter4/NormalFunc1Addresses.png","hash":"cebd66abd8f33d57968c21f7a588c97c323203d9","modified":1529925065923},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseContentOfVirtualTable.png","hash":"159c6502f26b3e0026b42f13ecbd423778ccdfe4","modified":1529925065927},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseLookupThis.png","hash":"d75493372b791b685915ea4ad7a1affbcf002f12","modified":1529925065929},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVcall0.png","hash":"a1491e3eca261af0dd2fa1f470ddd2379f83d186","modified":1529925065930},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVirtualFunc2Function.png","hash":"3d14e54e113998f82082f2c9b154d13e76801970","modified":1529925065932},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVirtualFunctionsAddress.png","hash":"5b3e5fe5cd20664663e0ef5c61ea3ae878802a3c","modified":1529925065933},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveAfterAssignVftable.png","hash":"240acbeb29b0f87ba289df869aec20970fe8d179","modified":1529925065934},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveVtableContent.png","hash":"03ba1be97351ee079c48796fa9799578ca2de773","modified":1529925065937},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveVirtualFunctionAddress.png","hash":"c52bb4615ffa3be44ac31baac6da375489b8a7dd","modified":1529925065936},{"_id":"source/_posts/windbg/windbg-chapter4/dtTestBase.png","hash":"ed639b060397da206d947cf7b81f0d5dd685d499","modified":1529925065938},{"_id":"source/_posts/windbg/windbg-chapter4/dtTestDerive.png","hash":"2c8b6266d22ca5dfe72e3e89e03840bf753e1bd9","modified":1529925065939},{"_id":"source/_posts/windbg/windbg-chapter5/VirtualFunc1Code.png","hash":"7257a62c809060cb5dc11c42191a830b1143fe46","modified":1529925065941},{"_id":"source/_posts/windbg/windbg-chapter5/contentofecx.png","hash":"53a968bb7e9d4bb94383bb85d22c56437c8ae63b","modified":1529925065943},{"_id":"source/_posts/windbg/windbg-chapter5/beforedconstructorstack.png","hash":"70b88edb9024f0029845715d254fbe650623a17a","modified":1529925065942},{"_id":"source/_posts/windbg/windbg-chapter5/contentofobjectd.png","hash":"8f6ffe4301d10a351fee2c195d665825371a4371","modified":1529925065944},{"_id":"source/_posts/windbg/windbg-chapter5/inderiveconstructorstack.png","hash":"010275c524c8ed55b40094e22f624cfd5c7886ce","modified":1529925065947},{"_id":"source/_posts/windbg/windbg-chapter5/linkoptions.png","hash":"a562658a18adc4841b6b51b2a0f0e3583cc0c8ec","modified":1529925065950},{"_id":"source/_posts/windbg/windbg-chapter5/superconstructor.png","hash":"cada05ee42df2b8958cab6201a041293d43eb09f","modified":1529925065951},{"_id":"source/_posts/windbg/windbg-chapter5/vbtablecontent.png","hash":"7996554836706bc5e2c59cdc533af18cf9f3e4dd","modified":1529925065952},{"_id":"source/_posts/windbg/windbg-chapter5/vsoptions.png","hash":"7d6945ed3956daffbdfe7660374c1733adfaac30","modified":1529925065953},{"_id":"source/_posts/windbg/windbg-extra1/vftables.png","hash":"2ce02a29f1fe4ab0600eb0c462aab7a08bd3140d","modified":1529925065955},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1529925066081},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"efa7efcbb575381b508f9aa0e0c53140eef72a7b","modified":1529925066086},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1529925066086},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1529925066087},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"bf8e9223a40748b2e3ef77d753a8e1dbbce8095e","modified":1529925066088},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"3fdde03f45a80f7a85097a40b40358adde618fc7","modified":1529925066089},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1529925066090},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"12684840de632eb16e53ffa863166306a756fd4f","modified":1529925066090},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1529925066095},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1529925066096},{"_id":"themes/next/layout/_scripts/third-party/analytics.swig","hash":"91c5353fcb94cc3b3f265b06ad2341734bc4c826","modified":1529925066097},{"_id":"themes/next/layout/_scripts/third-party/comments.swig","hash":"8ba01f1ac07fbca62a4b00f5a0a3a506122c1530","modified":1529925066102},{"_id":"themes/next/layout/_scripts/third-party/lean-analytics.swig","hash":"e495aed8fb36bf8015ddbd64366270a7debad2b0","modified":1529925066105},{"_id":"themes/next/layout/_scripts/third-party/localsearch.swig","hash":"5bd98c26cc188a2a30504d1330a0eaae34034db0","modified":1529925066106},{"_id":"themes/next/layout/_scripts/third-party/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1529925066108},{"_id":"themes/next/layout/_scripts/third-party/mathjax.swig","hash":"4a5c6df1579a4ca72ed17f7dbd6d16a509aa7dc8","modified":1529925066107},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1529925066165},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"a0f23e75a137d8c996c70e2059e0074f1e97a127","modified":1529925066167},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"531934ea21ef4dc9f0978512050f54834f0a6cff","modified":1529925066168},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e55265c8a8a6ae0c3c08e3509de92ee62c3cb5f6","modified":1529925066218},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"b8e3663996b39590509d843f674360872b0242ac","modified":1529925066219},{"_id":"themes/next/source/css/_variables/base.styl","hash":"a7ae72e846393493385275d934eaa78534d9834c","modified":1529925066220},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1529925066234},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"4a0da1bed19e65bd7db42421b447061bc1618710","modified":1529925066235},{"_id":"themes/next/source/js/src/motion.js","hash":"ff9ea37d05c269e3a140c4ab448af03efc4bcc76","modified":1529925066237},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1529925066236},{"_id":"themes/next/source/js/src/post-details.js","hash":"458af3b1bd7783c1950808e66cedfa9fb68bf21f","modified":1529925066237},{"_id":"themes/next/source/vendors/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1529925066255},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1529925066239},{"_id":"themes/next/source/js/src/utils.js","hash":"418d09eb4df5dcc5e8d13d7f6245b1888200b51c","modified":1529925066240},{"_id":"themes/next/source/vendors/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1529925066256},{"_id":"themes/next/source/vendors/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1529925066257},{"_id":"themes/next/source/vendors/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1529925066257},{"_id":"themes/next/source/vendors/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1529925066277},{"_id":"themes/next/source/vendors/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1529925066262},{"_id":"themes/next/source/vendors/font-awesome/.bower.json","hash":"bb093f2ac1f1305069d873a7941324c8e0de3135","modified":1529925066260},{"_id":"themes/next/source/vendors/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1529925066261},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","hash":"ed80b43dbc7e3009b2f436741b9796df8eb3be02","modified":1529925066263},{"_id":"themes/next/source/vendors/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1529925066263},{"_id":"themes/next/source/vendors/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1529925066279},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1529925066280},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1529925066281},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1529925066282},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1529925066282},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1529925066283},{"_id":"themes/next/source/vendors/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1529925066287},{"_id":"themes/next/source/vendors/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1529925066288},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1529925066292},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1529925066292},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1529925066293},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/generatesshkey.png","hash":"5dc494e498c08716c97a101f3d69d30efb56a024","modified":1529925065776},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/newrepository.png","hash":"9c8affff2b5c8774b0052efffe87bce2715082d1","modified":1529925065783},{"_id":"source/_posts/inject/2016-07-14-remote-inject/inject_result.jpg","hash":"4750899f4ad6b47b9dfde501b5f3df2c585292d1","modified":1529925065796},{"_id":"source/_posts/windbg/windbg-chapter1/runexe.png","hash":"e889da6a95c8a4f95190c9574b953d45f41a806b","modified":1529925065827},{"_id":"source/_posts/windbg/windbg-chapter2/AfterTestReturnReturn.png","hash":"c99adc229e00330c36a0fba76e062172deded407","modified":1529925065835},{"_id":"source/_posts/windbg/windbg-chapter2/TestReturnAssembly.png","hash":"b23d3a0c27c14e78cb18a79c76f5d3a2b0341459","modified":1529925065844},{"_id":"source/_posts/windbg/windbg-chapter3/DumpHelloWorldHeaders.png","hash":"ae1e86c495ac8123699131bc2d8e0325040f529a","modified":1529925065860},{"_id":"source/_posts/windbg/windbg-chapter3/s-saHelloWorld2005+4000L115C.png","hash":"623e912adaf9bfe50e062eea5d85b1ce890a93e2","modified":1529925065915},{"_id":"source/_posts/windbg/windbg-chapter4/FirstClassVariable.png","hash":"fc2e9b05cd0b4e323fa197cb80aefa37096a38ae","modified":1529925065922},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseConstructor.png","hash":"37dcc69daf58f92ef959cb6e37c922ab51561d17","modified":1529925065925},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseInitSequence.png","hash":"7e30f9c83fbf07a8095d326efe5e3caf94a7673d","modified":1529925065928},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveConstructor.png","hash":"896876b7772b1ac7d422af6b5b381e1629a4191e","modified":1529925065935},{"_id":"source/_posts/windbg/windbg-chapter5/firststep.png","hash":"7d2580b88bea62394d61e62554d17ecf49ae06db","modified":1529925065945},{"_id":"source/_posts/windbg/windbg-chapter5/inderiveconstructor.png","hash":"fdc498333797c986f58ba39b8e20455557ba2311","modified":1529925065946},{"_id":"source/_posts/windbg/windbg-chapter5/jumpoversupercall.png","hash":"50d697d65b42a72cd7a75e8606dca0fc2af2b609","modified":1529925065949},{"_id":"themes/next/source/vendors/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1529925066278},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/getrepositoryaddress.png","hash":"5b7b74324538a911ca23b5d188adc98fc0d1ffef","modified":1529925065779},{"_id":"source/_posts/inject/2016-07-14-remote-inject/explorer_kernel32_address.jpg","hash":"cb96086bc275354a80237ae8b48757d28525de31","modified":1529925065794},{"_id":"source/_posts/windbg/windbg-chapter1/breakpoint.png","hash":"95410b677e4bc49085e7d62fd73adcb16e1d852e","modified":1529925065818},{"_id":"source/_posts/windbg/windbg-chapter1/sourcemode.png","hash":"9ee0b512b2b187af4e3ed85be6d2082e8f16e773","modified":1529925065829},{"_id":"source/_posts/windbg/windbg-chapter3/ThePlaceWhereCallMain.png","hash":"8718f5e21771bf1e2cb7bc0e2e02513c9aa4d1fa","modified":1529925065908},{"_id":"source/_posts/windbg/windbg-chapter4/AssignMemberFuncPointer.png","hash":"489ce2eb63e21a9dc14a8b71f585538b030443fd","modified":1529925065920},{"_id":"themes/next/layout/_scripts/third-party/analytics/busuanzi-counter.swig","hash":"24105e62d7f26946907fa14cd02589f899bf8122","modified":1529925066099},{"_id":"themes/next/layout/_scripts/third-party/analytics/baidu-analytics.swig","hash":"ae5b8597603d4e42ee66ed121544e7b1c644767e","modified":1529925066098},{"_id":"themes/next/layout/_scripts/third-party/analytics/cnzz-analytics.swig","hash":"3931f9c3bac3970a3f54c9d0072ae4c950aa176c","modified":1529925066099},{"_id":"themes/next/layout/_scripts/third-party/analytics/facebook-sdk.swig","hash":"a79e7e0d809fcf407593dd7ed9e023db21c3cbd6","modified":1529925066100},{"_id":"themes/next/layout/_scripts/third-party/analytics/google-analytics.swig","hash":"1b6af02fd0ba3f729675cd95429a0cea4aebf358","modified":1529925066101},{"_id":"themes/next/layout/_scripts/third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1529925066102},{"_id":"themes/next/layout/_scripts/third-party/comments/disqus.swig","hash":"f8b6a3017ab79057ce99f1ccb512193d67f4a35f","modified":1529925066103},{"_id":"themes/next/layout/_scripts/third-party/comments/duoshuo.swig","hash":"2338be12ffee58bc08197cb9da8aaf31737aaf5c","modified":1529925066104},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"ad69cbf94eedacc27e756cdb9c7073416db697d0","modified":1529925066119},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"22828f5141c0cecb9ef25a110e194cdfa3a36423","modified":1529925066120},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1529925066121},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"b7d5cc29586ac796a50d90974ad99d24a5982137","modified":1529925066121},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"88559b13ce94311405b170a0506ded91273beceb","modified":1529925066132},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1529925066150},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1529925066159},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"5a35aa0381b0e1d465b952a997194441020446ea","modified":1529925066160},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"b6ee5fefa6046086a76ddbcfafc82482816fa3e0","modified":1529925066161},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"c9218b48c56e52c06af9ce3cc8fbdae737cf16fe","modified":1529925066163},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1529925066162},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1529925066164},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1529925066170},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1529925066172},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"55b44e03054cd20ed8129bf986b15fba5fd85aad","modified":1529925066176},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1529925066171},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"26666c1f472bf5f3fb9bc62081cca22b4de15ccb","modified":1529925066175},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1529925066177},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9b913b73d31d21f057f97115ffab93cfa578b884","modified":1529925066203},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1529925066208},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"124b540f059fd1ed13514362007cfc70355278c6","modified":1529925066207},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"13af2fb21fabfc4df4b577ce5363e13d03daff71","modified":1529925066208},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1529925066209},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c9875c010bebd77b4f59d459a10455fceb0a66a1","modified":1529925066212},{"_id":"themes/next/source/css/_schemes/Pisces/_full-image.styl","hash":"de31e923bf5102498f06b1ae6bdf2ea22409f3e0","modified":1529925066213},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1529925066210},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"2182a6da3434a6fd4d03ab1592c645d3d3c88500","modified":1529925066213},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"9887bd3894db5394c1e64e800afaae55f47e8dd0","modified":1529925066215},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1529925066216},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"983c0723e8cfd84b67c2e66da0c26425a8db06e0","modified":1529925066216},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"88a5e0e95f93e4adb196bff1aac17d6cfb03768a","modified":1529925066217},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"a9d064d600ee35acd66508167e1ac8c6cfdbdcd8","modified":1529925066238},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1529925066242},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1529925066243},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1529925066243},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1529925066244},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1529925066245},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1529925066246},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1529925066252},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1529925066259},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1529925066253},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1529925066254},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1529925066259},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","hash":"811432ad1e2d6c1f6da9a63fd919bf2a02b71dd9","modified":1529925066265},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1529925066265},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","hash":"4c2c5f5f6cc86d775a44b944661e038b7be98149","modified":1529925066266},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","hash":"574ea2698c03ae9477db2ea3baf460ee32f1a7ea","modified":1529925066276},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1529925066285},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1529925066285},{"_id":"source/_posts/inject/2016-07-14-remote-inject/devenv_kernel32_address.jpg","hash":"5c4f5bfd76a80109ca87306db24110756130d754","modified":1529925065790},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","hash":"0112e96f327d413938d37c1693806f468ffdbace","modified":1529925066269},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","hash":"b3c2f08e73320135b69c23a3908b87a12053a2f6","modified":1529925066270},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","hash":"507970402e328b2baeb05bde73bf9ded4e2c3a2d","modified":1529925066274},{"_id":"themes/next/source/vendors/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1529925066291},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1529925066124},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"53cde051e0337f4bf42fb8d6d7a79fa3fa6d4ef2","modified":1529925066123},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"852fd77500bda2c1a6651a14aa48d7d6222adc9d","modified":1529925066125},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1529925066126},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1529925066126},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"70ec8d38d2b3ee1906793d1dcb68032adfa65f03","modified":1529925066128},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"4c4ef6e997d0c6e21de39c2daa0c768e12c8c6fa","modified":1529925066122},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"104b5c79cd891506e0beaf938b083685f1da8637","modified":1529925066130},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"12e366f04497e3f44388fd40111a03e02f7c26af","modified":1529925066129},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"a45f5fce643eec4e1b927165229d560364bcace1","modified":1529925066133},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1529925066130},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"b8f9c95702e87fd0b170ab586c82c9718a245f8a","modified":1529925066131},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1529925066132},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1529925066134},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"4866fb9453d7d4c83a1c4e55d74e4afed336eb8b","modified":1529925066135},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1529925066136},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"ca20affaeaf33c0904cb6356864fc6b78e95f447","modified":1529925066137},{"_id":"themes/next/source/css/_common/components/post/post-more-link.styl","hash":"2bc3e33fdfbcf348c96ca60598f629dcd7ba3617","modified":1529925066138},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"8355b0e9375b3245508efda0e18acd069c2aa767","modified":1529925066139},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"929fac3a505bacbce6ba63009fd15851e2a8669d","modified":1529925066138},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1529925066140},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"350469437b20ecfd6f3ca45e400478f8e3f71cfb","modified":1529925066141},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1529925066142},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"681b7c8ce4dc47130a0ca67c1ec62be7c96e4c4f","modified":1529925066142},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"7f2bdd6109614d35408ee5ac3335aad4464c69c7","modified":1529925066143},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1529925066144},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"821991c0890966a512b43e8b1cf9537e738a09a0","modified":1529925066145},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1529925066146},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1529925066146},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"06b9a99d63b4d57fdbf70b88ab7036fbc47e3f52","modified":1529925066148},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"394888efec32749b353292a59ec7f1b609d6325e","modified":1529925066147},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"702be9e57dd6ff5fa99642a1f6e3df26215b8805","modified":1529925066149},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1529925066150},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1529925066155},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"7f7e9df15148608a9c29326dd880d8e8e8efc0ec","modified":1529925066155},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1529925066156},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1529925066157},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"7bd182d918f3117335a5ee87a1b544e6d2b54d7d","modified":1529925066158},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"dcb4548d07cbb38b645b1753cf3ee7157e16921a","modified":1529925066158},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1529925066151},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"dd941824210733588841897457e0cc9697ca5608","modified":1529925066152},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"a83f493e494f5c73fab8f6f5b686ef1670490095","modified":1529925066154},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1529925066153},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1529925066205},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"cf900c5026ab36f31118317d0ae32a213e3ec2a9","modified":1529925066206},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"cf900c5026ab36f31118317d0ae32a213e3ec2a9","modified":1529925066211},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1529925066247},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1529925066248},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1529925066249},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1529925066249},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1529925066250},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1529925066251},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","hash":"27cf1f2ec59aece6938c7bb2feb0e287ea778ff9","modified":1529925066273},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","hash":"f346b8b3df147e4059e1a7d66c52c9a6e1cec3e8","modified":1529925066272}],"Category":[{"name":"Windows","_id":"cjivnhtn400042guswa4m4mh6"},{"name":"blog","_id":"cjivnhtnd00092gus234jbe21"},{"name":"leetcode","_id":"cjivnhtni000e2gusz775x9pl"},{"name":"windbg","_id":"cjivnhtnw000l2gusevcup6jm"}],"Data":[],"Page":[{"title":"categories","date":"2016-06-19T15:56:53.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-06-19 23:56:53\ntype: \"categories\"\ncomments: false\n---\n","updated":"2018-06-25T11:11:05.956Z","path":"categories/index.html","layout":"page","_id":"cjivnhtlx00002guskupfntbj","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2016-06-19T15:55:45.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-06-19 23:55:45\ntype: \"tags\"\ncomments: false\n---\n","updated":"2018-06-25T11:11:05.961Z","path":"tags/index.html","layout":"page","_id":"cjivnhtm000012gusetjgeg82","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"064","date":"2016-07-13T16:58:16.000Z","_content":"\n## \nWindowsWindowsWindows\n\n`Windows Native API``STL`[github](https://github.com/cloudy064/BlogCodes.git)\n<!-- more -->\n\n## \n\n\n\n1. WindowsAPI:`SetWindowsHookEx`\n2. \n3. \n\ndll\n\n\n1. \n2. dll\n3. dll`LoadLibrary`\n\ndll\n\n`Hello World`\n```cpp\nint main()\n{\n    system(\"pause\"); //\n}\n```\n\ndll\n```cpp\nBOOL APIENTRY DllMain( HMODULE hModule,\n                       DWORD  ul_reason_for_call,\n                       LPVOID lpReserved\n                     )\n{\n    switch (ul_reason_for_call)\n    {\n    case DLL_PROCESS_ATTACH:\n        printf(\"i am injected\");\n        break;\n    case DLL_THREAD_ATTACH:\n    case DLL_THREAD_DETACH:\n    case DLL_PROCESS_DETACH:\n        break;\n    }\n    return TRUE;\n}\n```\n\n\n\n## \n`API`:\n\n### \n`API`:\n```cpp\nHANDLE\nWINAPI\nCreateRemoteThread(\n    _In_ HANDLE hProcess,\n    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,\n    _In_ SIZE_T dwStackSize,\n    _In_ LPTHREAD_START_ROUTINE lpStartAddress,\n    _In_opt_ LPVOID lpParameter,\n    _In_ DWORD dwCreationFlags,\n    _Out_opt_ LPDWORD lpThreadId\n    );\n```\n\n`MSDN`\n1. hProcess: `OpenProcess``MSDN`\n> The handle must have the PROCESS_CREATE_THREAD, PROCESS_QUERY_INFORMATION, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, and PROCESS_VM_READ access rights, and may fail without these rights on certain platforms.\n   `OpenProcess``CreateRemoteThread`\n2. lpStartAddress: 320~4G`0x23333333``A``0x23333333``B``API`:`VirtualAllocEx`\n3. lpParameter: `lpStartAddress``CreateThread`\n\n\n```cpp\nint main()\n{\n    HANDLE hProcess = ::OpenProcess(\n        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,\n        FALSE,\n        6916/*ID*/\n    );\n\n    if (hProcess == NULL)\n    {\n        return -1;\n    }\n\n    HANDLE hThread = ::CreateRemoteThread(\n        hProcess,\n        NULL,\n        0,\n        /**/,\n        /**/,\n        0,\n        NULL\n    );\n\n    if (hThread == NULL)\n    {\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    ::WaitForSingleObject(hThread, INFINITE); //\n\n    ::CloseHandle(hThread);\n    ::CloseHandle(hProcess);\n\n    return 0;\n}\n```\n\n\n\n### LoadLibrary\n[ProcExp](https://technet.microsoft.com/en-us/sysinternals/bb896653/)`kernel32.dll`\n{% asset_img explorer_kernel32_address.jpg Explorer.exekernel32 %}\n{% asset_img devenv_kernel32_address.jpg VSkernel32 %}\n\n`kernel32.dll``LoadLibraryW``kernel32.dll``LoadLibraryW``LoadLibraryW`\n\n`LoadLibraryW`\n```cpp\nHMODULE hKnl = ::LoadLibraryW(L\"kernel32.dll\");\nif (hKnl == NULL)\n{\n    return -1;\n}\n\nLPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, \"LoadLibraryW\");\nif (pLoadLibrary == NULL)\n{\n    return -1;\n}\n```\n\n### \n`LoadLibraryW`dll`API`:\n```cpp\nLPVOID\nWINAPI\nVirtualAllocEx(\n    _In_ HANDLE hProcess,\n    _In_opt_ LPVOID lpAddress,\n    _In_ SIZE_T dwSize,\n    _In_ DWORD flAllocationType,\n    _In_ DWORD flProtect\n    );\n```\n\n0\n1. hProcess: \n2. lpAddress: NULL\n3. dwSize: \n4. flAllocationType: `MEM_COMMIT`\n5. flProtect: `PAGE_READWRITE`\n\n`API`:\n```cpp\nBOOL\nWINAPI\nWriteProcessMemory(\n    _In_ HANDLE hProcess,\n    _In_ LPVOID lpBaseAddress,\n    _In_reads_bytes_(nSize) LPCVOID lpBuffer,\n    _In_ SIZE_T nSize,\n    _Out_opt_ SIZE_T * lpNumberOfBytesWritten\n    );\n```\n\n`dll``D:\\RemoteInjectDll.dll`:\n```cpp\nLPCWSTR lpszDllPath = LR\"(D:\\RemoteInjectDll.dll)\";\nSIZE_T dwMemSize = static_cast<SIZE_T>((wcslen(lpszDllPath) + 1) * sizeof(WCHAR));\nLPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, NULL, dwMemSize, MEM_COMMIT, PAGE_READWRITE);\nif (lpRemoteMemory == NULL)\n{\n    return -1;\n}\n\nSIZE_T sizeWritten = 0;\nif (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &sizeWritten))\n{\n    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n    return -1;\n}\n\n//...\n\n::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n```\n\n## \n\n```cpp\n// RemoteInjectExe.cpp : Defines the entry point for the console application.\n//\n\nint main()\n{\n    HANDLE hProcess = ::OpenProcess(\n        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,\n        FALSE,\n        6916\n    );\n\n    if (hProcess == NULL)\n    {\n        return -1;\n    }\n\n    LPCWSTR lpszDllPath = LR\"(D:\\workspaces\\c++\\RemoteInjectExe\\Debug\\RemoteInjectDll.dll)\"; //\n    SIZE_T dwMemSize = static_cast<SIZE_T>((wcslen(lpszDllPath) + 1) * sizeof(WCHAR));\n    LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, NULL, dwMemSize, MEM_COMMIT, PAGE_READWRITE);\n\n    if (lpRemoteMemory == NULL)\n    {\n        return -1;\n    }\n\n    SIZE_T sizeWritten = 0;\n    if (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &sizeWritten))\n    {\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    HMODULE hKnl = ::LoadLibraryW(L\"kernel32.dll\");\n    if (hKnl == NULL)\n    {\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, \"LoadLibraryW\");\n    if (pLoadLibrary == NULL)\n    {\n        ::FreeLibrary(hKnl);\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    DWORD dwThreadId;\n    HANDLE hThread = ::CreateRemoteThread(\n        hProcess,\n        NULL,\n        0,\n        pLoadLibrary,\n        lpRemoteMemory,\n        0,\n        &dwThreadId);\n\n    if (hThread == NULL)\n    {\n        ::FreeLibrary(hKnl);\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    ::WaitForSingleObject(hThread, INFINITE);\n\n    ::FreeLibrary(hKnl);\n    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n    ::CloseHandle(hProcess);\n    return 0;\n}\n```\n\n## \n`HelloWorld.exe``OpenProcess``HelloWorld.exe`ID\n{% asset_img inject_result.png  %}\n\n`API`\n\n## \n1. `C++`main\n```cpp\nclass ScopeHandle\n{\npublic:\n    ScopeHandle(HANDLE h)\n        : m_h(h)\n    {\n\n    }\n\n    ScopeHandle(const ScopeHandle&) = delete;\n    \n    ~ScopeHandle()\n    {\n        Close();\n    }\n\npublic:\n    void Attach(HANDLE h)\n    {\n        Close();\n        m_h = h;\n    }\n\n    HANDLE Detach()\n    {\n        HANDLE h = m_h;\n        m_h = NULL;\n        return h;\n    }\n\npublic:\n    operator HANDLE()\n    {\n        return m_h;\n    }\n\n    ScopeHandle& operator=(HANDLE h)\n    {\n        Close();\n        m_h = h;\n        return (*this);\n    }\n\n    ScopeHandle& operator=(const ScopeHandle&) = delete;\n\nprivate:\n    void Close()\n    {\n        if (m_h != NULL || m_h != INVALID_HANDLE_VALUE)\n        {\n            ::CloseHandle(m_h);\n            m_h = NULL;\n        }\n    }\n\nprivate:\n    HANDLE m_h;\n};\n\nclass ScopeVirtualMemoryEx\n{\npublic:\n    ScopeVirtualMemoryEx(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n        : m_lpMemory(lpMemory)\n        , m_hProcess(hProcess)\n        , m_memSize(memSize)\n    {\n\n    }\n\n    ScopeVirtualMemoryEx(const ScopeVirtualMemoryEx&) = delete;\n\n    ~ScopeVirtualMemoryEx()\n    {\n        Close();\n    }\n\npublic:\n    void Attach(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n    {\n        Close();\n        m_lpMemory = lpMemory;\n        m_hProcess = hProcess;\n        m_memSize = memSize;\n    }\n\n    LPVOID Detach()\n    {\n        LPVOID lpMemory = m_lpMemory;\n        Close();\n\n        return lpMemory;\n    }\n\npublic:\n    operator LPVOID()\n    {\n        return m_lpMemory;\n    }\n\n    ScopeVirtualMemoryEx& operator=(const ScopeVirtualMemoryEx&) = delete;\n\nprivate:\n    void Close()\n    {\n        if (m_lpMemory == NULL)\n        {\n            return;\n        }\n\n        if (m_hProcess == NULL)\n        {\n            return;\n        }\n\n        ::VirtualFreeEx(m_hProcess, m_lpMemory, m_memSize, MEM_RELEASE);\n\n        m_hProcess = NULL;\n        m_lpMemory = NULL;\n        m_memSize = 0;\n    }\n\nprivate:\n    LPVOID m_lpMemory;\n    HANDLE m_hProcess;\n    SIZE_T m_memSize;\n};\n```\n\n20100\n\n10100\n\n\n1. \n2. \n\n`AutoReleaseObject`unix:\n```cpp\ntemplate <typename T>\nclass AutoReleaseDelegate\n{\npublic:\n    AutoReleaseDelegate(T obj)\n        : m_obj(obj)\n    {\n\n    }\n\n    virtual ~AutoReleaseDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const = 0;\n    virtual void Release() = 0;\n\npublic:\n    operator T()\n    {\n        return m_obj;\n    }\n\nprotected:\n    T m_obj;\n};\n\nclass HandleDelegate\n    : public AutoReleaseDelegate<HANDLE>\n{\n    using super = AutoReleaseDelegate<HANDLE>;\n\npublic:\n    HandleDelegate(HANDLE h)\n        : AutoReleaseDelegate(h)\n    {\n\n    }\n\n    ~HandleDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const override\n    {\n        return (super::m_obj != NULL);\n    }\n\n    virtual void Release() override\n    {\n        ::CloseHandle(super::m_obj);\n        super::m_obj = NULL;\n    }\n};\n\nclass VirtualMemoryExDelegate\n    : public AutoReleaseDelegate<LPVOID>\n{\n    using super = AutoReleaseDelegate<LPVOID>;\n\npublic:\n    VirtualMemoryExDelegate(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n        : AutoReleaseDelegate(lpMemory)\n        , m_hProcess(hProcess)\n        , m_memSize(memSize)\n    {\n\n    }\n\n    ~VirtualMemoryExDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const override\n    {\n        if (super::m_obj == NULL)\n            return false;\n\n        if (m_hProcess == NULL)\n            return false;\n\n        return true;\n    }\n\n    virtual void Release() override\n    {\n        ::VirtualFreeEx(m_hProcess, super::m_obj, m_memSize, MEM_RELEASE);\n        m_hProcess = NULL;\n        super::m_obj = NULL;\n        m_memSize = 0;\n    }\n\nprivate:\n    HANDLE m_hProcess;\n    SIZE_T m_memSize;\n};\n\ntemplate <typename T>\nclass AutoReleaseObj\n{\n    using DelegateType = AutoReleaseDelegate<T>;\n\npublic:\n    AutoReleaseObj(DelegateType* pDelegate)\n        : m_pDelegate(pDelegate)\n    {\n\n    }\n    \n    AutoReleaseObj(const AutoReleaseObj&) = delete;\n\n    ~AutoReleaseObj()\n    {\n        assert(m_pDelegate != nullptr);\n        if (m_pDelegate->Validate())\n        {\n            m_pDelegate->Release();\n        }\n    }\n\npublic:\n    operator T()\n    {\n        assert(m_pDelegate != nullptr);\n        return T(*m_pDelegate);\n    }\n\n    AutoReleaseObj<T>& operator=(AutoReleaseObj<T>& rhs) = delete;\n\nprivate:\n    DelegateType* m_pDelegate;\n};\n```\n\n`AutoRelease``AutoReleaseDelegate``AutoReleaseObj`\n\n\n\n`ATL``ATL``CHandle``HANDLE`\n","source":"_posts/inject/2016-07-14-remote-inject.md","raw":"---\ntitle: 064\ndate: 2016-07-14 00:58:16\ncategories: Windows\ntags: [windows,c++,inject]\n---\n\n## \nWindowsWindowsWindows\n\n`Windows Native API``STL`[github](https://github.com/cloudy064/BlogCodes.git)\n<!-- more -->\n\n## \n\n\n\n1. WindowsAPI:`SetWindowsHookEx`\n2. \n3. \n\ndll\n\n\n1. \n2. dll\n3. dll`LoadLibrary`\n\ndll\n\n`Hello World`\n```cpp\nint main()\n{\n    system(\"pause\"); //\n}\n```\n\ndll\n```cpp\nBOOL APIENTRY DllMain( HMODULE hModule,\n                       DWORD  ul_reason_for_call,\n                       LPVOID lpReserved\n                     )\n{\n    switch (ul_reason_for_call)\n    {\n    case DLL_PROCESS_ATTACH:\n        printf(\"i am injected\");\n        break;\n    case DLL_THREAD_ATTACH:\n    case DLL_THREAD_DETACH:\n    case DLL_PROCESS_DETACH:\n        break;\n    }\n    return TRUE;\n}\n```\n\n\n\n## \n`API`:\n\n### \n`API`:\n```cpp\nHANDLE\nWINAPI\nCreateRemoteThread(\n    _In_ HANDLE hProcess,\n    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,\n    _In_ SIZE_T dwStackSize,\n    _In_ LPTHREAD_START_ROUTINE lpStartAddress,\n    _In_opt_ LPVOID lpParameter,\n    _In_ DWORD dwCreationFlags,\n    _Out_opt_ LPDWORD lpThreadId\n    );\n```\n\n`MSDN`\n1. hProcess: `OpenProcess``MSDN`\n> The handle must have the PROCESS_CREATE_THREAD, PROCESS_QUERY_INFORMATION, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, and PROCESS_VM_READ access rights, and may fail without these rights on certain platforms.\n   `OpenProcess``CreateRemoteThread`\n2. lpStartAddress: 320~4G`0x23333333``A``0x23333333``B``API`:`VirtualAllocEx`\n3. lpParameter: `lpStartAddress``CreateThread`\n\n\n```cpp\nint main()\n{\n    HANDLE hProcess = ::OpenProcess(\n        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,\n        FALSE,\n        6916/*ID*/\n    );\n\n    if (hProcess == NULL)\n    {\n        return -1;\n    }\n\n    HANDLE hThread = ::CreateRemoteThread(\n        hProcess,\n        NULL,\n        0,\n        /**/,\n        /**/,\n        0,\n        NULL\n    );\n\n    if (hThread == NULL)\n    {\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    ::WaitForSingleObject(hThread, INFINITE); //\n\n    ::CloseHandle(hThread);\n    ::CloseHandle(hProcess);\n\n    return 0;\n}\n```\n\n\n\n### LoadLibrary\n[ProcExp](https://technet.microsoft.com/en-us/sysinternals/bb896653/)`kernel32.dll`\n{% asset_img explorer_kernel32_address.jpg Explorer.exekernel32 %}\n{% asset_img devenv_kernel32_address.jpg VSkernel32 %}\n\n`kernel32.dll``LoadLibraryW``kernel32.dll``LoadLibraryW``LoadLibraryW`\n\n`LoadLibraryW`\n```cpp\nHMODULE hKnl = ::LoadLibraryW(L\"kernel32.dll\");\nif (hKnl == NULL)\n{\n    return -1;\n}\n\nLPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, \"LoadLibraryW\");\nif (pLoadLibrary == NULL)\n{\n    return -1;\n}\n```\n\n### \n`LoadLibraryW`dll`API`:\n```cpp\nLPVOID\nWINAPI\nVirtualAllocEx(\n    _In_ HANDLE hProcess,\n    _In_opt_ LPVOID lpAddress,\n    _In_ SIZE_T dwSize,\n    _In_ DWORD flAllocationType,\n    _In_ DWORD flProtect\n    );\n```\n\n0\n1. hProcess: \n2. lpAddress: NULL\n3. dwSize: \n4. flAllocationType: `MEM_COMMIT`\n5. flProtect: `PAGE_READWRITE`\n\n`API`:\n```cpp\nBOOL\nWINAPI\nWriteProcessMemory(\n    _In_ HANDLE hProcess,\n    _In_ LPVOID lpBaseAddress,\n    _In_reads_bytes_(nSize) LPCVOID lpBuffer,\n    _In_ SIZE_T nSize,\n    _Out_opt_ SIZE_T * lpNumberOfBytesWritten\n    );\n```\n\n`dll``D:\\RemoteInjectDll.dll`:\n```cpp\nLPCWSTR lpszDllPath = LR\"(D:\\RemoteInjectDll.dll)\";\nSIZE_T dwMemSize = static_cast<SIZE_T>((wcslen(lpszDllPath) + 1) * sizeof(WCHAR));\nLPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, NULL, dwMemSize, MEM_COMMIT, PAGE_READWRITE);\nif (lpRemoteMemory == NULL)\n{\n    return -1;\n}\n\nSIZE_T sizeWritten = 0;\nif (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &sizeWritten))\n{\n    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n    return -1;\n}\n\n//...\n\n::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n```\n\n## \n\n```cpp\n// RemoteInjectExe.cpp : Defines the entry point for the console application.\n//\n\nint main()\n{\n    HANDLE hProcess = ::OpenProcess(\n        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,\n        FALSE,\n        6916\n    );\n\n    if (hProcess == NULL)\n    {\n        return -1;\n    }\n\n    LPCWSTR lpszDllPath = LR\"(D:\\workspaces\\c++\\RemoteInjectExe\\Debug\\RemoteInjectDll.dll)\"; //\n    SIZE_T dwMemSize = static_cast<SIZE_T>((wcslen(lpszDllPath) + 1) * sizeof(WCHAR));\n    LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, NULL, dwMemSize, MEM_COMMIT, PAGE_READWRITE);\n\n    if (lpRemoteMemory == NULL)\n    {\n        return -1;\n    }\n\n    SIZE_T sizeWritten = 0;\n    if (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &sizeWritten))\n    {\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    HMODULE hKnl = ::LoadLibraryW(L\"kernel32.dll\");\n    if (hKnl == NULL)\n    {\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, \"LoadLibraryW\");\n    if (pLoadLibrary == NULL)\n    {\n        ::FreeLibrary(hKnl);\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    DWORD dwThreadId;\n    HANDLE hThread = ::CreateRemoteThread(\n        hProcess,\n        NULL,\n        0,\n        pLoadLibrary,\n        lpRemoteMemory,\n        0,\n        &dwThreadId);\n\n    if (hThread == NULL)\n    {\n        ::FreeLibrary(hKnl);\n        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n        ::CloseHandle(hProcess);\n        return -1;\n    }\n\n    ::WaitForSingleObject(hThread, INFINITE);\n\n    ::FreeLibrary(hKnl);\n    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);\n    ::CloseHandle(hProcess);\n    return 0;\n}\n```\n\n## \n`HelloWorld.exe``OpenProcess``HelloWorld.exe`ID\n{% asset_img inject_result.png  %}\n\n`API`\n\n## \n1. `C++`main\n```cpp\nclass ScopeHandle\n{\npublic:\n    ScopeHandle(HANDLE h)\n        : m_h(h)\n    {\n\n    }\n\n    ScopeHandle(const ScopeHandle&) = delete;\n    \n    ~ScopeHandle()\n    {\n        Close();\n    }\n\npublic:\n    void Attach(HANDLE h)\n    {\n        Close();\n        m_h = h;\n    }\n\n    HANDLE Detach()\n    {\n        HANDLE h = m_h;\n        m_h = NULL;\n        return h;\n    }\n\npublic:\n    operator HANDLE()\n    {\n        return m_h;\n    }\n\n    ScopeHandle& operator=(HANDLE h)\n    {\n        Close();\n        m_h = h;\n        return (*this);\n    }\n\n    ScopeHandle& operator=(const ScopeHandle&) = delete;\n\nprivate:\n    void Close()\n    {\n        if (m_h != NULL || m_h != INVALID_HANDLE_VALUE)\n        {\n            ::CloseHandle(m_h);\n            m_h = NULL;\n        }\n    }\n\nprivate:\n    HANDLE m_h;\n};\n\nclass ScopeVirtualMemoryEx\n{\npublic:\n    ScopeVirtualMemoryEx(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n        : m_lpMemory(lpMemory)\n        , m_hProcess(hProcess)\n        , m_memSize(memSize)\n    {\n\n    }\n\n    ScopeVirtualMemoryEx(const ScopeVirtualMemoryEx&) = delete;\n\n    ~ScopeVirtualMemoryEx()\n    {\n        Close();\n    }\n\npublic:\n    void Attach(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n    {\n        Close();\n        m_lpMemory = lpMemory;\n        m_hProcess = hProcess;\n        m_memSize = memSize;\n    }\n\n    LPVOID Detach()\n    {\n        LPVOID lpMemory = m_lpMemory;\n        Close();\n\n        return lpMemory;\n    }\n\npublic:\n    operator LPVOID()\n    {\n        return m_lpMemory;\n    }\n\n    ScopeVirtualMemoryEx& operator=(const ScopeVirtualMemoryEx&) = delete;\n\nprivate:\n    void Close()\n    {\n        if (m_lpMemory == NULL)\n        {\n            return;\n        }\n\n        if (m_hProcess == NULL)\n        {\n            return;\n        }\n\n        ::VirtualFreeEx(m_hProcess, m_lpMemory, m_memSize, MEM_RELEASE);\n\n        m_hProcess = NULL;\n        m_lpMemory = NULL;\n        m_memSize = 0;\n    }\n\nprivate:\n    LPVOID m_lpMemory;\n    HANDLE m_hProcess;\n    SIZE_T m_memSize;\n};\n```\n\n20100\n\n10100\n\n\n1. \n2. \n\n`AutoReleaseObject`unix:\n```cpp\ntemplate <typename T>\nclass AutoReleaseDelegate\n{\npublic:\n    AutoReleaseDelegate(T obj)\n        : m_obj(obj)\n    {\n\n    }\n\n    virtual ~AutoReleaseDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const = 0;\n    virtual void Release() = 0;\n\npublic:\n    operator T()\n    {\n        return m_obj;\n    }\n\nprotected:\n    T m_obj;\n};\n\nclass HandleDelegate\n    : public AutoReleaseDelegate<HANDLE>\n{\n    using super = AutoReleaseDelegate<HANDLE>;\n\npublic:\n    HandleDelegate(HANDLE h)\n        : AutoReleaseDelegate(h)\n    {\n\n    }\n\n    ~HandleDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const override\n    {\n        return (super::m_obj != NULL);\n    }\n\n    virtual void Release() override\n    {\n        ::CloseHandle(super::m_obj);\n        super::m_obj = NULL;\n    }\n};\n\nclass VirtualMemoryExDelegate\n    : public AutoReleaseDelegate<LPVOID>\n{\n    using super = AutoReleaseDelegate<LPVOID>;\n\npublic:\n    VirtualMemoryExDelegate(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)\n        : AutoReleaseDelegate(lpMemory)\n        , m_hProcess(hProcess)\n        , m_memSize(memSize)\n    {\n\n    }\n\n    ~VirtualMemoryExDelegate()\n    {\n\n    }\n\npublic:\n    virtual bool Validate() const override\n    {\n        if (super::m_obj == NULL)\n            return false;\n\n        if (m_hProcess == NULL)\n            return false;\n\n        return true;\n    }\n\n    virtual void Release() override\n    {\n        ::VirtualFreeEx(m_hProcess, super::m_obj, m_memSize, MEM_RELEASE);\n        m_hProcess = NULL;\n        super::m_obj = NULL;\n        m_memSize = 0;\n    }\n\nprivate:\n    HANDLE m_hProcess;\n    SIZE_T m_memSize;\n};\n\ntemplate <typename T>\nclass AutoReleaseObj\n{\n    using DelegateType = AutoReleaseDelegate<T>;\n\npublic:\n    AutoReleaseObj(DelegateType* pDelegate)\n        : m_pDelegate(pDelegate)\n    {\n\n    }\n    \n    AutoReleaseObj(const AutoReleaseObj&) = delete;\n\n    ~AutoReleaseObj()\n    {\n        assert(m_pDelegate != nullptr);\n        if (m_pDelegate->Validate())\n        {\n            m_pDelegate->Release();\n        }\n    }\n\npublic:\n    operator T()\n    {\n        assert(m_pDelegate != nullptr);\n        return T(*m_pDelegate);\n    }\n\n    AutoReleaseObj<T>& operator=(AutoReleaseObj<T>& rhs) = delete;\n\nprivate:\n    DelegateType* m_pDelegate;\n};\n```\n\n`AutoRelease``AutoReleaseDelegate``AutoReleaseObj`\n\n\n\n`ATL``ATL``CHandle``HANDLE`\n","slug":"inject-2016-07-14-remote-inject","published":1,"updated":"2018-06-25T11:15:53.213Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtmy00022gus2eqqovmz","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>WindowsWindowsWindows</p>\n<p><code>Windows Native API</code><code>STL</code><a href=\"https://github.com/cloudy064/BlogCodes.git\" target=\"_blank\" rel=\"noopener\">github</a><br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<ol>\n<li>WindowsAPI:<code>SetWindowsHookEx</code></li>\n<li></li>\n<li></li>\n</ol>\n<p>dll</p>\n<p></p>\n<ol>\n<li></li>\n<li>dll</li>\n<li>dll<code>LoadLibrary</code></li>\n</ol>\n<p>dll</p>\n<p><code>Hello World</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    system(<span class=\"string\">\"pause\"</span>); <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>dll<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">BOOL APIENTRY <span class=\"title\">DllMain</span><span class=\"params\">( HMODULE hModule,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                       DWORD  ul_reason_for_call,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                       LPVOID lpReserved</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                     )</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (ul_reason_for_call)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_PROCESS_ATTACH:</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"i am injected\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_THREAD_ATTACH:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_THREAD_DETACH:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_PROCESS_DETACH:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> TRUE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>API</code>:</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HANDLE</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">CreateRemoteThread(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span><br><span class=\"line\">    _In_ SIZE_T dwStackSize,</span><br><span class=\"line\">    _In_ LPTHREAD_START_ROUTINE lpStartAddress,</span><br><span class=\"line\">    _In_opt_ LPVOID lpParameter,</span><br><span class=\"line\">    _In_ DWORD dwCreationFlags,</span><br><span class=\"line\">    _Out_opt_ LPDWORD lpThreadId</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p><code>MSDN</code></p>\n<ol>\n<li>hProcess: <code>OpenProcess</code><code>MSDN</code><blockquote>\n<p>The handle must have the PROCESS_CREATE_THREAD, PROCESS_QUERY_INFORMATION, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, and PROCESS_VM_READ access rights, and may fail without these rights on certain platforms.<br><code>OpenProcess</code><code>CreateRemoteThread</code></p>\n</blockquote>\n</li>\n<li>lpStartAddress: 320~4G<code>0x23333333</code><code>A</code><code>0x23333333</code><code>B</code><code>API</code>:<code>VirtualAllocEx</code></li>\n<li>lpParameter: <code>lpStartAddress</code><code>CreateThread</code></li>\n</ol>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hProcess = ::OpenProcess(</span><br><span class=\"line\">        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,</span><br><span class=\"line\">        FALSE,</span><br><span class=\"line\">        <span class=\"number\">6916</span><span class=\"comment\">/*ID*/</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    HANDLE hThread = ::CreateRemoteThread(</span><br><span class=\"line\">        hProcess,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"comment\">/**/</span>,</span><br><span class=\"line\">        <span class=\"comment\">/**/</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hThread == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ::WaitForSingleObject(hThread, INFINITE); <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::CloseHandle(hThread);</span><br><span class=\"line\">    ::CloseHandle(hProcess);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h3 id=\"LoadLibrary\"><a href=\"#LoadLibrary\" class=\"headerlink\" title=\"LoadLibrary\"></a>LoadLibrary</h3><p><a href=\"https://technet.microsoft.com/en-us/sysinternals/bb896653/\" target=\"_blank\" rel=\"noopener\">ProcExp</a><code>kernel32.dll</code><br><img src=\"/2016/07/14/inject-2016-07-14-remote-inject/explorer_kernel32_address.jpg\" title=\"Explorer.exekernel32\"><br><img src=\"/2016/07/14/inject-2016-07-14-remote-inject/devenv_kernel32_address.jpg\" title=\"VSkernel32\"></p>\n<p><code>kernel32.dll</code><code>LoadLibraryW</code><code>kernel32.dll</code><code>LoadLibraryW</code><code>LoadLibraryW</code></p>\n<p><code>LoadLibraryW</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HMODULE hKnl = ::LoadLibraryW(<span class=\"string\">L\"kernel32.dll\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (hKnl == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, <span class=\"string\">\"LoadLibraryW\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (pLoadLibrary == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>LoadLibraryW</code>dll<code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LPVOID</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">VirtualAllocEx(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_opt_ LPVOID lpAddress,</span><br><span class=\"line\">    _In_ SIZE_T dwSize,</span><br><span class=\"line\">    _In_ DWORD flAllocationType,</span><br><span class=\"line\">    _In_ DWORD flProtect</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p>0</p>\n<ol>\n<li>hProcess: </li>\n<li>lpAddress: NULL</li>\n<li>dwSize: </li>\n<li>flAllocationType: <code>MEM_COMMIT</code></li>\n<li>flProtect: <code>PAGE_READWRITE</code></li>\n</ol>\n<p><code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BOOL</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">WriteProcessMemory(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_ LPVOID lpBaseAddress,</span><br><span class=\"line\">    _In_reads_bytes_(nSize) LPCVOID lpBuffer,</span><br><span class=\"line\">    _In_ SIZE_T nSize,</span><br><span class=\"line\">    _Out_opt_ SIZE_T * lpNumberOfBytesWritten</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p><code>dll</code><code>D:\\RemoteInjectDll.dll</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LPCWSTR lpszDllPath = L<span class=\"string\">R\"(D:\\RemoteInjectDll.dll)\"</span>;</span><br><span class=\"line\">SIZE_T dwMemSize = <span class=\"keyword\">static_cast</span>&lt;SIZE_T&gt;((wcslen(lpszDllPath) + <span class=\"number\">1</span>) * <span class=\"keyword\">sizeof</span>(WCHAR));</span><br><span class=\"line\">LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, <span class=\"literal\">NULL</span>, dwMemSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (lpRemoteMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SIZE_T sizeWritten = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &amp;sizeWritten))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// RemoteInjectExe.cpp : Defines the entry point for the console application.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hProcess = ::OpenProcess(</span><br><span class=\"line\">        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,</span><br><span class=\"line\">        FALSE,</span><br><span class=\"line\">        <span class=\"number\">6916</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    LPCWSTR lpszDllPath = L<span class=\"string\">R\"(D:\\workspaces\\c++\\RemoteInjectExe\\Debug\\RemoteInjectDll.dll)\"</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">    SIZE_T dwMemSize = <span class=\"keyword\">static_cast</span>&lt;SIZE_T&gt;((wcslen(lpszDllPath) + <span class=\"number\">1</span>) * <span class=\"keyword\">sizeof</span>(WCHAR));</span><br><span class=\"line\">    LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, <span class=\"literal\">NULL</span>, dwMemSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (lpRemoteMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    SIZE_T sizeWritten = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &amp;sizeWritten))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    HMODULE hKnl = ::LoadLibraryW(<span class=\"string\">L\"kernel32.dll\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hKnl == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, <span class=\"string\">\"LoadLibraryW\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pLoadLibrary == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::FreeLibrary(hKnl);</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DWORD dwThreadId;</span><br><span class=\"line\">    HANDLE hThread = ::CreateRemoteThread(</span><br><span class=\"line\">        hProcess,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        pLoadLibrary,</span><br><span class=\"line\">        lpRemoteMemory,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        &amp;dwThreadId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hThread == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::FreeLibrary(hKnl);</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ::WaitForSingleObject(hThread, INFINITE);</span><br><span class=\"line\"></span><br><span class=\"line\">    ::FreeLibrary(hKnl);</span><br><span class=\"line\">    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">    ::CloseHandle(hProcess);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>HelloWorld.exe</code><code>OpenProcess</code><code>HelloWorld.exe</code>ID<br></p>\n<p><code>API</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><code>C++</code>main<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScopeHandle</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ScopeHandle(HANDLE h)</span><br><span class=\"line\">        : m_h(h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle(<span class=\"keyword\">const</span> ScopeHandle&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    ~ScopeHandle()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Attach</span><span class=\"params\">(HANDLE h)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_h = h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">HANDLE <span class=\"title\">Detach</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        HANDLE h = m_h;</span><br><span class=\"line\">        m_h = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">HANDLE</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle&amp; <span class=\"keyword\">operator</span>=(HANDLE h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_h = h;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (*<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> ScopeHandle&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Close</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_h != <span class=\"literal\">NULL</span> || m_h != INVALID_HANDLE_VALUE)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ::CloseHandle(m_h);</span><br><span class=\"line\">            m_h = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    HANDLE m_h;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScopeVirtualMemoryEx</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ScopeVirtualMemoryEx(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span><br><span class=\"line\">        : m_lpMemory(lpMemory)</span><br><span class=\"line\">        , m_hProcess(hProcess)</span><br><span class=\"line\">        , m_memSize(memSize)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeVirtualMemoryEx(<span class=\"keyword\">const</span> ScopeVirtualMemoryEx&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~ScopeVirtualMemoryEx()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Attach</span><span class=\"params\">(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_lpMemory = lpMemory;</span><br><span class=\"line\">        m_hProcess = hProcess;</span><br><span class=\"line\">        m_memSize = memSize;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">LPVOID <span class=\"title\">Detach</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        LPVOID lpMemory = m_lpMemory;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> lpMemory;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">LPVOID</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_lpMemory;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeVirtualMemoryEx&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> ScopeVirtualMemoryEx&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Close</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_lpMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ::VirtualFreeEx(m_hProcess, m_lpMemory, m_memSize, MEM_RELEASE);</span><br><span class=\"line\"></span><br><span class=\"line\">        m_hProcess = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_lpMemory = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_memSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    LPVOID m_lpMemory;</span><br><span class=\"line\">    HANDLE m_hProcess;</span><br><span class=\"line\">    SIZE_T m_memSize;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>20100</p>\n<p>10100</p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p><code>AutoReleaseObject</code>unix:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AutoReleaseDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    AutoReleaseDelegate(T obj)</span><br><span class=\"line\">        : m_obj(obj)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">virtual</span> ~AutoReleaseDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>= <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> </span>= <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">T</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    T m_obj;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandleDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> AutoReleaseDelegate&lt;HANDLE&gt;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">using</span> super = AutoReleaseDelegate&lt;HANDLE&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    HandleDelegate(HANDLE h)</span><br><span class=\"line\">        : AutoReleaseDelegate(h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~HandleDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (super::m_obj != <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        ::CloseHandle(super::m_obj);</span><br><span class=\"line\">        super::m_obj = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VirtualMemoryExDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> AutoReleaseDelegate&lt;LPVOID&gt;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">using</span> super = AutoReleaseDelegate&lt;LPVOID&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    VirtualMemoryExDelegate(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span><br><span class=\"line\">        : AutoReleaseDelegate(lpMemory)</span><br><span class=\"line\">        , m_hProcess(hProcess)</span><br><span class=\"line\">        , m_memSize(memSize)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~VirtualMemoryExDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (super::m_obj == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        ::VirtualFreeEx(m_hProcess, super::m_obj, m_memSize, MEM_RELEASE);</span><br><span class=\"line\">        m_hProcess = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        super::m_obj = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_memSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    HANDLE m_hProcess;</span><br><span class=\"line\">    SIZE_T m_memSize;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AutoReleaseObj</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">using</span> DelegateType = AutoReleaseDelegate&lt;T&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    AutoReleaseObj(DelegateType* pDelegate)</span><br><span class=\"line\">        : m_pDelegate(pDelegate)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    AutoReleaseObj(<span class=\"keyword\">const</span> AutoReleaseObj&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~AutoReleaseObj()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        assert(m_pDelegate != <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_pDelegate-&gt;Validate())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_pDelegate-&gt;Release();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">T</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        assert(m_pDelegate != <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> T(*m_pDelegate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    AutoReleaseObj&lt;T&gt;&amp; <span class=\"keyword\">operator</span>=(AutoReleaseObj&lt;T&gt;&amp; rhs) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    DelegateType* m_pDelegate;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p><code>AutoRelease</code><code>AutoReleaseDelegate</code><code>AutoReleaseObj</code></p>\n<p></p>\n<p><code>ATL</code><code>ATL</code><code>CHandle</code><code>HANDLE</code></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>WindowsWindowsWindows</p>\n<p><code>Windows Native API</code><code>STL</code><a href=\"https://github.com/cloudy064/BlogCodes.git\" target=\"_blank\" rel=\"noopener\">github</a><br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<ol>\n<li>WindowsAPI:<code>SetWindowsHookEx</code></li>\n<li></li>\n<li></li>\n</ol>\n<p>dll</p>\n<p></p>\n<ol>\n<li></li>\n<li>dll</li>\n<li>dll<code>LoadLibrary</code></li>\n</ol>\n<p>dll</p>\n<p><code>Hello World</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    system(<span class=\"string\">\"pause\"</span>); <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>dll<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">BOOL APIENTRY <span class=\"title\">DllMain</span><span class=\"params\">( HMODULE hModule,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                       DWORD  ul_reason_for_call,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                       LPVOID lpReserved</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                     )</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (ul_reason_for_call)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_PROCESS_ATTACH:</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"i am injected\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_THREAD_ATTACH:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_THREAD_DETACH:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DLL_PROCESS_DETACH:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> TRUE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>API</code>:</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HANDLE</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">CreateRemoteThread(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span><br><span class=\"line\">    _In_ SIZE_T dwStackSize,</span><br><span class=\"line\">    _In_ LPTHREAD_START_ROUTINE lpStartAddress,</span><br><span class=\"line\">    _In_opt_ LPVOID lpParameter,</span><br><span class=\"line\">    _In_ DWORD dwCreationFlags,</span><br><span class=\"line\">    _Out_opt_ LPDWORD lpThreadId</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p><code>MSDN</code></p>\n<ol>\n<li>hProcess: <code>OpenProcess</code><code>MSDN</code><blockquote>\n<p>The handle must have the PROCESS_CREATE_THREAD, PROCESS_QUERY_INFORMATION, PROCESS_VM_OPERATION, PROCESS_VM_WRITE, and PROCESS_VM_READ access rights, and may fail without these rights on certain platforms.<br><code>OpenProcess</code><code>CreateRemoteThread</code></p>\n</blockquote>\n</li>\n<li>lpStartAddress: 320~4G<code>0x23333333</code><code>A</code><code>0x23333333</code><code>B</code><code>API</code>:<code>VirtualAllocEx</code></li>\n<li>lpParameter: <code>lpStartAddress</code><code>CreateThread</code></li>\n</ol>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hProcess = ::OpenProcess(</span><br><span class=\"line\">        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,</span><br><span class=\"line\">        FALSE,</span><br><span class=\"line\">        <span class=\"number\">6916</span><span class=\"comment\">/*ID*/</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    HANDLE hThread = ::CreateRemoteThread(</span><br><span class=\"line\">        hProcess,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"comment\">/**/</span>,</span><br><span class=\"line\">        <span class=\"comment\">/**/</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hThread == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ::WaitForSingleObject(hThread, INFINITE); <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::CloseHandle(hThread);</span><br><span class=\"line\">    ::CloseHandle(hProcess);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h3 id=\"LoadLibrary\"><a href=\"#LoadLibrary\" class=\"headerlink\" title=\"LoadLibrary\"></a>LoadLibrary</h3><p><a href=\"https://technet.microsoft.com/en-us/sysinternals/bb896653/\" target=\"_blank\" rel=\"noopener\">ProcExp</a><code>kernel32.dll</code><br><img src=\"/2016/07/14/inject-2016-07-14-remote-inject/explorer_kernel32_address.jpg\" title=\"Explorer.exekernel32\"><br><img src=\"/2016/07/14/inject-2016-07-14-remote-inject/devenv_kernel32_address.jpg\" title=\"VSkernel32\"></p>\n<p><code>kernel32.dll</code><code>LoadLibraryW</code><code>kernel32.dll</code><code>LoadLibraryW</code><code>LoadLibraryW</code></p>\n<p><code>LoadLibraryW</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HMODULE hKnl = ::LoadLibraryW(<span class=\"string\">L\"kernel32.dll\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (hKnl == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, <span class=\"string\">\"LoadLibraryW\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (pLoadLibrary == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>LoadLibraryW</code>dll<code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LPVOID</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">VirtualAllocEx(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_opt_ LPVOID lpAddress,</span><br><span class=\"line\">    _In_ SIZE_T dwSize,</span><br><span class=\"line\">    _In_ DWORD flAllocationType,</span><br><span class=\"line\">    _In_ DWORD flProtect</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p>0</p>\n<ol>\n<li>hProcess: </li>\n<li>lpAddress: NULL</li>\n<li>dwSize: </li>\n<li>flAllocationType: <code>MEM_COMMIT</code></li>\n<li>flProtect: <code>PAGE_READWRITE</code></li>\n</ol>\n<p><code>API</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BOOL</span><br><span class=\"line\">WINAPI</span><br><span class=\"line\">WriteProcessMemory(</span><br><span class=\"line\">    _In_ HANDLE hProcess,</span><br><span class=\"line\">    _In_ LPVOID lpBaseAddress,</span><br><span class=\"line\">    _In_reads_bytes_(nSize) LPCVOID lpBuffer,</span><br><span class=\"line\">    _In_ SIZE_T nSize,</span><br><span class=\"line\">    _Out_opt_ SIZE_T * lpNumberOfBytesWritten</span><br><span class=\"line\">    );</span><br></pre></td></tr></table></figure></p>\n<p><code>dll</code><code>D:\\RemoteInjectDll.dll</code>:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LPCWSTR lpszDllPath = L<span class=\"string\">R\"(D:\\RemoteInjectDll.dll)\"</span>;</span><br><span class=\"line\">SIZE_T dwMemSize = <span class=\"keyword\">static_cast</span>&lt;SIZE_T&gt;((wcslen(lpszDllPath) + <span class=\"number\">1</span>) * <span class=\"keyword\">sizeof</span>(WCHAR));</span><br><span class=\"line\">LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, <span class=\"literal\">NULL</span>, dwMemSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (lpRemoteMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SIZE_T sizeWritten = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &amp;sizeWritten))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// RemoteInjectExe.cpp : Defines the entry point for the console application.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hProcess = ::OpenProcess(</span><br><span class=\"line\">        PROCESS_CREATE_THREAD | PROCESS_OPERATION | PROCESS_QUERY_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE,</span><br><span class=\"line\">        FALSE,</span><br><span class=\"line\">        <span class=\"number\">6916</span></span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    LPCWSTR lpszDllPath = L<span class=\"string\">R\"(D:\\workspaces\\c++\\RemoteInjectExe\\Debug\\RemoteInjectDll.dll)\"</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">    SIZE_T dwMemSize = <span class=\"keyword\">static_cast</span>&lt;SIZE_T&gt;((wcslen(lpszDllPath) + <span class=\"number\">1</span>) * <span class=\"keyword\">sizeof</span>(WCHAR));</span><br><span class=\"line\">    LPVOID lpRemoteMemory = ::VirtualAllocEx(hProcess, <span class=\"literal\">NULL</span>, dwMemSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (lpRemoteMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    SIZE_T sizeWritten = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!::WriteProcessMemory(hProcess, lpRemoteMemory, (LPCVOID)lpszDllPath, dwMemSize, &amp;sizeWritten))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    HMODULE hKnl = ::LoadLibraryW(<span class=\"string\">L\"kernel32.dll\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hKnl == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    LPTHREAD_START_ROUTINE pLoadLibrary = (LPTHREAD_START_ROUTINE)::GetProcAddress(hKnl, <span class=\"string\">\"LoadLibraryW\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pLoadLibrary == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::FreeLibrary(hKnl);</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DWORD dwThreadId;</span><br><span class=\"line\">    HANDLE hThread = ::CreateRemoteThread(</span><br><span class=\"line\">        hProcess,</span><br><span class=\"line\">        <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        pLoadLibrary,</span><br><span class=\"line\">        lpRemoteMemory,</span><br><span class=\"line\">        <span class=\"number\">0</span>,</span><br><span class=\"line\">        &amp;dwThreadId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hThread == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ::FreeLibrary(hKnl);</span><br><span class=\"line\">        ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">        ::CloseHandle(hProcess);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ::WaitForSingleObject(hThread, INFINITE);</span><br><span class=\"line\"></span><br><span class=\"line\">    ::FreeLibrary(hKnl);</span><br><span class=\"line\">    ::VirtualFreeEx(hProcess, lpRemoteMemory, dwMemSize, MEM_RELEASE);</span><br><span class=\"line\">    ::CloseHandle(hProcess);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>HelloWorld.exe</code><code>OpenProcess</code><code>HelloWorld.exe</code>ID<br></p>\n<p><code>API</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><code>C++</code>main<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScopeHandle</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ScopeHandle(HANDLE h)</span><br><span class=\"line\">        : m_h(h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle(<span class=\"keyword\">const</span> ScopeHandle&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    ~ScopeHandle()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Attach</span><span class=\"params\">(HANDLE h)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_h = h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">HANDLE <span class=\"title\">Detach</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        HANDLE h = m_h;</span><br><span class=\"line\">        m_h = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">HANDLE</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_h;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle&amp; <span class=\"keyword\">operator</span>=(HANDLE h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_h = h;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (*<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeHandle&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> ScopeHandle&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Close</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_h != <span class=\"literal\">NULL</span> || m_h != INVALID_HANDLE_VALUE)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ::CloseHandle(m_h);</span><br><span class=\"line\">            m_h = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    HANDLE m_h;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScopeVirtualMemoryEx</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ScopeVirtualMemoryEx(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span><br><span class=\"line\">        : m_lpMemory(lpMemory)</span><br><span class=\"line\">        , m_hProcess(hProcess)</span><br><span class=\"line\">        , m_memSize(memSize)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeVirtualMemoryEx(<span class=\"keyword\">const</span> ScopeVirtualMemoryEx&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~ScopeVirtualMemoryEx()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Attach</span><span class=\"params\">(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\">        m_lpMemory = lpMemory;</span><br><span class=\"line\">        m_hProcess = hProcess;</span><br><span class=\"line\">        m_memSize = memSize;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">LPVOID <span class=\"title\">Detach</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        LPVOID lpMemory = m_lpMemory;</span><br><span class=\"line\">        Close();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> lpMemory;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">LPVOID</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_lpMemory;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ScopeVirtualMemoryEx&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> ScopeVirtualMemoryEx&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Close</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_lpMemory == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ::VirtualFreeEx(m_hProcess, m_lpMemory, m_memSize, MEM_RELEASE);</span><br><span class=\"line\"></span><br><span class=\"line\">        m_hProcess = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_lpMemory = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_memSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    LPVOID m_lpMemory;</span><br><span class=\"line\">    HANDLE m_hProcess;</span><br><span class=\"line\">    SIZE_T m_memSize;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>20100</p>\n<p>10100</p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p><code>AutoReleaseObject</code>unix:<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AutoReleaseDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    AutoReleaseDelegate(T obj)</span><br><span class=\"line\">        : m_obj(obj)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">virtual</span> ~AutoReleaseDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>= <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> </span>= <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">T</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m_obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    T m_obj;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandleDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> AutoReleaseDelegate&lt;HANDLE&gt;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">using</span> super = AutoReleaseDelegate&lt;HANDLE&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    HandleDelegate(HANDLE h)</span><br><span class=\"line\">        : AutoReleaseDelegate(h)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~HandleDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (super::m_obj != <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        ::CloseHandle(super::m_obj);</span><br><span class=\"line\">        super::m_obj = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VirtualMemoryExDelegate</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> AutoReleaseDelegate&lt;LPVOID&gt;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">using</span> super = AutoReleaseDelegate&lt;LPVOID&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    VirtualMemoryExDelegate(LPVOID lpMemory, HANDLE hProcess, SIZE_T memSize)</span><br><span class=\"line\">        : AutoReleaseDelegate(lpMemory)</span><br><span class=\"line\">        , m_hProcess(hProcess)</span><br><span class=\"line\">        , m_memSize(memSize)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~VirtualMemoryExDelegate()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">bool</span> <span class=\"title\">Validate</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (super::m_obj == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_hProcess == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Release</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        ::VirtualFreeEx(m_hProcess, super::m_obj, m_memSize, MEM_RELEASE);</span><br><span class=\"line\">        m_hProcess = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        super::m_obj = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        m_memSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    HANDLE m_hProcess;</span><br><span class=\"line\">    SIZE_T m_memSize;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AutoReleaseObj</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">using</span> DelegateType = AutoReleaseDelegate&lt;T&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    AutoReleaseObj(DelegateType* pDelegate)</span><br><span class=\"line\">        : m_pDelegate(pDelegate)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    AutoReleaseObj(<span class=\"keyword\">const</span> AutoReleaseObj&amp;) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~AutoReleaseObj()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        assert(m_pDelegate != <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_pDelegate-&gt;Validate())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_pDelegate-&gt;Release();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">operator</span> <span class=\"title\">T</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        assert(m_pDelegate != <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> T(*m_pDelegate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    AutoReleaseObj&lt;T&gt;&amp; <span class=\"keyword\">operator</span>=(AutoReleaseObj&lt;T&gt;&amp; rhs) = <span class=\"keyword\">delete</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    DelegateType* m_pDelegate;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p><code>AutoRelease</code><code>AutoReleaseDelegate</code><code>AutoReleaseObj</code></p>\n<p></p>\n<p><code>ATL</code><code>ATL</code><code>CHandle</code><code>HANDLE</code></p>"},{"title":"064hexo","date":"2016-06-20T04:16:20.000Z","_content":"\n## \n`WordPress`,`hexo`+`github``Markdown``wordpress``hexo``github``windows``linux``macos`\n<!--more-->\n\n## node.js\n`hexo``node.js`[node.js](https://nodejs.org/en/)`npm``nodejs``PATH`\n\n## hexo\n`npm install -g hexo-cli``hexo`\n\n## github\n`github``Greate Fucking Wall``new repository``github.github.io``Create repository`\n{% asset_img newrepository.png  %}\n\n## git\n[git](https://git-scm.com/download)`git``github`\n```cmd\ngit config --global user.name cloudy064\ngit config --global user.email cloudy@gmail.com\ngit config --global user.password **********\n```\n\n`SSH key`\n```cmd\nssh-keygen -t rsa -C\"cloudy064@gmail.com\"\n```\n\n`C:\\Users\\cloudy``.ssh``id_rsa.pub`\n\n`github``Setting``SSH and GPG keys`\n{% asset_img generatesshkey.png SSH key %}\n\n`New SSH key``Title``key``id_rsa.pub``Add SSH key`\n\n`git`\n\n## \n\n```cmd\nnpm install hexo --save\nhexo init\n```\n\n`Hexo`\n```cmd\nnpm install hexo-generator-index --save\nnpm install hexo-generator-archive --save\nnpm install hexo-generator-category --save\nnpm install hexo-generator-tag --save\nnpm install hexo-generator-feed@1 --save\nnpm install hexo-generator-sitemap@1 --save\n\nnpm install hexo-server --save\n\nnpm install hexo-deployer-git --save\nnpm install hexo-deployer-heroku --save\nnpm install hexo-deployer-rsync --save\nnpm install hexo-deployer-openshift --save\n\nnpm install hexo-renderer-marked@0.2 --save\nnpm install hexo-renderer-stylus@0.2 --save\n```\n\n`hexo`\n\n## hexo\n`github``Clone or download``git@github.com:cloudy064/cloudy064.github.io.git`\n{% asset_img getrepositoryaddress.png  %}\n\n`_config.yml``deploy:`\n```\n  repository: git@github.com:cloudy064/cloudy064.github.io.git\n  type: git\n  branch: master\n```\n\n`hexo`\n\n`hexo`\n\n## \n:\n```cmd\nhexo g\nhexo d\n```\n\n`cloudy064.github.io``HelloWorld`\n\n## \n:\n```\nhexo n \"first blog\"\n```\n\n`source\\_post\\``first blog.md``Markdown`\n\n## \n\n### \n`hexo``_config.yml``post_asset_folder``false``true``hexo n`\n```\n{% asset_img   %}\n```\n\n`hexo`\n\n### \n`Next``clone`\n```cmd\ngit clone https://github.com/iissnan/hexo-theme-next\n```\n\n`themes``Next``clone``.git``.github``Next`\n\n`_config.yml``theme``Next`\n\n`hexo g``hexo d`\n\n### \n`hexo``hexo g``hexo s``localhost:4000`","source":"_posts/hexo/2016-06-20-build-blog-with-hexo.md","raw":"---\ntitle: 064hexo\ndate: 2016-06-20 12:16:20\ncategories: blog\ntags: [blog, hexo]\n---\n\n## \n`WordPress`,`hexo`+`github``Markdown``wordpress``hexo``github``windows``linux``macos`\n<!--more-->\n\n## node.js\n`hexo``node.js`[node.js](https://nodejs.org/en/)`npm``nodejs``PATH`\n\n## hexo\n`npm install -g hexo-cli``hexo`\n\n## github\n`github``Greate Fucking Wall``new repository``github.github.io``Create repository`\n{% asset_img newrepository.png  %}\n\n## git\n[git](https://git-scm.com/download)`git``github`\n```cmd\ngit config --global user.name cloudy064\ngit config --global user.email cloudy@gmail.com\ngit config --global user.password **********\n```\n\n`SSH key`\n```cmd\nssh-keygen -t rsa -C\"cloudy064@gmail.com\"\n```\n\n`C:\\Users\\cloudy``.ssh``id_rsa.pub`\n\n`github``Setting``SSH and GPG keys`\n{% asset_img generatesshkey.png SSH key %}\n\n`New SSH key``Title``key``id_rsa.pub``Add SSH key`\n\n`git`\n\n## \n\n```cmd\nnpm install hexo --save\nhexo init\n```\n\n`Hexo`\n```cmd\nnpm install hexo-generator-index --save\nnpm install hexo-generator-archive --save\nnpm install hexo-generator-category --save\nnpm install hexo-generator-tag --save\nnpm install hexo-generator-feed@1 --save\nnpm install hexo-generator-sitemap@1 --save\n\nnpm install hexo-server --save\n\nnpm install hexo-deployer-git --save\nnpm install hexo-deployer-heroku --save\nnpm install hexo-deployer-rsync --save\nnpm install hexo-deployer-openshift --save\n\nnpm install hexo-renderer-marked@0.2 --save\nnpm install hexo-renderer-stylus@0.2 --save\n```\n\n`hexo`\n\n## hexo\n`github``Clone or download``git@github.com:cloudy064/cloudy064.github.io.git`\n{% asset_img getrepositoryaddress.png  %}\n\n`_config.yml``deploy:`\n```\n  repository: git@github.com:cloudy064/cloudy064.github.io.git\n  type: git\n  branch: master\n```\n\n`hexo`\n\n`hexo`\n\n## \n:\n```cmd\nhexo g\nhexo d\n```\n\n`cloudy064.github.io``HelloWorld`\n\n## \n:\n```\nhexo n \"first blog\"\n```\n\n`source\\_post\\``first blog.md``Markdown`\n\n## \n\n### \n`hexo``_config.yml``post_asset_folder``false``true``hexo n`\n```\n{% asset_img   %}\n```\n\n`hexo`\n\n### \n`Next``clone`\n```cmd\ngit clone https://github.com/iissnan/hexo-theme-next\n```\n\n`themes``Next``clone``.git``.github``Next`\n\n`_config.yml``theme``Next`\n\n`hexo g``hexo d`\n\n### \n`hexo``hexo g``hexo s``localhost:4000`","slug":"hexo-2016-06-20-build-blog-with-hexo","published":1,"updated":"2018-06-25T11:16:22.613Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtn200032gusk1yg1mmp","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>WordPress</code>,<code>hexo</code>+<code>github</code><code>Markdown</code><code>wordpress</code><code>hexo</code><code>github</code><code>windows</code><code>linux</code><code>macos</code><br><a id=\"more\"></a></p>\n<h2 id=\"node-js\"><a href=\"#node-js\" class=\"headerlink\" title=\"node.js\"></a>node.js</h2><p><code>hexo</code><code>node.js</code><a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener\">node.js</a><code>npm</code><code>nodejs</code><code>PATH</code></p>\n<h2 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h2><p><code>npm install -g hexo-cli</code><code>hexo</code></p>\n<h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><p><code>github</code><code>Greate Fucking Wall</code><code>new repository</code><code>github.github.io</code><code>Create repository</code><br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/newrepository.png\" title=\"\"></p>\n<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><p><a href=\"https://git-scm.com/download\" target=\"_blank\" rel=\"noopener\">git</a><code>git</code><code>github</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name cloudy064</span><br><span class=\"line\">git config --global user.email cloudy@gmail.com</span><br><span class=\"line\">git config --global user.password **********</span><br></pre></td></tr></table></figure></p>\n<p><code>SSH key</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C\"cloudy064@gmail.com\"</span><br></pre></td></tr></table></figure></p>\n<p><code>C:\\Users\\cloudy</code><code>.ssh</code><code>id_rsa.pub</code></p>\n<p><code>github</code><code>Setting</code><code>SSH and GPG keys</code><br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/generatesshkey.png\" title=\"SSH key\"></p>\n<p><code>New SSH key</code><code>Title</code><code>key</code><code>id_rsa.pub</code><code>Add SSH key</code></p>\n<p><code>git</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo --save</span><br><span class=\"line\">hexo init</span><br></pre></td></tr></table></figure></p>\n<p><code>Hexo</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-index --save</span><br><span class=\"line\">npm install hexo-generator-archive --save</span><br><span class=\"line\">npm install hexo-generator-category --save</span><br><span class=\"line\">npm install hexo-generator-tag --save</span><br><span class=\"line\">npm install hexo-generator-feed@<span class=\"number\">1</span> --save</span><br><span class=\"line\">npm install hexo-generator-sitemap@<span class=\"number\">1</span> --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-server --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-deployer-git --save</span><br><span class=\"line\">npm install hexo-deployer-heroku --save</span><br><span class=\"line\">npm install hexo-deployer-rsync --save</span><br><span class=\"line\">npm install hexo-deployer-openshift --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-renderer-marked@<span class=\"number\">0</span>.<span class=\"number\">2</span> --save</span><br><span class=\"line\">npm install hexo-renderer-stylus@<span class=\"number\">0</span>.<span class=\"number\">2</span> --save</span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<h2 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h2><p><code>github</code><code>Clone or download</code><a href=\"mailto:`git@github.com\" target=\"_blank\" rel=\"noopener\">`git@github.com</a>:cloudy064/cloudy064.github.io.git`<br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/getrepositoryaddress.png\" title=\"\"></p>\n<p><code>_config.yml</code><code>deploy:</code><br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">repository</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:cloudy064/cloudy064.github.io.git</span><br><span class=\"line\"><span class=\"attribute\">type</span>: git</span><br><span class=\"line\"><span class=\"attribute\">branch</span>: master</span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<p><code>hexo</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:<br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo g</span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure></p>\n<p><code>cloudy064.github.io</code><code>HelloWorld</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:<br><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"built_in\">n</span> <span class=\"string\">\"first blog\"</span></span><br></pre></td></tr></table></figure></p>\n<p><code>source\\_post\\</code><code>first blog.md</code><code>Markdown</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>hexo</code><code>_config.yml</code><code>post_asset_folder</code><code>false</code><code>true</code><code>hexo n</code><br><figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\">asset_img</span>   %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>Next</code><code>clone</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/iissnan/hexo-theme-next</span><br></pre></td></tr></table></figure></p>\n<p><code>themes</code><code>Next</code><code>clone</code><code>.git</code><code>.github</code><code>Next</code></p>\n<p><code>_config.yml</code><code>theme</code><code>Next</code></p>\n<p><code>hexo g</code><code>hexo d</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>hexo</code><code>hexo g</code><code>hexo s</code><code>localhost:4000</code></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>WordPress</code>,<code>hexo</code>+<code>github</code><code>Markdown</code><code>wordpress</code><code>hexo</code><code>github</code><code>windows</code><code>linux</code><code>macos</code><br>","more":"</p>\n<h2 id=\"node-js\"><a href=\"#node-js\" class=\"headerlink\" title=\"node.js\"></a>node.js</h2><p><code>hexo</code><code>node.js</code><a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener\">node.js</a><code>npm</code><code>nodejs</code><code>PATH</code></p>\n<h2 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h2><p><code>npm install -g hexo-cli</code><code>hexo</code></p>\n<h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><p><code>github</code><code>Greate Fucking Wall</code><code>new repository</code><code>github.github.io</code><code>Create repository</code><br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/newrepository.png\" title=\"\"></p>\n<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><p><a href=\"https://git-scm.com/download\" target=\"_blank\" rel=\"noopener\">git</a><code>git</code><code>github</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name cloudy064</span><br><span class=\"line\">git config --global user.email cloudy@gmail.com</span><br><span class=\"line\">git config --global user.password **********</span><br></pre></td></tr></table></figure></p>\n<p><code>SSH key</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C\"cloudy064@gmail.com\"</span><br></pre></td></tr></table></figure></p>\n<p><code>C:\\Users\\cloudy</code><code>.ssh</code><code>id_rsa.pub</code></p>\n<p><code>github</code><code>Setting</code><code>SSH and GPG keys</code><br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/generatesshkey.png\" title=\"SSH key\"></p>\n<p><code>New SSH key</code><code>Title</code><code>key</code><code>id_rsa.pub</code><code>Add SSH key</code></p>\n<p><code>git</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo --save</span><br><span class=\"line\">hexo init</span><br></pre></td></tr></table></figure></p>\n<p><code>Hexo</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-index --save</span><br><span class=\"line\">npm install hexo-generator-archive --save</span><br><span class=\"line\">npm install hexo-generator-category --save</span><br><span class=\"line\">npm install hexo-generator-tag --save</span><br><span class=\"line\">npm install hexo-generator-feed@<span class=\"number\">1</span> --save</span><br><span class=\"line\">npm install hexo-generator-sitemap@<span class=\"number\">1</span> --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-server --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-deployer-git --save</span><br><span class=\"line\">npm install hexo-deployer-heroku --save</span><br><span class=\"line\">npm install hexo-deployer-rsync --save</span><br><span class=\"line\">npm install hexo-deployer-openshift --save</span><br><span class=\"line\"></span><br><span class=\"line\">npm install hexo-renderer-marked@<span class=\"number\">0</span>.<span class=\"number\">2</span> --save</span><br><span class=\"line\">npm install hexo-renderer-stylus@<span class=\"number\">0</span>.<span class=\"number\">2</span> --save</span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<h2 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h2><p><code>github</code><code>Clone or download</code><a href=\"mailto:`git@github.com\" target=\"_blank\" rel=\"noopener\">`git@github.com</a>:cloudy064/cloudy064.github.io.git`<br><img src=\"/2016/06/20/hexo-2016-06-20-build-blog-with-hexo/getrepositoryaddress.png\" title=\"\"></p>\n<p><code>_config.yml</code><code>deploy:</code><br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">repository</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:cloudy064/cloudy064.github.io.git</span><br><span class=\"line\"><span class=\"attribute\">type</span>: git</span><br><span class=\"line\"><span class=\"attribute\">branch</span>: master</span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<p><code>hexo</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:<br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo g</span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure></p>\n<p><code>cloudy064.github.io</code><code>HelloWorld</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:<br><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"built_in\">n</span> <span class=\"string\">\"first blog\"</span></span><br></pre></td></tr></table></figure></p>\n<p><code>source\\_post\\</code><code>first blog.md</code><code>Markdown</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>hexo</code><code>_config.yml</code><code>post_asset_folder</code><code>false</code><code>true</code><code>hexo n</code><br><figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\">asset_img</span>   %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure></p>\n<p><code>hexo</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>Next</code><code>clone</code><br><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/iissnan/hexo-theme-next</span><br></pre></td></tr></table></figure></p>\n<p><code>themes</code><code>Next</code><code>clone</code><code>.git</code><code>.github</code><code>Next</code></p>\n<p><code>_config.yml</code><code>theme</code><code>Next</code></p>\n<p><code>hexo g</code><code>hexo d</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>hexo</code><code>hexo g</code><code>hexo s</code><code>localhost:4000</code></p>"},{"title":"064leetcode(1)","date":"2016-10-18T10:21:29.000Z","_content":"\n## 1. \n[Two Sum](https://leetcode.com/problems/two-sum/)\nnumstarget\nxyat (a[x]+a[y]==t)\n\n\n## 2. \n>  nums=[2,7,11,15], target=9\n>  nums[0] + nums[1] = 2 + 7 = 9\n>   [0,1]\n\n<!--more-->\n\n---\n\n## 3. \n### 3.1 \n#### 3.1.1 \n\n1. \n2. (`a[i]`)(`a[j]`)`sum`\n3. `sum``target`(`j -= 1`)24\n4. `sum``target`(`i += 1`)25\n5. `i``j`\n\n`map`\n\n#### 3.1.2 \n `O(nlogn)`\n `O(n)`\n\n#### 3.1.3 \n```cpp\nstruct Num {\n    int num;    //\n    int index;  //\n\n    bool operator<(const Num& rhs) {\n        return num < rhs.num;\n    }\n};\n\nclass Solution {\npublic:\n    vector<int> twoSum(vector<int>& nums, int target) {\n        vector<Num> numsWithIndex(nums.size());\n\n        // \n        for (int i = 0; i < nums.size(); ++i) {\n            numsWithIndex[i].num = nums[i];\n            numsWithIndex[i].index = i;\n        }\n\n        sort(numsWithIndex.begin(), numsWithIndex.end());\n\n        int smaller = 0;\n        int larger = numsWithIndex.size() - 1;\n        while (true) {\n            int sum = numsWithIndex[smaller].num + numsWithIndex[larger].num;\n            if (sum == target) {\n                break;\n            }\n\n            if (sum > target) {\n                --larger;\n            }\n            else {\n                ++smaller;\n            }\n        }\n\n        int indexa = numsWithIndex[smaller].index;\n        int indexb = numsWithIndex[larger].index;\n\n        // \n        vector<int> result;\n        if (indexa > indexb) {\n            result.push_back(indexb);\n            result.push_back(indexa);\n        }\n        else {\n            result.push_back(indexa);\n            result.push_back(indexb);\n        }\n        return result;\n    }\n};\n```\n\n---\n\n### 3.2 \n#### 3.2.1 \n\n1. `key``value``map`\n2. `a``target-a``map``target-a``a``map[target-a]`2\n\n#### 3.2.2 \n `O(n)`\n `O(n)`\n\n#### 3.2.3 \n```cpp\nclass Solution\n{\npublic:\n\tvector<int> twoSum(vector<int>& nums, int target) {\n\t\tvector<int> result;\n\t\tunordered_map<int, int> record;\n\t\tfor (int i = 0; i < nums.size(); ++i)\n\t\t{\n\t\t\tint to_find = target - nums[i];\n\t\t\tunordered_map<int, int>::iterator it = record.find(to_find);\n\t\t\tif (it != record.end())\n\t\t\t{\n\t\t\t\tresult.push_back(it->second);\n\t\t\t\tresult.push_back(i);\n\t\t\t\tbreak;\n\t\t\t} \n\t\t\telse\n\t\t\t{\n\t\t\t\trecord.insert(make_pair(nums[i], i));\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n};\n```\n","source":"_posts/leetcode/2016-10-18-leetcode-chapter1.md","raw":"---\ntitle: 064leetcode(1)\ndate: 2016-10-18 18:21:29\ncategories: leetcode\ntags: [algorithm,c++,leetcode]\n---\n\n## 1. \n[Two Sum](https://leetcode.com/problems/two-sum/)\nnumstarget\nxyat (a[x]+a[y]==t)\n\n\n## 2. \n>  nums=[2,7,11,15], target=9\n>  nums[0] + nums[1] = 2 + 7 = 9\n>   [0,1]\n\n<!--more-->\n\n---\n\n## 3. \n### 3.1 \n#### 3.1.1 \n\n1. \n2. (`a[i]`)(`a[j]`)`sum`\n3. `sum``target`(`j -= 1`)24\n4. `sum``target`(`i += 1`)25\n5. `i``j`\n\n`map`\n\n#### 3.1.2 \n `O(nlogn)`\n `O(n)`\n\n#### 3.1.3 \n```cpp\nstruct Num {\n    int num;    //\n    int index;  //\n\n    bool operator<(const Num& rhs) {\n        return num < rhs.num;\n    }\n};\n\nclass Solution {\npublic:\n    vector<int> twoSum(vector<int>& nums, int target) {\n        vector<Num> numsWithIndex(nums.size());\n\n        // \n        for (int i = 0; i < nums.size(); ++i) {\n            numsWithIndex[i].num = nums[i];\n            numsWithIndex[i].index = i;\n        }\n\n        sort(numsWithIndex.begin(), numsWithIndex.end());\n\n        int smaller = 0;\n        int larger = numsWithIndex.size() - 1;\n        while (true) {\n            int sum = numsWithIndex[smaller].num + numsWithIndex[larger].num;\n            if (sum == target) {\n                break;\n            }\n\n            if (sum > target) {\n                --larger;\n            }\n            else {\n                ++smaller;\n            }\n        }\n\n        int indexa = numsWithIndex[smaller].index;\n        int indexb = numsWithIndex[larger].index;\n\n        // \n        vector<int> result;\n        if (indexa > indexb) {\n            result.push_back(indexb);\n            result.push_back(indexa);\n        }\n        else {\n            result.push_back(indexa);\n            result.push_back(indexb);\n        }\n        return result;\n    }\n};\n```\n\n---\n\n### 3.2 \n#### 3.2.1 \n\n1. `key``value``map`\n2. `a``target-a``map``target-a``a``map[target-a]`2\n\n#### 3.2.2 \n `O(n)`\n `O(n)`\n\n#### 3.2.3 \n```cpp\nclass Solution\n{\npublic:\n\tvector<int> twoSum(vector<int>& nums, int target) {\n\t\tvector<int> result;\n\t\tunordered_map<int, int> record;\n\t\tfor (int i = 0; i < nums.size(); ++i)\n\t\t{\n\t\t\tint to_find = target - nums[i];\n\t\t\tunordered_map<int, int>::iterator it = record.find(to_find);\n\t\t\tif (it != record.end())\n\t\t\t{\n\t\t\t\tresult.push_back(it->second);\n\t\t\t\tresult.push_back(i);\n\t\t\t\tbreak;\n\t\t\t} \n\t\t\telse\n\t\t\t{\n\t\t\t\trecord.insert(make_pair(nums[i], i));\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n};\n```\n","slug":"leetcode-2016-10-18-leetcode-chapter1","published":1,"updated":"2018-06-26T12:07:07.138Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtn600062gusm3dao6ax","content":"<h2 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h2><p><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">Two Sum</a><br>numstarget<br>xyat (a[x]+a[y]==t)<br></p>\n<h2 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h2><blockquote>\n<p> nums=[2,7,11,15], target=9<br> nums[0] + nums[1] = 2 + 7 = 9<br>  [0,1]</p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3. \"></a>3. </h2><h3 id=\"3-1-\"><a href=\"#3-1-\" class=\"headerlink\" title=\"3.1 \"></a>3.1 </h3><h4 id=\"3-1-1-\"><a href=\"#3-1-1-\" class=\"headerlink\" title=\"3.1.1 \"></a>3.1.1 </h4><p></p>\n<ol>\n<li></li>\n<li>(<code>a[i]</code>)(<code>a[j]</code>)<code>sum</code></li>\n<li><code>sum</code><code>target</code>(<code>j -= 1</code>)24</li>\n<li><code>sum</code><code>target</code>(<code>i += 1</code>)25</li>\n<li><code>i</code><code>j</code></li>\n</ol>\n<p><code>map</code></p>\n<h4 id=\"3-1-2-\"><a href=\"#3-1-2-\" class=\"headerlink\" title=\"3.1.2 \"></a>3.1.2 </h4><p> <code>O(nlogn)</code><br> <code>O(n)</code></p>\n<h4 id=\"3-1-3-\"><a href=\"#3-1-3-\" class=\"headerlink\" title=\"3.1.3 \"></a>3.1.3 </h4><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Num</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> num;    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> index;  <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Num&amp; rhs) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num &lt; rhs.num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; twoSum(<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt;&amp; nums, <span class=\"keyword\">int</span> target) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">vector</span>&lt;Num&gt; numsWithIndex(nums.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.size(); ++i) &#123;</span><br><span class=\"line\">            numsWithIndex[i].num = nums[i];</span><br><span class=\"line\">            numsWithIndex[i].index = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        sort(numsWithIndex.begin(), numsWithIndex.end());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> smaller = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> larger = numsWithIndex.size() - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> sum = numsWithIndex[smaller].num + numsWithIndex[larger].num;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sum == target) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sum &gt; target) &#123;</span><br><span class=\"line\">                --larger;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                ++smaller;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> indexa = numsWithIndex[smaller].index;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> indexb = numsWithIndex[larger].index;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; result;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (indexa &gt; indexb) &#123;</span><br><span class=\"line\">            result.push_back(indexb);</span><br><span class=\"line\">            result.push_back(indexa);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.push_back(indexa);</span><br><span class=\"line\">            result.push_back(indexb);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"3-2-\"><a href=\"#3-2-\" class=\"headerlink\" title=\"3.2 \"></a>3.2 </h3><h4 id=\"3-2-1-\"><a href=\"#3-2-1-\" class=\"headerlink\" title=\"3.2.1 \"></a>3.2.1 </h4><p></p>\n<ol>\n<li><code>key</code><code>value</code><code>map</code></li>\n<li><code>a</code><code>target-a</code><code>map</code><code>target-a</code><code>a</code><code>map[target-a]</code>2</li>\n</ol>\n<h4 id=\"3-2-2-\"><a href=\"#3-2-2-\" class=\"headerlink\" title=\"3.2.2 \"></a>3.2.2 </h4><p> <code>O(n)</code><br> <code>O(n)</code></p>\n<h4 id=\"3-2-3-\"><a href=\"#3-2-3-\" class=\"headerlink\" title=\"3.2.3 \"></a>3.2.3 </h4><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; twoSum(<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt;&amp; nums, <span class=\"keyword\">int</span> target) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; result;</span><br><span class=\"line\">\t\t<span class=\"built_in\">unordered_map</span>&lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&gt; record;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.size(); ++i)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> to_find = target - nums[i];</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">unordered_map</span>&lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&gt;::iterator it = record.find(to_find);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (it != record.end())</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tresult.push_back(it-&gt;second);</span><br><span class=\"line\">\t\t\t\tresult.push_back(i);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t&#125; </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\trecord.insert(make_pair(nums[i], i));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h2><p><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">Two Sum</a><br>numstarget<br>xyat (a[x]+a[y]==t)<br></p>\n<h2 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h2><blockquote>\n<p> nums=[2,7,11,15], target=9<br> nums[0] + nums[1] = 2 + 7 = 9<br>  [0,1]</p>\n</blockquote>","more":"<hr>\n<h2 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3. \"></a>3. </h2><h3 id=\"3-1-\"><a href=\"#3-1-\" class=\"headerlink\" title=\"3.1 \"></a>3.1 </h3><h4 id=\"3-1-1-\"><a href=\"#3-1-1-\" class=\"headerlink\" title=\"3.1.1 \"></a>3.1.1 </h4><p></p>\n<ol>\n<li></li>\n<li>(<code>a[i]</code>)(<code>a[j]</code>)<code>sum</code></li>\n<li><code>sum</code><code>target</code>(<code>j -= 1</code>)24</li>\n<li><code>sum</code><code>target</code>(<code>i += 1</code>)25</li>\n<li><code>i</code><code>j</code></li>\n</ol>\n<p><code>map</code></p>\n<h4 id=\"3-1-2-\"><a href=\"#3-1-2-\" class=\"headerlink\" title=\"3.1.2 \"></a>3.1.2 </h4><p> <code>O(nlogn)</code><br> <code>O(n)</code></p>\n<h4 id=\"3-1-3-\"><a href=\"#3-1-3-\" class=\"headerlink\" title=\"3.1.3 \"></a>3.1.3 </h4><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Num</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> num;    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> index;  <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Num&amp; rhs) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num &lt; rhs.num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; twoSum(<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt;&amp; nums, <span class=\"keyword\">int</span> target) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">vector</span>&lt;Num&gt; numsWithIndex(nums.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.size(); ++i) &#123;</span><br><span class=\"line\">            numsWithIndex[i].num = nums[i];</span><br><span class=\"line\">            numsWithIndex[i].index = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        sort(numsWithIndex.begin(), numsWithIndex.end());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> smaller = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> larger = numsWithIndex.size() - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> sum = numsWithIndex[smaller].num + numsWithIndex[larger].num;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sum == target) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sum &gt; target) &#123;</span><br><span class=\"line\">                --larger;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                ++smaller;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> indexa = numsWithIndex[smaller].index;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> indexb = numsWithIndex[larger].index;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; result;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (indexa &gt; indexb) &#123;</span><br><span class=\"line\">            result.push_back(indexb);</span><br><span class=\"line\">            result.push_back(indexa);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.push_back(indexa);</span><br><span class=\"line\">            result.push_back(indexb);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"3-2-\"><a href=\"#3-2-\" class=\"headerlink\" title=\"3.2 \"></a>3.2 </h3><h4 id=\"3-2-1-\"><a href=\"#3-2-1-\" class=\"headerlink\" title=\"3.2.1 \"></a>3.2.1 </h4><p></p>\n<ol>\n<li><code>key</code><code>value</code><code>map</code></li>\n<li><code>a</code><code>target-a</code><code>map</code><code>target-a</code><code>a</code><code>map[target-a]</code>2</li>\n</ol>\n<h4 id=\"3-2-2-\"><a href=\"#3-2-2-\" class=\"headerlink\" title=\"3.2.2 \"></a>3.2.2 </h4><p> <code>O(n)</code><br> <code>O(n)</code></p>\n<h4 id=\"3-2-3-\"><a href=\"#3-2-3-\" class=\"headerlink\" title=\"3.2.3 \"></a>3.2.3 </h4><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; twoSum(<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt;&amp; nums, <span class=\"keyword\">int</span> target) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; result;</span><br><span class=\"line\">\t\t<span class=\"built_in\">unordered_map</span>&lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&gt; record;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.size(); ++i)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> to_find = target - nums[i];</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">unordered_map</span>&lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&gt;::iterator it = record.find(to_find);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (it != record.end())</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tresult.push_back(it-&gt;second);</span><br><span class=\"line\">\t\t\t\tresult.push_back(i);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t&#125; </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\trecord.insert(make_pair(nums[i], i));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"064leetcode(2)","date":"2018-06-26T10:21:29.000Z","_content":"\n## 1. \n[](https://leetcode-cn.com/problems/add-two-numbers/description/)\n\n\n 0 \n\n## 2. \n> (2 -> 4 -> 3) + (5 -> 6 -> 4)\n> 7 -> 0 -> 8\n> 342 + 465 = 807\n\n<!--more-->\n\n---\n\n## 3. \n### 3.1 \n\n\n1. `l1``l2`\n2. `carry`0\n3. `l1``l2``node1``node2`\n4. `node1``node2``carry`0\n5. `node``nullptr``0``node->val``node1``node2``val1``val2`\n6. `val1+val2+carry``result`\n7. `10``10``mod``val``mod``10``carry`3\n8. `10``0``val``result``carry`03\n\n### 3.2 \n `O(m+n)`\n `O(m+n)`\n\n### 3.3 \n```cpp\nclass Solution {\npublic:\n    ListNode* addTwoNumbers(ListNode* l1, ListNode* l2) {\n        if (l1 == nullptr) return l2;\n        if (l2 == nullptr) return l1;\n\n        int carry = 0;\n        ListNode* result = nullptr;\n        ListNode* prev = nullptr;\n\n        ListNode* node1 = l1;\n        ListNode* node2 = l2;\n        while (node1 != nullptr || node2 != nullptr || carry != 0) {\n            int val1 = (node1 == nullptr ? 0 : node1->val);\n            int val2 = (node2 == nullptr ? 0 : node2->val);\n            int sum = val1 + val2 + carry;\n            int val = sum % 10;\n            carry = sum / 10;\n            ListNode* node = new ListNode(val);\n            if (prev == nullptr) {\n                result = node;\n            } else {\n                prev->next = node;\n            }\n\n            prev = node;\n            node1 = (node1 != nullptr ? node1->next : nullptr);\n            node2 = (node1 != nullptr ? node2->next : nullptr);\n        }\n\n        return result;\n    }\n};\n```\n","source":"_posts/leetcode/2018-06-26-leetcode-chapter2.md","raw":"---\ntitle: 064leetcode(2)\ndate: 2018-06-26 18:21:29\ncategories: leetcode\ntags: [algorithm,c++,leetcode]\n---\n\n## 1. \n[](https://leetcode-cn.com/problems/add-two-numbers/description/)\n\n\n 0 \n\n## 2. \n> (2 -> 4 -> 3) + (5 -> 6 -> 4)\n> 7 -> 0 -> 8\n> 342 + 465 = 807\n\n<!--more-->\n\n---\n\n## 3. \n### 3.1 \n\n\n1. `l1``l2`\n2. `carry`0\n3. `l1``l2``node1``node2`\n4. `node1``node2``carry`0\n5. `node``nullptr``0``node->val``node1``node2``val1``val2`\n6. `val1+val2+carry``result`\n7. `10``10``mod``val``mod``10``carry`3\n8. `10``0``val``result``carry`03\n\n### 3.2 \n `O(m+n)`\n `O(m+n)`\n\n### 3.3 \n```cpp\nclass Solution {\npublic:\n    ListNode* addTwoNumbers(ListNode* l1, ListNode* l2) {\n        if (l1 == nullptr) return l2;\n        if (l2 == nullptr) return l1;\n\n        int carry = 0;\n        ListNode* result = nullptr;\n        ListNode* prev = nullptr;\n\n        ListNode* node1 = l1;\n        ListNode* node2 = l2;\n        while (node1 != nullptr || node2 != nullptr || carry != 0) {\n            int val1 = (node1 == nullptr ? 0 : node1->val);\n            int val2 = (node2 == nullptr ? 0 : node2->val);\n            int sum = val1 + val2 + carry;\n            int val = sum % 10;\n            carry = sum / 10;\n            ListNode* node = new ListNode(val);\n            if (prev == nullptr) {\n                result = node;\n            } else {\n                prev->next = node;\n            }\n\n            prev = node;\n            node1 = (node1 != nullptr ? node1->next : nullptr);\n            node2 = (node1 != nullptr ? node2->next : nullptr);\n        }\n\n        return result;\n    }\n};\n```\n","slug":"leetcode-2018-06-26-leetcode-chapter2","published":1,"updated":"2018-06-26T12:05:03.446Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtn800072gustgla2oc0","content":"<h2 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h2><p><a href=\"https://leetcode-cn.com/problems/add-two-numbers/description/\" target=\"_blank\" rel=\"noopener\"></a><br></p>\n<p> 0 </p>\n<h2 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h2><blockquote>\n<p>(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>7 -&gt; 0 -&gt; 8<br>342 + 465 = 807</p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3. \"></a>3. </h2><h3 id=\"3-1-\"><a href=\"#3-1-\" class=\"headerlink\" title=\"3.1 \"></a>3.1 </h3><p></p>\n<ol>\n<li><code>l1</code><code>l2</code></li>\n<li><code>carry</code>0</li>\n<li><code>l1</code><code>l2</code><code>node1</code><code>node2</code></li>\n<li><code>node1</code><code>node2</code><code>carry</code>0</li>\n<li><code>node</code><code>nullptr</code><code>0</code><code>node-&gt;val</code><code>node1</code><code>node2</code><code>val1</code><code>val2</code></li>\n<li><code>val1+val2+carry</code><code>result</code></li>\n<li><code>10</code><code>10</code><code>mod</code><code>val</code><code>mod</code><code>10</code><code>carry</code>3</li>\n<li><code>10</code><code>0</code><code>val</code><code>result</code><code>carry</code>03</li>\n</ol>\n<h3 id=\"3-2-\"><a href=\"#3-2-\" class=\"headerlink\" title=\"3.2 \"></a>3.2 </h3><p> <code>O(m+n)</code><br> <code>O(m+n)</code></p>\n<h3 id=\"3-3-\"><a href=\"#3-3-\" class=\"headerlink\" title=\"3.3 \"></a>3.3 </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">ListNode* <span class=\"title\">addTwoNumbers</span><span class=\"params\">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (l1 == <span class=\"literal\">nullptr</span>) <span class=\"keyword\">return</span> l2;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (l2 == <span class=\"literal\">nullptr</span>) <span class=\"keyword\">return</span> l1;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">        ListNode* result = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        ListNode* prev = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ListNode* node1 = l1;</span><br><span class=\"line\">        ListNode* node2 = l2;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (node1 != <span class=\"literal\">nullptr</span> || node2 != <span class=\"literal\">nullptr</span> || carry != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val1 = (node1 == <span class=\"literal\">nullptr</span> ? <span class=\"number\">0</span> : node1-&gt;val);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val2 = (node2 == <span class=\"literal\">nullptr</span> ? <span class=\"number\">0</span> : node2-&gt;val);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> sum = val1 + val2 + carry;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val = sum % <span class=\"number\">10</span>;</span><br><span class=\"line\">            carry = sum / <span class=\"number\">10</span>;</span><br><span class=\"line\">            ListNode* node = <span class=\"keyword\">new</span> ListNode(val);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev == <span class=\"literal\">nullptr</span>) &#123;</span><br><span class=\"line\">                result = node;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                prev-&gt;next = node;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            prev = node;</span><br><span class=\"line\">            node1 = (node1 != <span class=\"literal\">nullptr</span> ? node1-&gt;next : <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">            node2 = (node1 != <span class=\"literal\">nullptr</span> ? node2-&gt;next : <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h2><p><a href=\"https://leetcode-cn.com/problems/add-two-numbers/description/\" target=\"_blank\" rel=\"noopener\"></a><br></p>\n<p> 0 </p>\n<h2 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h2><blockquote>\n<p>(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>7 -&gt; 0 -&gt; 8<br>342 + 465 = 807</p>\n</blockquote>","more":"<hr>\n<h2 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3. \"></a>3. </h2><h3 id=\"3-1-\"><a href=\"#3-1-\" class=\"headerlink\" title=\"3.1 \"></a>3.1 </h3><p></p>\n<ol>\n<li><code>l1</code><code>l2</code></li>\n<li><code>carry</code>0</li>\n<li><code>l1</code><code>l2</code><code>node1</code><code>node2</code></li>\n<li><code>node1</code><code>node2</code><code>carry</code>0</li>\n<li><code>node</code><code>nullptr</code><code>0</code><code>node-&gt;val</code><code>node1</code><code>node2</code><code>val1</code><code>val2</code></li>\n<li><code>val1+val2+carry</code><code>result</code></li>\n<li><code>10</code><code>10</code><code>mod</code><code>val</code><code>mod</code><code>10</code><code>carry</code>3</li>\n<li><code>10</code><code>0</code><code>val</code><code>result</code><code>carry</code>03</li>\n</ol>\n<h3 id=\"3-2-\"><a href=\"#3-2-\" class=\"headerlink\" title=\"3.2 \"></a>3.2 </h3><p> <code>O(m+n)</code><br> <code>O(m+n)</code></p>\n<h3 id=\"3-3-\"><a href=\"#3-3-\" class=\"headerlink\" title=\"3.3 \"></a>3.3 </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">ListNode* <span class=\"title\">addTwoNumbers</span><span class=\"params\">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (l1 == <span class=\"literal\">nullptr</span>) <span class=\"keyword\">return</span> l2;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (l2 == <span class=\"literal\">nullptr</span>) <span class=\"keyword\">return</span> l1;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">        ListNode* result = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        ListNode* prev = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ListNode* node1 = l1;</span><br><span class=\"line\">        ListNode* node2 = l2;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (node1 != <span class=\"literal\">nullptr</span> || node2 != <span class=\"literal\">nullptr</span> || carry != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val1 = (node1 == <span class=\"literal\">nullptr</span> ? <span class=\"number\">0</span> : node1-&gt;val);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val2 = (node2 == <span class=\"literal\">nullptr</span> ? <span class=\"number\">0</span> : node2-&gt;val);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> sum = val1 + val2 + carry;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> val = sum % <span class=\"number\">10</span>;</span><br><span class=\"line\">            carry = sum / <span class=\"number\">10</span>;</span><br><span class=\"line\">            ListNode* node = <span class=\"keyword\">new</span> ListNode(val);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev == <span class=\"literal\">nullptr</span>) &#123;</span><br><span class=\"line\">                result = node;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                prev-&gt;next = node;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            prev = node;</span><br><span class=\"line\">            node1 = (node1 != <span class=\"literal\">nullptr</span> ? node1-&gt;next : <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">            node2 = (node1 != <span class=\"literal\">nullptr</span> ? node2-&gt;next : <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"WinDBG","date":"2016-04-10T04:19:11.000Z","_content":"\n## \nqqXXC++XXXX:API CallerbugAPI CallerProgrammerresearcherarchitectWinDBGWinDBGwindowsVisual Studio 2005WinDBGWinDBG\n<!--more-->\n## \nHello, World!\n\n\n```cpp\nvoid TestFunc()\n{\n    int a = 10;\n    int b = 20;\n\n    int c = a + b;\n\n    int d = a + 30;\n\n    int e = 1 + 3;\n}\n\nint main(int argc, char** argv)\n{\n    TestFunc();\n    return 0;\n}\n```\n`include`Hello, World!\n* \n* \n* exeexe\n* exe\n\nC++\n\nVS\n\n## \nDebugWinDBG`Ctrl+S`\n```\nD:\\localsymbols;SRV*D:\\localsymbols*http://msdl.microsoft.com/download/symbols;\n```\n`Ctrl+E`WinDBG\n{% asset_img runexe.png  %}\n\nmain\n```\nbp HelloWorld2005!main\n```\n\nHelloWorld2005exe\n\ngWinDBGmain`Alt+7`\n\nDebugSource ModeWinDBG\n{% asset_img sourcemode.png Source Mode %}\n\nVSF10Step OverF11Step Into,Shift+F11Step OutHelloWorld2005!mainretmain\n{% asset_img disassembly.png  %}\n\n\n```\npush ebp\n```\n\n* \n* ebp\n\n\n\n`push ebp`ebpWinDBG\n{% asset_img registers.png  %}\n\nebp0019ff78(Windbg0xh)\n\npushebpC++newpush espebpF10\n{% asset_img pushebp.png push ebp %}\n\neipesp\n\neip8exe\n\nesp0019ff2c0019ff284ebp0019ff78esp\n1. esp-4\n2. [esp]=ebp\n\nWindbg`dd 0019ff28`0019ff28`dd esp`\n{% asset_img pushresult.png push result %}\n\nebpebp`pop ebp`\n\nebpTestFunc`bp HelloWorld2005!TestFunc`gTestFunc\n{% asset_img testfuncsource.png TestFunc disassembly %}\n\nkbn\n{% asset_img callstack.png Callstack %}\n\n\n* \n* \n* \n* \n\n\n1. ChildEBP: \n2. RetAddr: \n3. Args to Child: \n4. \n\nChildEBPebpebp\n```cpp\nvoid func1()\n{\n  int a;\n  int b;\n}\n\nvoid func2()\n{\n  int a;\n  int b;\n  func1();\n}\n\nint main()\n{\n  int a;\n  int b;\n  func2();\n  return 0;\n}\n```\n\n{% asset_img callstackstatus.png  %}\n\n\n\n\n```\npush ebp\nmov ebp, esp\n```\n\n\n1. \n2. \n\nespTestFunc\n```\nsub esp, 0FCh\n```\n\nesp0x0FCebp~espTestFunc\n\npushpop\n```\npush ebx\npush esi\npush edi\n```\n\nesp3*4=0chespediesp+4esiesp+8ebx\n{% asset_img pushebxesiedi.png esp %}\n\n\n{% asset_img stackmemory.png  %}\n\n(ebp-0fch)~ebp\n```\nlea edi, [ebp-0FCh]\nmov ecx, 3Fh\nmov eax, 0CCCCCCCCh\nrep stos dword ptr es:[edi]\n```\n\ngooglerep stoses:ediDWORD0CCCCCCCCh(eax)3F(ecx)edi4ecx13F*4=FCccint 3windowsint 3es:edies:ediedi\n\necxedi:\n{% asset_img afterrepstos.png rep stos %}\n\necx0edi0019fe54ebp\n```cpp\nwhile (ecx > 0)\n{\n  * esi = eax;\n  esi += 4;\n  ecx--;\n}\n```\n\ndd`alt+5`MemoryVirtualediebp-0fch\n{% asset_img afterrepstosmem.png rep stos %}\n\n(ebp-0fch)~ebp0CCCCCCCCh\n\n`int a = 10;`a10aaNoa[ebp-8]DWORDwindowsDWORD4exe`int a = 10;``mov dword ptr [ebp-8], 0Ah`[ebp-8]\n{% asset_img aftera10.png int a = 10 %}\n\n4......\n\n`int b = 20;`8\n\n`int c = a + b;`\n```\nmov eax, dword ptr [ebp-8]\nadd eax, dword ptr [ebp-14h]\nmov dword ptr [ebp-20h], eax\n```\n\n`dword ptr [ebp-8]`eaxaddabebp-20h`int d = a + 30;`\n{% asset_img afterda30.png int d= a + 30 %}\n\n`int e = 1 + 3;``mov dword ptr [ebp-38h], 4`1+3\n\n\n\npush\n```\npop edi\npop esi\npop ebx\n```\n\n\n\n\n```\nmov esp, ebp\n```\nebpesp\n\n`pop ebp``push ebp`\n\nTestFuncmainTestFunc\n{% asset_img checkesp.png ESP %}\n\nebpespesp-0C0hesp-0c0hebp\n\n\n\n\n## \n\n### WinDBG\n1. dp ! F10F11Shift+F11\n2. alt+7 \n3. alt+5 \n4. dd  \n5. kbn \n\n### \n1. ebpespebpespebp\n2. ebpesppushpopesp\n3. rep stoseaxecxeax1\n4. \n","source":"_posts/windbg/windbg-chapter1.md","raw":"---\ntitle: WinDBG\ndate: 2016-04-10 12:19:11\ncategories: windbg\ntags: [windbg,disassembly,c++]\n---\n\n## \nqqXXC++XXXX:API CallerbugAPI CallerProgrammerresearcherarchitectWinDBGWinDBGwindowsVisual Studio 2005WinDBGWinDBG\n<!--more-->\n## \nHello, World!\n\n\n```cpp\nvoid TestFunc()\n{\n    int a = 10;\n    int b = 20;\n\n    int c = a + b;\n\n    int d = a + 30;\n\n    int e = 1 + 3;\n}\n\nint main(int argc, char** argv)\n{\n    TestFunc();\n    return 0;\n}\n```\n`include`Hello, World!\n* \n* \n* exeexe\n* exe\n\nC++\n\nVS\n\n## \nDebugWinDBG`Ctrl+S`\n```\nD:\\localsymbols;SRV*D:\\localsymbols*http://msdl.microsoft.com/download/symbols;\n```\n`Ctrl+E`WinDBG\n{% asset_img runexe.png  %}\n\nmain\n```\nbp HelloWorld2005!main\n```\n\nHelloWorld2005exe\n\ngWinDBGmain`Alt+7`\n\nDebugSource ModeWinDBG\n{% asset_img sourcemode.png Source Mode %}\n\nVSF10Step OverF11Step Into,Shift+F11Step OutHelloWorld2005!mainretmain\n{% asset_img disassembly.png  %}\n\n\n```\npush ebp\n```\n\n* \n* ebp\n\n\n\n`push ebp`ebpWinDBG\n{% asset_img registers.png  %}\n\nebp0019ff78(Windbg0xh)\n\npushebpC++newpush espebpF10\n{% asset_img pushebp.png push ebp %}\n\neipesp\n\neip8exe\n\nesp0019ff2c0019ff284ebp0019ff78esp\n1. esp-4\n2. [esp]=ebp\n\nWindbg`dd 0019ff28`0019ff28`dd esp`\n{% asset_img pushresult.png push result %}\n\nebpebp`pop ebp`\n\nebpTestFunc`bp HelloWorld2005!TestFunc`gTestFunc\n{% asset_img testfuncsource.png TestFunc disassembly %}\n\nkbn\n{% asset_img callstack.png Callstack %}\n\n\n* \n* \n* \n* \n\n\n1. ChildEBP: \n2. RetAddr: \n3. Args to Child: \n4. \n\nChildEBPebpebp\n```cpp\nvoid func1()\n{\n  int a;\n  int b;\n}\n\nvoid func2()\n{\n  int a;\n  int b;\n  func1();\n}\n\nint main()\n{\n  int a;\n  int b;\n  func2();\n  return 0;\n}\n```\n\n{% asset_img callstackstatus.png  %}\n\n\n\n\n```\npush ebp\nmov ebp, esp\n```\n\n\n1. \n2. \n\nespTestFunc\n```\nsub esp, 0FCh\n```\n\nesp0x0FCebp~espTestFunc\n\npushpop\n```\npush ebx\npush esi\npush edi\n```\n\nesp3*4=0chespediesp+4esiesp+8ebx\n{% asset_img pushebxesiedi.png esp %}\n\n\n{% asset_img stackmemory.png  %}\n\n(ebp-0fch)~ebp\n```\nlea edi, [ebp-0FCh]\nmov ecx, 3Fh\nmov eax, 0CCCCCCCCh\nrep stos dword ptr es:[edi]\n```\n\ngooglerep stoses:ediDWORD0CCCCCCCCh(eax)3F(ecx)edi4ecx13F*4=FCccint 3windowsint 3es:edies:ediedi\n\necxedi:\n{% asset_img afterrepstos.png rep stos %}\n\necx0edi0019fe54ebp\n```cpp\nwhile (ecx > 0)\n{\n  * esi = eax;\n  esi += 4;\n  ecx--;\n}\n```\n\ndd`alt+5`MemoryVirtualediebp-0fch\n{% asset_img afterrepstosmem.png rep stos %}\n\n(ebp-0fch)~ebp0CCCCCCCCh\n\n`int a = 10;`a10aaNoa[ebp-8]DWORDwindowsDWORD4exe`int a = 10;``mov dword ptr [ebp-8], 0Ah`[ebp-8]\n{% asset_img aftera10.png int a = 10 %}\n\n4......\n\n`int b = 20;`8\n\n`int c = a + b;`\n```\nmov eax, dword ptr [ebp-8]\nadd eax, dword ptr [ebp-14h]\nmov dword ptr [ebp-20h], eax\n```\n\n`dword ptr [ebp-8]`eaxaddabebp-20h`int d = a + 30;`\n{% asset_img afterda30.png int d= a + 30 %}\n\n`int e = 1 + 3;``mov dword ptr [ebp-38h], 4`1+3\n\n\n\npush\n```\npop edi\npop esi\npop ebx\n```\n\n\n\n\n```\nmov esp, ebp\n```\nebpesp\n\n`pop ebp``push ebp`\n\nTestFuncmainTestFunc\n{% asset_img checkesp.png ESP %}\n\nebpespesp-0C0hesp-0c0hebp\n\n\n\n\n## \n\n### WinDBG\n1. dp ! F10F11Shift+F11\n2. alt+7 \n3. alt+5 \n4. dd  \n5. kbn \n\n### \n1. ebpespebpespebp\n2. ebpesppushpopesp\n3. rep stoseaxecxeax1\n4. \n","slug":"windbg-windbg-chapter1","published":1,"updated":"2018-06-25T11:14:49.163Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtnc00082guslinn7z4f","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>qqXXC++XXXX:API CallerbugAPI CallerProgrammerresearcherarchitectWinDBGWinDBGwindowsVisual Studio 2005WinDBGWinDBG<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Hello, World!</p>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestFunc</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> c = a + b;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> d = a + <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> e = <span class=\"number\">1</span> + <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestFunc();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>include</code>Hello, World!</p>\n<ul>\n<li></li>\n<li></li>\n<li>exeexe</li>\n<li>exe</li>\n</ul>\n<p>C++</p>\n<p>VS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>DebugWinDBG<code>Ctrl+S</code><br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">D:</span>\\localsymbols;SRV*<span class=\"string\">D:</span>\\localsymbols*<span class=\"string\">http:</span><span class=\"comment\">//msdl.microsoft.com/download/symbols;</span></span><br></pre></td></tr></table></figure></p>\n<p><code>Ctrl+E</code>WinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/runexe.png\" title=\"\"></p>\n<p>main<br><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">bp </span>HelloWorld2005!main</span><br></pre></td></tr></table></figure></p>\n<p>HelloWorld2005exe</p>\n<p>gWinDBGmain<code>Alt+7</code></p>\n<p>DebugSource ModeWinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/sourcemode.png\" title=\"Source Mode\"></p>\n<p>VSF10Step OverF11Step Into,Shift+F11Step OutHelloWorld2005!mainretmain<br><img src=\"/2016/04/10/windbg-windbg-chapter1/disassembly.png\" title=\"\"></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebp</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ul>\n<li></li>\n<li>ebp</li>\n</ul>\n<p></p>\n<p><code>push ebp</code>ebpWinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/registers.png\" title=\"\"></p>\n<p>ebp0019ff78(Windbg0xh)</p>\n<p>pushebpC++newpush espebpF10<br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushebp.png\" title=\"push ebp\"></p>\n<p>eipesp</p>\n<p>eip8exe</p>\n<p>esp0019ff2c0019ff284ebp0019ff78esp</p>\n<ol>\n<li>esp-4</li>\n<li>[esp]=ebp</li>\n</ol>\n<p>Windbg<code>dd 0019ff28</code>0019ff28<code>dd esp</code><br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushresult.png\" title=\"push result\"></p>\n<p>ebpebp<code>pop ebp</code></p>\n<p>ebpTestFunc<code>bp HelloWorld2005!TestFunc</code>gTestFunc<br><img src=\"/2016/04/10/windbg-windbg-chapter1/testfuncsource.png\" title=\"TestFunc disassembly\"></p>\n<p>kbn<br><img src=\"/2016/04/10/windbg-windbg-chapter1/callstack.png\" title=\"Callstack\"></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ol>\n<li>ChildEBP: </li>\n<li>RetAddr: </li>\n<li>Args to Child: </li>\n<li></li>\n</ol>\n<p>ChildEBPebpebp<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">  func1();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">  func2();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><img src=\"/2016/04/10/windbg-windbg-chapter1/callstackstatus.png\" title=\"\"></p>\n<p></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebp</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">ebp</span>, <span class=\"built_in\">esp</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p>espTestFunc<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">sub</span> <span class=\"built_in\">esp</span>, <span class=\"number\">0FCh</span></span><br></pre></td></tr></table></figure></p>\n<p>esp0x0FCebp~espTestFunc</p>\n<p>pushpop<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebx</span></span><br><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">esi</span></span><br><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">edi</span></span><br></pre></td></tr></table></figure></p>\n<p>esp3*4=0chespediesp+4esiesp+8ebx<br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushebxesiedi.png\" title=\"esp\"></p>\n<p><br><img src=\"/2016/04/10/windbg-windbg-chapter1/stackmemory.png\" title=\"\"></p>\n<p>(ebp-0fch)~ebp<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">lea</span> <span class=\"built_in\">edi</span>, [<span class=\"built_in\">ebp</span>-<span class=\"number\">0FCh</span>]</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">ecx</span>, <span class=\"number\">3Fh</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"number\">0CCCCCCCCh</span></span><br><span class=\"line\"><span class=\"keyword\">rep</span> stos <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> <span class=\"built_in\">es</span>:[<span class=\"built_in\">edi</span>]</span><br></pre></td></tr></table></figure></p>\n<p>googlerep stoses:ediDWORD0CCCCCCCCh(eax)3F(ecx)edi4ecx13F*4=FCccint 3windowsint 3es:edies:ediedi</p>\n<p>ecxedi:<br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterrepstos.png\" title=\"rep stos\"></p>\n<p>ecx0edi0019fe54ebp<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (ecx &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  * esi = eax;</span><br><span class=\"line\">  esi += <span class=\"number\">4</span>;</span><br><span class=\"line\">  ecx--;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>dd<code>alt+5</code>MemoryVirtualediebp-0fch<br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterrepstosmem.png\" title=\"rep stos\"></p>\n<p>(ebp-0fch)~ebp0CCCCCCCCh</p>\n<p><code>int a = 10;</code>a10aaNoa[ebp-8]DWORDwindowsDWORD4exe<code>int a = 10;</code><code>mov dword ptr [ebp-8], 0Ah</code>[ebp-8]<br><img src=\"/2016/04/10/windbg-windbg-chapter1/aftera10.png\" title=\"int a = 10\"></p>\n<p>4</p>\n<p><code>int b = 20;</code>8</p>\n<p><code>int c = a + b;</code><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"keyword\">add</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">14h</span>]</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">20h</span>], <span class=\"built_in\">eax</span></span><br></pre></td></tr></table></figure></p>\n<p><code>dword ptr [ebp-8]</code>eaxaddabebp-20h<code>int d = a + 30;</code><br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterda30.png\" title=\"int d= a + 30\"></p>\n<p><code>int e = 1 + 3;</code><code>mov dword ptr [ebp-38h], 4</code>1+3</p>\n<p></p>\n<p>push<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">edi</span></span><br><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">esi</span></span><br><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">ebx</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">esp</span>, <span class=\"built_in\">ebp</span></span><br></pre></td></tr></table></figure></p>\n<p>ebpesp</p>\n<p><code>pop ebp</code><code>push ebp</code></p>\n<p>TestFuncmainTestFunc<br><img src=\"/2016/04/10/windbg-windbg-chapter1/checkesp.png\" title=\"ESP\"></p>\n<p>ebpespesp-0C0hesp-0c0hebp</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><ol>\n<li>dp ! F10F11Shift+F11</li>\n<li>alt+7 </li>\n<li>alt+5 </li>\n<li>dd  </li>\n<li>kbn </li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>ebpespebpespebp</li>\n<li>ebpesppushpopesp</li>\n<li>rep stoseaxecxeax1</li>\n<li></li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>qqXXC++XXXX:API CallerbugAPI CallerProgrammerresearcherarchitectWinDBGWinDBGwindowsVisual Studio 2005WinDBGWinDBG<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Hello, World!</p>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestFunc</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> c = a + b;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> d = a + <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> e = <span class=\"number\">1</span> + <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestFunc();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>include</code>Hello, World!</p>\n<ul>\n<li></li>\n<li></li>\n<li>exeexe</li>\n<li>exe</li>\n</ul>\n<p>C++</p>\n<p>VS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>DebugWinDBG<code>Ctrl+S</code><br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">D:</span>\\localsymbols;SRV*<span class=\"string\">D:</span>\\localsymbols*<span class=\"string\">http:</span><span class=\"comment\">//msdl.microsoft.com/download/symbols;</span></span><br></pre></td></tr></table></figure></p>\n<p><code>Ctrl+E</code>WinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/runexe.png\" title=\"\"></p>\n<p>main<br><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">bp </span>HelloWorld2005!main</span><br></pre></td></tr></table></figure></p>\n<p>HelloWorld2005exe</p>\n<p>gWinDBGmain<code>Alt+7</code></p>\n<p>DebugSource ModeWinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/sourcemode.png\" title=\"Source Mode\"></p>\n<p>VSF10Step OverF11Step Into,Shift+F11Step OutHelloWorld2005!mainretmain<br><img src=\"/2016/04/10/windbg-windbg-chapter1/disassembly.png\" title=\"\"></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebp</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ul>\n<li></li>\n<li>ebp</li>\n</ul>\n<p></p>\n<p><code>push ebp</code>ebpWinDBG<br><img src=\"/2016/04/10/windbg-windbg-chapter1/registers.png\" title=\"\"></p>\n<p>ebp0019ff78(Windbg0xh)</p>\n<p>pushebpC++newpush espebpF10<br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushebp.png\" title=\"push ebp\"></p>\n<p>eipesp</p>\n<p>eip8exe</p>\n<p>esp0019ff2c0019ff284ebp0019ff78esp</p>\n<ol>\n<li>esp-4</li>\n<li>[esp]=ebp</li>\n</ol>\n<p>Windbg<code>dd 0019ff28</code>0019ff28<code>dd esp</code><br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushresult.png\" title=\"push result\"></p>\n<p>ebpebp<code>pop ebp</code></p>\n<p>ebpTestFunc<code>bp HelloWorld2005!TestFunc</code>gTestFunc<br><img src=\"/2016/04/10/windbg-windbg-chapter1/testfuncsource.png\" title=\"TestFunc disassembly\"></p>\n<p>kbn<br><img src=\"/2016/04/10/windbg-windbg-chapter1/callstack.png\" title=\"Callstack\"></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ol>\n<li>ChildEBP: </li>\n<li>RetAddr: </li>\n<li>Args to Child: </li>\n<li></li>\n</ol>\n<p>ChildEBPebpebp<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">  func1();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">  func2();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><img src=\"/2016/04/10/windbg-windbg-chapter1/callstackstatus.png\" title=\"\"></p>\n<p></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebp</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">ebp</span>, <span class=\"built_in\">esp</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p>espTestFunc<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">sub</span> <span class=\"built_in\">esp</span>, <span class=\"number\">0FCh</span></span><br></pre></td></tr></table></figure></p>\n<p>esp0x0FCebp~espTestFunc</p>\n<p>pushpop<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">ebx</span></span><br><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">esi</span></span><br><span class=\"line\"><span class=\"keyword\">push</span> <span class=\"built_in\">edi</span></span><br></pre></td></tr></table></figure></p>\n<p>esp3*4=0chespediesp+4esiesp+8ebx<br><img src=\"/2016/04/10/windbg-windbg-chapter1/pushebxesiedi.png\" title=\"esp\"></p>\n<p><br><img src=\"/2016/04/10/windbg-windbg-chapter1/stackmemory.png\" title=\"\"></p>\n<p>(ebp-0fch)~ebp<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">lea</span> <span class=\"built_in\">edi</span>, [<span class=\"built_in\">ebp</span>-<span class=\"number\">0FCh</span>]</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">ecx</span>, <span class=\"number\">3Fh</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"number\">0CCCCCCCCh</span></span><br><span class=\"line\"><span class=\"keyword\">rep</span> stos <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> <span class=\"built_in\">es</span>:[<span class=\"built_in\">edi</span>]</span><br></pre></td></tr></table></figure></p>\n<p>googlerep stoses:ediDWORD0CCCCCCCCh(eax)3F(ecx)edi4ecx13F*4=FCccint 3windowsint 3es:edies:ediedi</p>\n<p>ecxedi:<br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterrepstos.png\" title=\"rep stos\"></p>\n<p>ecx0edi0019fe54ebp<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (ecx &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  * esi = eax;</span><br><span class=\"line\">  esi += <span class=\"number\">4</span>;</span><br><span class=\"line\">  ecx--;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>dd<code>alt+5</code>MemoryVirtualediebp-0fch<br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterrepstosmem.png\" title=\"rep stos\"></p>\n<p>(ebp-0fch)~ebp0CCCCCCCCh</p>\n<p><code>int a = 10;</code>a10aaNoa[ebp-8]DWORDwindowsDWORD4exe<code>int a = 10;</code><code>mov dword ptr [ebp-8], 0Ah</code>[ebp-8]<br><img src=\"/2016/04/10/windbg-windbg-chapter1/aftera10.png\" title=\"int a = 10\"></p>\n<p>4</p>\n<p><code>int b = 20;</code>8</p>\n<p><code>int c = a + b;</code><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"keyword\">add</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">14h</span>]</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">dword</span> <span class=\"built_in\">ptr</span> [<span class=\"built_in\">ebp</span>-<span class=\"number\">20h</span>], <span class=\"built_in\">eax</span></span><br></pre></td></tr></table></figure></p>\n<p><code>dword ptr [ebp-8]</code>eaxaddabebp-20h<code>int d = a + 30;</code><br><img src=\"/2016/04/10/windbg-windbg-chapter1/afterda30.png\" title=\"int d= a + 30\"></p>\n<p><code>int e = 1 + 3;</code><code>mov dword ptr [ebp-38h], 4</code>1+3</p>\n<p></p>\n<p>push<br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">edi</span></span><br><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">esi</span></span><br><span class=\"line\"><span class=\"keyword\">pop</span> <span class=\"built_in\">ebx</span></span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">esp</span>, <span class=\"built_in\">ebp</span></span><br></pre></td></tr></table></figure></p>\n<p>ebpesp</p>\n<p><code>pop ebp</code><code>push ebp</code></p>\n<p>TestFuncmainTestFunc<br><img src=\"/2016/04/10/windbg-windbg-chapter1/checkesp.png\" title=\"ESP\"></p>\n<p>ebpespesp-0C0hesp-0c0hebp</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><ol>\n<li>dp ! F10F11Shift+F11</li>\n<li>alt+7 </li>\n<li>alt+5 </li>\n<li>dd  </li>\n<li>kbn </li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>ebpespebpespebp</li>\n<li>ebpesppushpopesp</li>\n<li>rep stoseaxecxeax1</li>\n<li></li>\n</ol>"},{"title":"WinDBG","date":"2016-04-20T16:48:07.000Z","_content":"\n## \nrelease\n<!--more-->\n## \n\n```cpp\nclass SimpleClass\n{\npublic:\n    SimpleClass(int m)\n        : a(m)\n    {\n        b = 3;\n    }\n\n    SimpleClass(const SimpleClass& rhs)\n        : a(rhs.a)\n        , b(rhs.b)\n    {\n\n    }\n\n    ~SimpleClass()\n    {\n\n    }\n\npublic:\n    void TestMemberFunc()\n    {\n        a += b;\n    }\n\n    void TestConstMemberFunc() const\n    {\n        int m = a;\n        m += b;\n    }\n\npublic:\n    virtual void TestVirtual(int m)\n    {\n        a += m;\n    }\n\npublic:\n    static int TestStatic(int m, int n)\n    {\n        return m + n;\n    }\n\nprivate:\n    int a;\n    int b;\n\nprivate:\n    static const char* str;\n};\n\nconst char* SimpleClass::str = \"joker\";\n\nSimpleClass k(12);\n\nint main(int argc, char** argv)\n{\n    SimpleClass j = 233;\n    SimpleClass k = ::k;\n    SimpleClass a(k);\n\n    k.TestMemberFunc();\n    k.TestConstMemberFunc();\n\n    a.TestVirtual(14);\n\n    int d = SimpleClass::TestStatic(12, 13);\n\n    return 0;\n}\n```\n\n\n1. \n2. \n3. \n4. \n5. \n6. \n7. \n8. const\n9. \n10. \n\n\n\n`bp HelloWorld2005!SimpleClass::SimpleClass`WinDBG`SimpleClass`\n{% asset_img SetConstructorBreakPoint.png  %}\n\nWinDBG`bp 00401140``g`\n{% asset_img HitConstructorBreakPoint.png  %}\n\n`kbn`\n{% asset_img GlobalVarCallStack.png  %}\n\n`_initterm``dynamic initializer for 'k'`kSimpleClass k(12)_initterm`Ctrl+Shift+F5``bp MSVCR80D!_initterm``g`\n{% asset_img InInitTermFunction.png _initterm %}\n\n\n```asm\nmov eax, dword ptr [ebp+8]\ncmp eax, dword ptr [ebp+0Ch]\njae MSVCR80D!_initterm+0x25\n```\n\n`ebp+8`DWORD`ebp+0Ch`DWORD`_initterm``cmp`WinDBG`Alt+4`\n{% asset_img AllRegisters.png  %}\n\n`cmp``cf`carry flag`zf`zero flag`cmp`\n{% asset_img CmpResult.png cmp %}\n\n`cmp`\n{% asset_img AfterCmpOperation.png cmp %}\n\n\n{% asset_img ActualValueForCmp.png  %}\n\n`ebp+8``ebp+0Ch``zf`0`cf`1\n\n`jae MSVCR80D!_initterm+0x25``jae`\n\n\n```asm\nmov ecx, dword ptr [ebp+8]\ncmp dword ptr [ecx], 0\nje MSVCR80D!_initterm+0x1a\n```\n\n`ebp+8`ecx00`MSVCR80D!_initterm+0x1a`\n```asm\nmov ecx, dword ptr [ebp+8]\nadd ecx, 4\njmp MSVCR80D!_initterm+0x3\n```\n\n`ebp+8`4,`ebp+8``ecx``ebp+8``_initterm+0x3`\n{% asset_img InitTermJmpBackToFuncHead.png  %}\n\n\n```asm\nmov edx, dword ptr [ebp+8]\nmov eax, dword ptr [edx]\ncall eax\n```\n\n`call eax``ebp+8`edxeax\n\n`ebp+8`,`ebp+0Ch``ebp+8``ebp+0Ch`C++\n```cpp\nvoid _initterm(void* from, void* to)\n{\n    while (from < to)\n    {\n        if (*from != NULL)\n        {\n            functype func = (functype)*from;\n            func();\n        }\n\n        from++;\n    }\n}\n```\n\nfunctype`SimpleClass`\n\n`eax`F11`kbn``_initterm``__tmainCRTStartup``_initterm`\n\n`pre_cpp_init`HelloWorld2005\n{% asset_img HelloWorld2005PreCppInit.png pre_cpp_init %}\n\n`sub esp 120h``_RTC_Terminate`(cloudy064@gmail.com)\n\n\n```asm\ncall HelloWorld2005!atexit\nadd esp, 4\n```\n\n`_RTC_Terminate``atexit``pre_cpp_init``atexit``add esp, 4``atexit`\n\n\n```asm\nmov eax, dword ptr [HelloWorld2005!_newmode]\nmov dword ptr [HelloWorld2005!startinfo], eax\npush offset HelloWorld2005!startinfo\n```\n\n`HelloWorld2005!_newmode``HelloWorld2005!startinfo``HelloWorld2005``dv`dump value\n{% asset_img PreCppInitDvResult.png dv %}\n\nstartinfo:`dt`dump type`dt`\n{% asset_img PreCppInitDtValueResult.png dt%}\n\n`dt _startupinfo`\n\n`startinfo``push offset HelloWorld2005!startinfo``startinfo`\n\n\n```asm\nmov ecx, dword ptr [HelloWorld2005!_dowildcard]\npush ecx\npush offset HelloWorld2005!envp\npush offset HelloWorld2005!argv\npush offset HelloWorld2005!argc\ncall dword ptr [HelloWorld2005!_imp____getmainargs]\nadd esp, 14h\n```\n\n`_dowildcard``envp`,`argv`,`argc``_imp____getmainargs`\n```cpp\nvoid _imp____getmainargs(\n    void* argc, \n    void* argv, \n    void* envp, \n    int _dowildcard,\n    _startupinfo* startinfo)\n{\n//.......\n}\n```\n\n\n\n\n```asm\nmov dword ptr [HelloWorld2005!argret], eax\ncmp dword ptr [HelloWorld2005!argret], 0\njge HelloWorld2005!pre_cpp_init+0x56\n```\n\neax`_imp____getmainargs`= =00`jge`jump if greater than or equal`pre_cpp_init+0x56`\n\n\n```asm\npush 8\ncall HelloWorld2005!amsg_exit\nadd esp, 4\n```\n\n808\n\n`pre_cpp_init`C++\n```cpp\nvoid pre_cpp_init()\n{\n    atexit(&_RTC_Terminate);\n    startinfo.newmode = _newmode;\n    argret = _imp____getmainargs(&argc, &argv, &envp, _dowildcard, &startinfo);\n    if (argret >= 0)\n        return;\n\n    amsg_exit(8);\n}\n```\n\n\n\n`SimpleClass`\n\n`call eax`k\n{% asset_img DynamicInitializerForK.png K %}\n\n`30h``0xCCCCCCCC`\n```cpp\npush 0Ch\nmov ecx, offset HelloWorld2005!k\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\n`k``k`12`k``ecx`ecxthis\n\n\n{% asset_img SimpleClassConstructorCode.png SimpleClass %}\n\n`push ecx``ecx`ecxthis`ecx`this`pop ecx``ecx`this\n\n`mov dword ptr [ebp-8], ecx``ebp-8``SimpleClass* this = ecx;`this\n\n`mov eax, dword ptr [ebp-8]`()thisthisthisthis`dword ptr`Intel\n\n\n```asm\nmov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable'\n```\n\n= =SimpleClassthis`dd eax`this\n{% asset_img SimpleClassThisPointToMemory.png this %}\n\n\n\n\n```asm\nmov eax, dword ptr [ebp-8] ;this\nmov ecx, dword ptr [ebp+8] ;12\nmov dword ptr [eax+4], ecx ;this\n```\n\nSimpleClass`dt SimpleClass`\n{% asset_img DtSimpleClass.png SimpleClass %}\n\n`SimpleClass`4`a`8`b`(null)`char*`\n{% asset_img SimpleClassMemoryMap.png SimpleClass %}\n\n\n\n`mov dword ptr [eax+4], ecx``a``:a(m)`\n\n\n```asm\nmov eax, dowrd ptr [ebp-8]\nmov dword ptr [eax+8], 3\n```\n\n`b`\n\n`int`\n\n`ret`44`ret 4`:\n```asm\nret\nadd esp, 4\n```\n\n---\n\n`dynamic initializer for 'k'`= =main[http://wiki.osdev.org/Visual_C%2B%2B_Runtime](http://wiki.osdev.org/Visual_C%2B%2B_Runtime)\n\n`main`\n{% asset_img ThePlaceWhereCallMain.png main %}\n\n`main`\n```asm\nmov eax, dword ptr [HelloWorld2005!envp]\npush eax\n\nmov ecx, dword ptr [HelloWorld2005!argv]\npush ecx\n\nmov edx, dword ptr [HelloWorld2005!argc]\npush edx\n\ncall HelloWorld2005!main \n```\n\nmain`argc`,`argv`,`envp`\n\n`main`\n{% asset_img MainSimpleClassJ=233.png main %}\n\n`0E9h`(233)`j`this`SimpleClass`\n```asm\npush 0E9h\nlea ecx, [ebp-1Ch]\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\n`j`\n{% asset_img MainSimpleClassJ=233Stack.png  %}\n\nj4\n\n`SimpleClass`\n```cpp\nSimpleClass a(10);\nSimpleClass b = 10;\n```\n\n\n\n`SimpleClass k = ::k;`C++\n```asm\npush offset HelloWorld2005!k\nlea ecx, [ebp-30h]\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\nTM`SimpleClass`\n{% asset_img SimpleClassCopyConstructorCode.png  %}\n\n`004011b3`\n```asm\nmov eax, dword ptr [ebp-8]\nmov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable'\n\nmov eax, dword ptr [ebp-8] ; this\nmov ecx, dword ptr [ebp+8] ; k\nmov edx, dword ptr [ecx+4] ; edx = k.a\nmov dword ptr [eax+4], edx ; this.a = edx\n\nmov eax, dword ptr [ebp-8] ; this\nmov ecx, dword ptr [ebp+8] ; k\nmov edx, dword ptr [ecx+8] ; edx = k.b\nmov dword ptr [eax+8], edx ; this.b = edx\n\nmov eax, dword ptr [ebp-8]\n```\n\n= =`ebp-8`thisthis\n\n`push offset HelloWorld2005!k``k``mov ecx, dword ptr [ebp+8]``k``ecx`\n\n`Simple Class a(k)`\n```asm\nlea     eax, [ebp-30h]  ; keax\npush    eax             ; eax\nlea     ecx, [ebp-44h]  ; ebp-44h12\ncall    HelloWorld2005!SimpleClass:SimpleClass  ;\n```\n\n\n```cpp\nSimpleClass a = k;\nSimpleClass b(k);\n```\n\n---\n\n:\n{% asset_img MainCompareTestAndTestConst.png constconst %}\n\necxconstconstconstthisconstthisconstbugbug\n\nTestMemberFunc\n```asm\npush ebp        ; \nmov ebp, esp    ; \nsub esp, 0C0h   ; \npush xxx        ; \npush xxx        ; \npush xxx        ; \npush ecx        ; this\n; \npop ecx         ; this\nmov dword ptr [ebp-8], ecx ; this\nmov eax, dword ptr [ebp-8] ; thiseax\nmov ecx, dword ptr [eax+4] ; a\nadd ecx, dword ptr [eax+8] ; b\nmov dword ptr [eax+4], ecx ; a\npop xxx\npop xxx\npop xxx \nmov esp, ebp\npop ebp\nret\n```\n\n\n\n:\n{% asset_img MainCallTestVirtual.png  %}\n\n`push``ecx`this\n\nconst\n\n`int d = SimpleClass::TestStatic(12, 13)`\n{% asset_img MainCallTestStatic.png  %}\n\n\n\n= =\n\n`dt``SimpleClass`\n{% asset_img DtSimpleClass.png SimpleClass %}\n\nstr`00406000``str``\"joker\"``dd 0040600`\n{% asset_img dd00406000.png str %}\n\n`\"joker\"``da 0040412c``da`dump ansi\n{% asset_img da0040412c.png str %}\n\n\n1. text\n2. rdata\n3. data\n4. rsrc\n\n`dh! -s HelloWorld2005`dhdump header,-s\n{% asset_img DumpHelloWorldHeaders.png  %}\n\nHelloWorld2005.exe\n{% asset_img lmvmHelloWorld2005.png HelloWorld2005.exe %}\n\n\n```\ntext       00401000~0040313C\nrdata      00404000~0040515C\ndata       00406000~00406418\nrsrc       00407000~004071B4\n```\n\n`str``00406000`datadata\n\n`\"joker\"``0040412C`rdatardata`s -sa HelloWorld2005+4000 L115C`rdataANSI\n{% asset_img s-saHelloWorld2005+4000L115C.png rdataANSI %}\n\n`\"joker\"`\n\n\n\n## \n\n### WinDBG\n1. `dv``!`\n2. `dt`\n3. `!dh`\n4. `s`\n\n\n### \n1. `ret 4`4\n2. `ecx`thisthis`ebp-8`\n\n\n### C++\n1. main\n2. \n3. \n4. this\n5. constconst\n6. \n7. \n8. `data`\n9. `rdata`\n10. mainint main(int argc, char** argv, char** envp);\n11. ","source":"_posts/windbg/windbg-chapter3.md","raw":"---\ntitle: WinDBG\ndate: 2016-04-21 00:48:07\ncategories: windbg\ntags: [windbg,disassembly,c++]\n---\n\n## \nrelease\n<!--more-->\n## \n\n```cpp\nclass SimpleClass\n{\npublic:\n    SimpleClass(int m)\n        : a(m)\n    {\n        b = 3;\n    }\n\n    SimpleClass(const SimpleClass& rhs)\n        : a(rhs.a)\n        , b(rhs.b)\n    {\n\n    }\n\n    ~SimpleClass()\n    {\n\n    }\n\npublic:\n    void TestMemberFunc()\n    {\n        a += b;\n    }\n\n    void TestConstMemberFunc() const\n    {\n        int m = a;\n        m += b;\n    }\n\npublic:\n    virtual void TestVirtual(int m)\n    {\n        a += m;\n    }\n\npublic:\n    static int TestStatic(int m, int n)\n    {\n        return m + n;\n    }\n\nprivate:\n    int a;\n    int b;\n\nprivate:\n    static const char* str;\n};\n\nconst char* SimpleClass::str = \"joker\";\n\nSimpleClass k(12);\n\nint main(int argc, char** argv)\n{\n    SimpleClass j = 233;\n    SimpleClass k = ::k;\n    SimpleClass a(k);\n\n    k.TestMemberFunc();\n    k.TestConstMemberFunc();\n\n    a.TestVirtual(14);\n\n    int d = SimpleClass::TestStatic(12, 13);\n\n    return 0;\n}\n```\n\n\n1. \n2. \n3. \n4. \n5. \n6. \n7. \n8. const\n9. \n10. \n\n\n\n`bp HelloWorld2005!SimpleClass::SimpleClass`WinDBG`SimpleClass`\n{% asset_img SetConstructorBreakPoint.png  %}\n\nWinDBG`bp 00401140``g`\n{% asset_img HitConstructorBreakPoint.png  %}\n\n`kbn`\n{% asset_img GlobalVarCallStack.png  %}\n\n`_initterm``dynamic initializer for 'k'`kSimpleClass k(12)_initterm`Ctrl+Shift+F5``bp MSVCR80D!_initterm``g`\n{% asset_img InInitTermFunction.png _initterm %}\n\n\n```asm\nmov eax, dword ptr [ebp+8]\ncmp eax, dword ptr [ebp+0Ch]\njae MSVCR80D!_initterm+0x25\n```\n\n`ebp+8`DWORD`ebp+0Ch`DWORD`_initterm``cmp`WinDBG`Alt+4`\n{% asset_img AllRegisters.png  %}\n\n`cmp``cf`carry flag`zf`zero flag`cmp`\n{% asset_img CmpResult.png cmp %}\n\n`cmp`\n{% asset_img AfterCmpOperation.png cmp %}\n\n\n{% asset_img ActualValueForCmp.png  %}\n\n`ebp+8``ebp+0Ch``zf`0`cf`1\n\n`jae MSVCR80D!_initterm+0x25``jae`\n\n\n```asm\nmov ecx, dword ptr [ebp+8]\ncmp dword ptr [ecx], 0\nje MSVCR80D!_initterm+0x1a\n```\n\n`ebp+8`ecx00`MSVCR80D!_initterm+0x1a`\n```asm\nmov ecx, dword ptr [ebp+8]\nadd ecx, 4\njmp MSVCR80D!_initterm+0x3\n```\n\n`ebp+8`4,`ebp+8``ecx``ebp+8``_initterm+0x3`\n{% asset_img InitTermJmpBackToFuncHead.png  %}\n\n\n```asm\nmov edx, dword ptr [ebp+8]\nmov eax, dword ptr [edx]\ncall eax\n```\n\n`call eax``ebp+8`edxeax\n\n`ebp+8`,`ebp+0Ch``ebp+8``ebp+0Ch`C++\n```cpp\nvoid _initterm(void* from, void* to)\n{\n    while (from < to)\n    {\n        if (*from != NULL)\n        {\n            functype func = (functype)*from;\n            func();\n        }\n\n        from++;\n    }\n}\n```\n\nfunctype`SimpleClass`\n\n`eax`F11`kbn``_initterm``__tmainCRTStartup``_initterm`\n\n`pre_cpp_init`HelloWorld2005\n{% asset_img HelloWorld2005PreCppInit.png pre_cpp_init %}\n\n`sub esp 120h``_RTC_Terminate`(cloudy064@gmail.com)\n\n\n```asm\ncall HelloWorld2005!atexit\nadd esp, 4\n```\n\n`_RTC_Terminate``atexit``pre_cpp_init``atexit``add esp, 4``atexit`\n\n\n```asm\nmov eax, dword ptr [HelloWorld2005!_newmode]\nmov dword ptr [HelloWorld2005!startinfo], eax\npush offset HelloWorld2005!startinfo\n```\n\n`HelloWorld2005!_newmode``HelloWorld2005!startinfo``HelloWorld2005``dv`dump value\n{% asset_img PreCppInitDvResult.png dv %}\n\nstartinfo:`dt`dump type`dt`\n{% asset_img PreCppInitDtValueResult.png dt%}\n\n`dt _startupinfo`\n\n`startinfo``push offset HelloWorld2005!startinfo``startinfo`\n\n\n```asm\nmov ecx, dword ptr [HelloWorld2005!_dowildcard]\npush ecx\npush offset HelloWorld2005!envp\npush offset HelloWorld2005!argv\npush offset HelloWorld2005!argc\ncall dword ptr [HelloWorld2005!_imp____getmainargs]\nadd esp, 14h\n```\n\n`_dowildcard``envp`,`argv`,`argc``_imp____getmainargs`\n```cpp\nvoid _imp____getmainargs(\n    void* argc, \n    void* argv, \n    void* envp, \n    int _dowildcard,\n    _startupinfo* startinfo)\n{\n//.......\n}\n```\n\n\n\n\n```asm\nmov dword ptr [HelloWorld2005!argret], eax\ncmp dword ptr [HelloWorld2005!argret], 0\njge HelloWorld2005!pre_cpp_init+0x56\n```\n\neax`_imp____getmainargs`= =00`jge`jump if greater than or equal`pre_cpp_init+0x56`\n\n\n```asm\npush 8\ncall HelloWorld2005!amsg_exit\nadd esp, 4\n```\n\n808\n\n`pre_cpp_init`C++\n```cpp\nvoid pre_cpp_init()\n{\n    atexit(&_RTC_Terminate);\n    startinfo.newmode = _newmode;\n    argret = _imp____getmainargs(&argc, &argv, &envp, _dowildcard, &startinfo);\n    if (argret >= 0)\n        return;\n\n    amsg_exit(8);\n}\n```\n\n\n\n`SimpleClass`\n\n`call eax`k\n{% asset_img DynamicInitializerForK.png K %}\n\n`30h``0xCCCCCCCC`\n```cpp\npush 0Ch\nmov ecx, offset HelloWorld2005!k\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\n`k``k`12`k``ecx`ecxthis\n\n\n{% asset_img SimpleClassConstructorCode.png SimpleClass %}\n\n`push ecx``ecx`ecxthis`ecx`this`pop ecx``ecx`this\n\n`mov dword ptr [ebp-8], ecx``ebp-8``SimpleClass* this = ecx;`this\n\n`mov eax, dword ptr [ebp-8]`()thisthisthisthis`dword ptr`Intel\n\n\n```asm\nmov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable'\n```\n\n= =SimpleClassthis`dd eax`this\n{% asset_img SimpleClassThisPointToMemory.png this %}\n\n\n\n\n```asm\nmov eax, dword ptr [ebp-8] ;this\nmov ecx, dword ptr [ebp+8] ;12\nmov dword ptr [eax+4], ecx ;this\n```\n\nSimpleClass`dt SimpleClass`\n{% asset_img DtSimpleClass.png SimpleClass %}\n\n`SimpleClass`4`a`8`b`(null)`char*`\n{% asset_img SimpleClassMemoryMap.png SimpleClass %}\n\n\n\n`mov dword ptr [eax+4], ecx``a``:a(m)`\n\n\n```asm\nmov eax, dowrd ptr [ebp-8]\nmov dword ptr [eax+8], 3\n```\n\n`b`\n\n`int`\n\n`ret`44`ret 4`:\n```asm\nret\nadd esp, 4\n```\n\n---\n\n`dynamic initializer for 'k'`= =main[http://wiki.osdev.org/Visual_C%2B%2B_Runtime](http://wiki.osdev.org/Visual_C%2B%2B_Runtime)\n\n`main`\n{% asset_img ThePlaceWhereCallMain.png main %}\n\n`main`\n```asm\nmov eax, dword ptr [HelloWorld2005!envp]\npush eax\n\nmov ecx, dword ptr [HelloWorld2005!argv]\npush ecx\n\nmov edx, dword ptr [HelloWorld2005!argc]\npush edx\n\ncall HelloWorld2005!main \n```\n\nmain`argc`,`argv`,`envp`\n\n`main`\n{% asset_img MainSimpleClassJ=233.png main %}\n\n`0E9h`(233)`j`this`SimpleClass`\n```asm\npush 0E9h\nlea ecx, [ebp-1Ch]\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\n`j`\n{% asset_img MainSimpleClassJ=233Stack.png  %}\n\nj4\n\n`SimpleClass`\n```cpp\nSimpleClass a(10);\nSimpleClass b = 10;\n```\n\n\n\n`SimpleClass k = ::k;`C++\n```asm\npush offset HelloWorld2005!k\nlea ecx, [ebp-30h]\ncall HelloWorld2005!SimpleClass::SimpleClass\n```\n\nTM`SimpleClass`\n{% asset_img SimpleClassCopyConstructorCode.png  %}\n\n`004011b3`\n```asm\nmov eax, dword ptr [ebp-8]\nmov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable'\n\nmov eax, dword ptr [ebp-8] ; this\nmov ecx, dword ptr [ebp+8] ; k\nmov edx, dword ptr [ecx+4] ; edx = k.a\nmov dword ptr [eax+4], edx ; this.a = edx\n\nmov eax, dword ptr [ebp-8] ; this\nmov ecx, dword ptr [ebp+8] ; k\nmov edx, dword ptr [ecx+8] ; edx = k.b\nmov dword ptr [eax+8], edx ; this.b = edx\n\nmov eax, dword ptr [ebp-8]\n```\n\n= =`ebp-8`thisthis\n\n`push offset HelloWorld2005!k``k``mov ecx, dword ptr [ebp+8]``k``ecx`\n\n`Simple Class a(k)`\n```asm\nlea     eax, [ebp-30h]  ; keax\npush    eax             ; eax\nlea     ecx, [ebp-44h]  ; ebp-44h12\ncall    HelloWorld2005!SimpleClass:SimpleClass  ;\n```\n\n\n```cpp\nSimpleClass a = k;\nSimpleClass b(k);\n```\n\n---\n\n:\n{% asset_img MainCompareTestAndTestConst.png constconst %}\n\necxconstconstconstthisconstthisconstbugbug\n\nTestMemberFunc\n```asm\npush ebp        ; \nmov ebp, esp    ; \nsub esp, 0C0h   ; \npush xxx        ; \npush xxx        ; \npush xxx        ; \npush ecx        ; this\n; \npop ecx         ; this\nmov dword ptr [ebp-8], ecx ; this\nmov eax, dword ptr [ebp-8] ; thiseax\nmov ecx, dword ptr [eax+4] ; a\nadd ecx, dword ptr [eax+8] ; b\nmov dword ptr [eax+4], ecx ; a\npop xxx\npop xxx\npop xxx \nmov esp, ebp\npop ebp\nret\n```\n\n\n\n:\n{% asset_img MainCallTestVirtual.png  %}\n\n`push``ecx`this\n\nconst\n\n`int d = SimpleClass::TestStatic(12, 13)`\n{% asset_img MainCallTestStatic.png  %}\n\n\n\n= =\n\n`dt``SimpleClass`\n{% asset_img DtSimpleClass.png SimpleClass %}\n\nstr`00406000``str``\"joker\"``dd 0040600`\n{% asset_img dd00406000.png str %}\n\n`\"joker\"``da 0040412c``da`dump ansi\n{% asset_img da0040412c.png str %}\n\n\n1. text\n2. rdata\n3. data\n4. rsrc\n\n`dh! -s HelloWorld2005`dhdump header,-s\n{% asset_img DumpHelloWorldHeaders.png  %}\n\nHelloWorld2005.exe\n{% asset_img lmvmHelloWorld2005.png HelloWorld2005.exe %}\n\n\n```\ntext       00401000~0040313C\nrdata      00404000~0040515C\ndata       00406000~00406418\nrsrc       00407000~004071B4\n```\n\n`str``00406000`datadata\n\n`\"joker\"``0040412C`rdatardata`s -sa HelloWorld2005+4000 L115C`rdataANSI\n{% asset_img s-saHelloWorld2005+4000L115C.png rdataANSI %}\n\n`\"joker\"`\n\n\n\n## \n\n### WinDBG\n1. `dv``!`\n2. `dt`\n3. `!dh`\n4. `s`\n\n\n### \n1. `ret 4`4\n2. `ecx`thisthis`ebp-8`\n\n\n### C++\n1. main\n2. \n3. \n4. this\n5. constconst\n6. \n7. \n8. `data`\n9. `rdata`\n10. mainint main(int argc, char** argv, char** envp);\n11. ","slug":"windbg-windbg-chapter3","published":1,"updated":"2018-06-25T11:14:49.163Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtne000b2gusea2baouz","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>release<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimpleClass</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    SimpleClass(<span class=\"keyword\">int</span> m)</span><br><span class=\"line\">        : a(m)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        b = <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    SimpleClass(<span class=\"keyword\">const</span> SimpleClass&amp; rhs)</span><br><span class=\"line\">        : a(rhs.a)</span><br><span class=\"line\">        , b(rhs.b)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~SimpleClass()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestMemberFunc</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestConstMemberFunc</span><span class=\"params\">()</span> <span class=\"keyword\">const</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> m = a;</span><br><span class=\"line\">        m += b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">TestVirtual</span><span class=\"params\">(<span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += m;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">TestStatic</span><span class=\"params\">(<span class=\"keyword\">int</span> m, <span class=\"keyword\">int</span> n)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m + n;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* str;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* SimpleClass::str = <span class=\"string\">\"joker\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">k</span><span class=\"params\">(<span class=\"number\">12</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    SimpleClass j = <span class=\"number\">233</span>;</span><br><span class=\"line\">    SimpleClass k = ::k;</span><br><span class=\"line\">    <span class=\"function\">SimpleClass <span class=\"title\">a</span><span class=\"params\">(k)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    k.TestMemberFunc();</span><br><span class=\"line\">    k.TestConstMemberFunc();</span><br><span class=\"line\"></span><br><span class=\"line\">    a.TestVirtual(<span class=\"number\">14</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> d = SimpleClass::TestStatic(<span class=\"number\">12</span>, <span class=\"number\">13</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>const</li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p><code>bp HelloWorld2005!SimpleClass::SimpleClass</code>WinDBG<code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SetConstructorBreakPoint.png\" title=\"\"></p>\n<p>WinDBG<code>bp 00401140</code><code>g</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/HitConstructorBreakPoint.png\" title=\"\"></p>\n<p><code>kbn</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/GlobalVarCallStack.png\" title=\"\"></p>\n<p><code>_initterm</code><code>dynamic initializer for &#39;k&#39;</code>kSimpleClass k(12)_initterm<code>Ctrl+Shift+F5</code><code>bp MSVCR80D!_initterm</code><code>g</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/InInitTermFunction.png\" title=\"_initterm\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp+8]</span><br><span class=\"line\">cmp eax, dword ptr [ebp+0Ch]</span><br><span class=\"line\">jae MSVCR80D!_initterm+0x25</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>DWORD<code>ebp+0Ch</code>DWORD<code>_initterm</code><code>cmp</code>WinDBG<code>Alt+4</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/AllRegisters.png\" title=\"\"></p>\n<p><code>cmp</code><code>cf</code>carry flag<code>zf</code>zero flag<code>cmp</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/CmpResult.png\" title=\"cmp\"></p>\n<p><code>cmp</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/AfterCmpOperation.png\" title=\"cmp\"></p>\n<p><br><img src=\"/2016/04/21/windbg-windbg-chapter3/ActualValueForCmp.png\" title=\"\"></p>\n<p><code>ebp+8</code><code>ebp+0Ch</code><code>zf</code>0<code>cf</code>1</p>\n<p><code>jae MSVCR80D!_initterm+0x25</code><code>jae</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp+8]</span><br><span class=\"line\">cmp dword ptr [ecx], 0</span><br><span class=\"line\">je MSVCR80D!_initterm+0x1a</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>ecx00<code>MSVCR80D!_initterm+0x1a</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp+8]</span><br><span class=\"line\">add ecx, 4</span><br><span class=\"line\">jmp MSVCR80D!_initterm+0x3</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>4,<code>ebp+8</code><code>ecx</code><code>ebp+8</code><code>_initterm+0x3</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/InitTermJmpBackToFuncHead.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov edx, dword ptr [ebp+8]</span><br><span class=\"line\">mov eax, dword ptr [edx]</span><br><span class=\"line\">call eax</span><br></pre></td></tr></table></figure></p>\n<p><code>call eax</code><code>ebp+8</code>edxeax</p>\n<p><code>ebp+8</code>,<code>ebp+0Ch</code><code>ebp+8</code><code>ebp+0Ch</code>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> _initterm(<span class=\"keyword\">void</span>* from, <span class=\"keyword\">void</span>* to)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (from &lt; to)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (*from != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            functype func = (functype)*from;</span><br><span class=\"line\">            func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        from++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>functype<code>SimpleClass</code></p>\n<p><code>eax</code>F11<code>kbn</code><code>_initterm</code><code>__tmainCRTStartup</code><code>_initterm</code></p>\n<p><code>pre_cpp_init</code>HelloWorld2005<br><img src=\"/2016/04/21/windbg-windbg-chapter3/HelloWorld2005PreCppInit.png\" title=\"pre_cpp_init\"></p>\n<p><code>sub esp 120h</code><code>_RTC_Terminate</code>(<a href=\"mailto:cloudy064@gmail.com\" target=\"_blank\" rel=\"noopener\">cloudy064@gmail.com</a>)</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">call HelloWorld2005!atexit</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<p><code>_RTC_Terminate</code><code>atexit</code><code>pre_cpp_init</code><code>atexit</code><code>add esp, 4</code><code>atexit</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [HelloWorld2005!_newmode]</span><br><span class=\"line\">mov dword ptr [HelloWorld2005!startinfo], eax</span><br><span class=\"line\">push offset HelloWorld2005!startinfo</span><br></pre></td></tr></table></figure></p>\n<p><code>HelloWorld2005!_newmode</code><code>HelloWorld2005!startinfo</code><code>HelloWorld2005</code><code>dv</code>dump value<br><img src=\"/2016/04/21/windbg-windbg-chapter3/PreCppInitDvResult.png\" title=\"dv\"></p>\n<p>startinfo:<code>dt</code>dump type<code>dt</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/PreCppInitDtValueResult.png\" title=\"dt\"></p>\n<p><code>dt _startupinfo</code></p>\n<p><code>startinfo</code><code>push offset HelloWorld2005!startinfo</code><code>startinfo</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [HelloWorld2005!_dowildcard]</span><br><span class=\"line\">push ecx</span><br><span class=\"line\">push offset HelloWorld2005!envp</span><br><span class=\"line\">push offset HelloWorld2005!argv</span><br><span class=\"line\">push offset HelloWorld2005!argc</span><br><span class=\"line\">call dword ptr [HelloWorld2005!_imp____getmainargs]</span><br><span class=\"line\">add esp, 14h</span><br></pre></td></tr></table></figure></p>\n<p><code>_dowildcard</code><code>envp</code>,<code>argv</code>,<code>argc</code><code>_imp____getmainargs</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> _imp____getmainargs(</span><br><span class=\"line\">    <span class=\"keyword\">void</span>* argc, </span><br><span class=\"line\">    <span class=\"keyword\">void</span>* argv, </span><br><span class=\"line\">    <span class=\"keyword\">void</span>* envp, </span><br><span class=\"line\">    <span class=\"keyword\">int</span> _dowildcard,</span><br><span class=\"line\">    _startupinfo* startinfo)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"comment\">//.......</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [HelloWorld2005!argret], eax</span><br><span class=\"line\">cmp dword ptr [HelloWorld2005!argret], 0</span><br><span class=\"line\">jge HelloWorld2005!pre_cpp_init+0x56</span><br></pre></td></tr></table></figure></p>\n<p>eax<code>_imp____getmainargs</code>= =00<code>jge</code>jump if greater than or equal<code>pre_cpp_init+0x56</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 8</span><br><span class=\"line\">call HelloWorld2005!amsg_exit</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<p>808</p>\n<p><code>pre_cpp_init</code>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">pre_cpp_init</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    atexit(&amp;_RTC_Terminate);</span><br><span class=\"line\">    startinfo.newmode = _newmode;</span><br><span class=\"line\">    argret = _imp____getmainargs(&amp;argc, &amp;argv, &amp;envp, _dowildcard, &amp;startinfo);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argret &gt;= <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    amsg_exit(<span class=\"number\">8</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>SimpleClass</code></p>\n<p><code>call eax</code>k<br><img src=\"/2016/04/21/windbg-windbg-chapter3/DynamicInitializerForK.png\" title=\"K\"></p>\n<p><code>30h</code><code>0xCCCCCCCC</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push <span class=\"number\">0</span>Ch</span><br><span class=\"line\">mov ecx, offset HelloWorld2005!k</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p><code>k</code><code>k</code>12<code>k</code><code>ecx</code>ecxthis</p>\n<p><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassConstructorCode.png\" title=\"SimpleClass\"></p>\n<p><code>push ecx</code><code>ecx</code>ecxthis<code>ecx</code>this<code>pop ecx</code><code>ecx</code>this</p>\n<p><code>mov dword ptr [ebp-8], ecx</code><code>ebp-8</code><code>SimpleClass* this = ecx;</code>this</p>\n<p><code>mov eax, dword ptr [ebp-8]</code>()thisthisthisthis<code>dword ptr</code>Intel</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p>= =SimpleClassthis<code>dd eax</code>this<br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassThisPointToMemory.png\" title=\"this\"></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-8] ;this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ;12</span><br><span class=\"line\">mov dword ptr [eax+4], ecx ;this</span><br></pre></td></tr></table></figure></p>\n<p>SimpleClass<code>dt SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/DtSimpleClass.png\" title=\"SimpleClass\"></p>\n<p><code>SimpleClass</code>4<code>a</code>8<code>b</code>(null)<code>char*</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassMemoryMap.png\" title=\"SimpleClass\"></p>\n<p></p>\n<p><code>mov dword ptr [eax+4], ecx</code><code>a</code><code>:a(m)</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dowrd ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+8], 3</span><br></pre></td></tr></table></figure></p>\n<p><code>b</code></p>\n<p><code>int</code></p>\n<p><code>ret</code>44<code>ret 4</code>:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ret</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p><code>dynamic initializer for &#39;k&#39;</code>= =main<a href=\"http://wiki.osdev.org/Visual_C%2B%2B_Runtime\" target=\"_blank\" rel=\"noopener\">http://wiki.osdev.org/Visual_C%2B%2B_Runtime</a></p>\n<p><code>main</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/ThePlaceWhereCallMain.png\" title=\"main\"></p>\n<p><code>main</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [HelloWorld2005!envp]</span><br><span class=\"line\">push eax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [HelloWorld2005!argv]</span><br><span class=\"line\">push ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [HelloWorld2005!argc]</span><br><span class=\"line\">push edx</span><br><span class=\"line\"></span><br><span class=\"line\">call HelloWorld2005!main</span><br></pre></td></tr></table></figure></p>\n<p>main<code>argc</code>,<code>argv</code>,<code>envp</code></p>\n<p><code>main</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainSimpleClassJ=233.png\" title=\"main\"></p>\n<p><code>0E9h</code>(233)<code>j</code>this<code>SimpleClass</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 0E9h</span><br><span class=\"line\">lea ecx, [ebp-1Ch]</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p><code>j</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainSimpleClassJ=233Stack.png\" title=\"\"></p>\n<p>j4</p>\n<p><code>SimpleClass</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">a</span><span class=\"params\">(<span class=\"number\">10</span>)</span></span>;</span><br><span class=\"line\">SimpleClass b = <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>SimpleClass k = ::k;</code>C++<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push offset HelloWorld2005!k</span><br><span class=\"line\">lea ecx, [ebp-30h]</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p>TM<code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassCopyConstructorCode.png\" title=\"\"></p>\n<p><code>004011b3</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ; k</span><br><span class=\"line\">mov edx, dword ptr [ecx+4] ; edx = k.a</span><br><span class=\"line\">mov dword ptr [eax+4], edx ; this.a = edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ; k</span><br><span class=\"line\">mov edx, dword ptr [ecx+8] ; edx = k.b</span><br><span class=\"line\">mov dword ptr [eax+8], edx ; this.b = edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8]</span><br></pre></td></tr></table></figure></p>\n<p>= =<code>ebp-8</code>thisthis</p>\n<p><code>push offset HelloWorld2005!k</code><code>k</code><code>mov ecx, dword ptr [ebp+8]</code><code>k</code><code>ecx</code></p>\n<p><code>Simple Class a(k)</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea     eax, [ebp-30h]  ; keax</span><br><span class=\"line\">push    eax             ; eax</span><br><span class=\"line\">lea     ecx, [ebp-44h]  ; ebp-44h12</span><br><span class=\"line\">call    HelloWorld2005!SimpleClass:SimpleClass  ;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SimpleClass a = k;</span><br><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">b</span><span class=\"params\">(k)</span></span>;</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p>:<br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCompareTestAndTestConst.png\" title=\"constconst\"></p>\n<p>ecxconstconstconstthisconstthisconstbugbug</p>\n<p>TestMemberFunc<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push ebp        ; </span><br><span class=\"line\">mov ebp, esp    ; </span><br><span class=\"line\">sub esp, 0C0h   ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push ecx        ; this</span><br><span class=\"line\">; </span><br><span class=\"line\">pop ecx         ; this</span><br><span class=\"line\">mov dword ptr [ebp-8], ecx ; this</span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; thiseax</span><br><span class=\"line\">mov ecx, dword ptr [eax+4] ; a</span><br><span class=\"line\">add ecx, dword ptr [eax+8] ; b</span><br><span class=\"line\">mov dword ptr [eax+4], ecx ; a</span><br><span class=\"line\">pop xxx</span><br><span class=\"line\">pop xxx</span><br><span class=\"line\">pop xxx </span><br><span class=\"line\">mov esp, ebp</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p>:<br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCallTestVirtual.png\" title=\"\"></p>\n<p><code>push</code><code>ecx</code>this</p>\n<p>const</p>\n<p><code>int d = SimpleClass::TestStatic(12, 13)</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCallTestStatic.png\" title=\"\"></p>\n<p></p>\n<p>= =</p>\n<p><code>dt</code><code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/DtSimpleClass.png\" title=\"SimpleClass\"></p>\n<p>str<code>00406000</code><code>str</code><code>&quot;joker&quot;</code><code>dd 0040600</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/dd00406000.png\" title=\"str\"></p>\n<p><code>&quot;joker&quot;</code><code>da 0040412c</code><code>da</code>dump ansi<br><img src=\"/2016/04/21/windbg-windbg-chapter3/da0040412c.png\" title=\"str\"></p>\n<p></p>\n<ol>\n<li>text</li>\n<li>rdata</li>\n<li>data</li>\n<li>rsrc</li>\n</ol>\n<p><code>dh! -s HelloWorld2005</code>dhdump header,-s<br><img src=\"/2016/04/21/windbg-windbg-chapter3/DumpHelloWorldHeaders.png\" title=\"\"></p>\n<p>HelloWorld2005.exe<br><img src=\"/2016/04/21/windbg-windbg-chapter3/lmvmHelloWorld2005.png\" title=\"HelloWorld2005.exe\"></p>\n<p><br><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">text       <span class=\"number\">00401000</span>~<span class=\"number\">0040313C</span></span><br><span class=\"line\">rdata      <span class=\"number\">00404000</span>~<span class=\"number\">0040515C</span></span><br><span class=\"line\">data       <span class=\"number\">00406000</span>~<span class=\"number\">00406418</span></span><br><span class=\"line\">rsrc       <span class=\"number\">00407000</span>~<span class=\"number\">004071B4</span></span><br></pre></td></tr></table></figure></p>\n<p><code>str</code><code>00406000</code>datadata</p>\n<p><code>&quot;joker&quot;</code><code>0040412C</code>rdatardata<code>s -sa HelloWorld2005+4000 L115C</code>rdataANSI<br><img src=\"/2016/04/21/windbg-windbg-chapter3/s-saHelloWorld2005+4000L115C.png\" title=\"rdataANSI\"></p>\n<p><code>&quot;joker&quot;</code></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><ol>\n<li><code>dv</code><code>!</code></li>\n<li><code>dt</code></li>\n<li><code>!dh</code></li>\n<li><code>s</code></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><code>ret 4</code>4</li>\n<li><code>ecx</code>thisthis<code>ebp-8</code></li>\n</ol>\n<h3 id=\"C\"><a href=\"#C\" class=\"headerlink\" title=\"C++\"></a>C++</h3><ol>\n<li>main</li>\n<li></li>\n<li></li>\n<li>this</li>\n<li>constconst</li>\n<li></li>\n<li></li>\n<li><code>data</code></li>\n<li><code>rdata</code></li>\n<li>mainint main(int argc, char<strong> argv, char</strong> envp);</li>\n<li></li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>release<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimpleClass</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    SimpleClass(<span class=\"keyword\">int</span> m)</span><br><span class=\"line\">        : a(m)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        b = <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    SimpleClass(<span class=\"keyword\">const</span> SimpleClass&amp; rhs)</span><br><span class=\"line\">        : a(rhs.a)</span><br><span class=\"line\">        , b(rhs.b)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~SimpleClass()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestMemberFunc</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestConstMemberFunc</span><span class=\"params\">()</span> <span class=\"keyword\">const</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> m = a;</span><br><span class=\"line\">        m += b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">TestVirtual</span><span class=\"params\">(<span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += m;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">TestStatic</span><span class=\"params\">(<span class=\"keyword\">int</span> m, <span class=\"keyword\">int</span> n)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> m + n;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* str;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* SimpleClass::str = <span class=\"string\">\"joker\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">k</span><span class=\"params\">(<span class=\"number\">12</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    SimpleClass j = <span class=\"number\">233</span>;</span><br><span class=\"line\">    SimpleClass k = ::k;</span><br><span class=\"line\">    <span class=\"function\">SimpleClass <span class=\"title\">a</span><span class=\"params\">(k)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    k.TestMemberFunc();</span><br><span class=\"line\">    k.TestConstMemberFunc();</span><br><span class=\"line\"></span><br><span class=\"line\">    a.TestVirtual(<span class=\"number\">14</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> d = SimpleClass::TestStatic(<span class=\"number\">12</span>, <span class=\"number\">13</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>const</li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p><code>bp HelloWorld2005!SimpleClass::SimpleClass</code>WinDBG<code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SetConstructorBreakPoint.png\" title=\"\"></p>\n<p>WinDBG<code>bp 00401140</code><code>g</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/HitConstructorBreakPoint.png\" title=\"\"></p>\n<p><code>kbn</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/GlobalVarCallStack.png\" title=\"\"></p>\n<p><code>_initterm</code><code>dynamic initializer for &#39;k&#39;</code>kSimpleClass k(12)_initterm<code>Ctrl+Shift+F5</code><code>bp MSVCR80D!_initterm</code><code>g</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/InInitTermFunction.png\" title=\"_initterm\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp+8]</span><br><span class=\"line\">cmp eax, dword ptr [ebp+0Ch]</span><br><span class=\"line\">jae MSVCR80D!_initterm+0x25</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>DWORD<code>ebp+0Ch</code>DWORD<code>_initterm</code><code>cmp</code>WinDBG<code>Alt+4</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/AllRegisters.png\" title=\"\"></p>\n<p><code>cmp</code><code>cf</code>carry flag<code>zf</code>zero flag<code>cmp</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/CmpResult.png\" title=\"cmp\"></p>\n<p><code>cmp</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/AfterCmpOperation.png\" title=\"cmp\"></p>\n<p><br><img src=\"/2016/04/21/windbg-windbg-chapter3/ActualValueForCmp.png\" title=\"\"></p>\n<p><code>ebp+8</code><code>ebp+0Ch</code><code>zf</code>0<code>cf</code>1</p>\n<p><code>jae MSVCR80D!_initterm+0x25</code><code>jae</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp+8]</span><br><span class=\"line\">cmp dword ptr [ecx], 0</span><br><span class=\"line\">je MSVCR80D!_initterm+0x1a</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>ecx00<code>MSVCR80D!_initterm+0x1a</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp+8]</span><br><span class=\"line\">add ecx, 4</span><br><span class=\"line\">jmp MSVCR80D!_initterm+0x3</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp+8</code>4,<code>ebp+8</code><code>ecx</code><code>ebp+8</code><code>_initterm+0x3</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/InitTermJmpBackToFuncHead.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov edx, dword ptr [ebp+8]</span><br><span class=\"line\">mov eax, dword ptr [edx]</span><br><span class=\"line\">call eax</span><br></pre></td></tr></table></figure></p>\n<p><code>call eax</code><code>ebp+8</code>edxeax</p>\n<p><code>ebp+8</code>,<code>ebp+0Ch</code><code>ebp+8</code><code>ebp+0Ch</code>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> _initterm(<span class=\"keyword\">void</span>* from, <span class=\"keyword\">void</span>* to)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (from &lt; to)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (*from != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            functype func = (functype)*from;</span><br><span class=\"line\">            func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        from++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>functype<code>SimpleClass</code></p>\n<p><code>eax</code>F11<code>kbn</code><code>_initterm</code><code>__tmainCRTStartup</code><code>_initterm</code></p>\n<p><code>pre_cpp_init</code>HelloWorld2005<br><img src=\"/2016/04/21/windbg-windbg-chapter3/HelloWorld2005PreCppInit.png\" title=\"pre_cpp_init\"></p>\n<p><code>sub esp 120h</code><code>_RTC_Terminate</code>(<a href=\"mailto:cloudy064@gmail.com\" target=\"_blank\" rel=\"noopener\">cloudy064@gmail.com</a>)</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">call HelloWorld2005!atexit</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<p><code>_RTC_Terminate</code><code>atexit</code><code>pre_cpp_init</code><code>atexit</code><code>add esp, 4</code><code>atexit</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [HelloWorld2005!_newmode]</span><br><span class=\"line\">mov dword ptr [HelloWorld2005!startinfo], eax</span><br><span class=\"line\">push offset HelloWorld2005!startinfo</span><br></pre></td></tr></table></figure></p>\n<p><code>HelloWorld2005!_newmode</code><code>HelloWorld2005!startinfo</code><code>HelloWorld2005</code><code>dv</code>dump value<br><img src=\"/2016/04/21/windbg-windbg-chapter3/PreCppInitDvResult.png\" title=\"dv\"></p>\n<p>startinfo:<code>dt</code>dump type<code>dt</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/PreCppInitDtValueResult.png\" title=\"dt\"></p>\n<p><code>dt _startupinfo</code></p>\n<p><code>startinfo</code><code>push offset HelloWorld2005!startinfo</code><code>startinfo</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [HelloWorld2005!_dowildcard]</span><br><span class=\"line\">push ecx</span><br><span class=\"line\">push offset HelloWorld2005!envp</span><br><span class=\"line\">push offset HelloWorld2005!argv</span><br><span class=\"line\">push offset HelloWorld2005!argc</span><br><span class=\"line\">call dword ptr [HelloWorld2005!_imp____getmainargs]</span><br><span class=\"line\">add esp, 14h</span><br></pre></td></tr></table></figure></p>\n<p><code>_dowildcard</code><code>envp</code>,<code>argv</code>,<code>argc</code><code>_imp____getmainargs</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> _imp____getmainargs(</span><br><span class=\"line\">    <span class=\"keyword\">void</span>* argc, </span><br><span class=\"line\">    <span class=\"keyword\">void</span>* argv, </span><br><span class=\"line\">    <span class=\"keyword\">void</span>* envp, </span><br><span class=\"line\">    <span class=\"keyword\">int</span> _dowildcard,</span><br><span class=\"line\">    _startupinfo* startinfo)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"comment\">//.......</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [HelloWorld2005!argret], eax</span><br><span class=\"line\">cmp dword ptr [HelloWorld2005!argret], 0</span><br><span class=\"line\">jge HelloWorld2005!pre_cpp_init+0x56</span><br></pre></td></tr></table></figure></p>\n<p>eax<code>_imp____getmainargs</code>= =00<code>jge</code>jump if greater than or equal<code>pre_cpp_init+0x56</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 8</span><br><span class=\"line\">call HelloWorld2005!amsg_exit</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<p>808</p>\n<p><code>pre_cpp_init</code>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">pre_cpp_init</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    atexit(&amp;_RTC_Terminate);</span><br><span class=\"line\">    startinfo.newmode = _newmode;</span><br><span class=\"line\">    argret = _imp____getmainargs(&amp;argc, &amp;argv, &amp;envp, _dowildcard, &amp;startinfo);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argret &gt;= <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    amsg_exit(<span class=\"number\">8</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>SimpleClass</code></p>\n<p><code>call eax</code>k<br><img src=\"/2016/04/21/windbg-windbg-chapter3/DynamicInitializerForK.png\" title=\"K\"></p>\n<p><code>30h</code><code>0xCCCCCCCC</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push <span class=\"number\">0</span>Ch</span><br><span class=\"line\">mov ecx, offset HelloWorld2005!k</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p><code>k</code><code>k</code>12<code>k</code><code>ecx</code>ecxthis</p>\n<p><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassConstructorCode.png\" title=\"SimpleClass\"></p>\n<p><code>push ecx</code><code>ecx</code>ecxthis<code>ecx</code>this<code>pop ecx</code><code>ecx</code>this</p>\n<p><code>mov dword ptr [ebp-8], ecx</code><code>ebp-8</code><code>SimpleClass* this = ecx;</code>this</p>\n<p><code>mov eax, dword ptr [ebp-8]</code>()thisthisthisthis<code>dword ptr</code>Intel</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p>= =SimpleClassthis<code>dd eax</code>this<br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassThisPointToMemory.png\" title=\"this\"></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-8] ;this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ;12</span><br><span class=\"line\">mov dword ptr [eax+4], ecx ;this</span><br></pre></td></tr></table></figure></p>\n<p>SimpleClass<code>dt SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/DtSimpleClass.png\" title=\"SimpleClass\"></p>\n<p><code>SimpleClass</code>4<code>a</code>8<code>b</code>(null)<code>char*</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassMemoryMap.png\" title=\"SimpleClass\"></p>\n<p></p>\n<p><code>mov dword ptr [eax+4], ecx</code><code>a</code><code>:a(m)</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dowrd ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+8], 3</span><br></pre></td></tr></table></figure></p>\n<p><code>b</code></p>\n<p><code>int</code></p>\n<p><code>ret</code>44<code>ret 4</code>:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ret</span><br><span class=\"line\">add esp, 4</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p><code>dynamic initializer for &#39;k&#39;</code>= =main<a href=\"http://wiki.osdev.org/Visual_C%2B%2B_Runtime\" target=\"_blank\" rel=\"noopener\">http://wiki.osdev.org/Visual_C%2B%2B_Runtime</a></p>\n<p><code>main</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/ThePlaceWhereCallMain.png\" title=\"main\"></p>\n<p><code>main</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [HelloWorld2005!envp]</span><br><span class=\"line\">push eax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [HelloWorld2005!argv]</span><br><span class=\"line\">push ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [HelloWorld2005!argc]</span><br><span class=\"line\">push edx</span><br><span class=\"line\"></span><br><span class=\"line\">call HelloWorld2005!main</span><br></pre></td></tr></table></figure></p>\n<p>main<code>argc</code>,<code>argv</code>,<code>envp</code></p>\n<p><code>main</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainSimpleClassJ=233.png\" title=\"main\"></p>\n<p><code>0E9h</code>(233)<code>j</code>this<code>SimpleClass</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 0E9h</span><br><span class=\"line\">lea ecx, [ebp-1Ch]</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p><code>j</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainSimpleClassJ=233Stack.png\" title=\"\"></p>\n<p>j4</p>\n<p><code>SimpleClass</code><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">a</span><span class=\"params\">(<span class=\"number\">10</span>)</span></span>;</span><br><span class=\"line\">SimpleClass b = <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>SimpleClass k = ::k;</code>C++<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push offset HelloWorld2005!k</span><br><span class=\"line\">lea ecx, [ebp-30h]</span><br><span class=\"line\">call HelloWorld2005!SimpleClass::SimpleClass</span><br></pre></td></tr></table></figure></p>\n<p>TM<code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/SimpleClassCopyConstructorCode.png\" title=\"\"></p>\n<p><code>004011b3</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!SimpleClass::`vftable&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ; k</span><br><span class=\"line\">mov edx, dword ptr [ecx+4] ; edx = k.a</span><br><span class=\"line\">mov dword ptr [eax+4], edx ; this.a = edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8] ; k</span><br><span class=\"line\">mov edx, dword ptr [ecx+8] ; edx = k.b</span><br><span class=\"line\">mov dword ptr [eax+8], edx ; this.b = edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-8]</span><br></pre></td></tr></table></figure></p>\n<p>= =<code>ebp-8</code>thisthis</p>\n<p><code>push offset HelloWorld2005!k</code><code>k</code><code>mov ecx, dword ptr [ebp+8]</code><code>k</code><code>ecx</code></p>\n<p><code>Simple Class a(k)</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea     eax, [ebp-30h]  ; keax</span><br><span class=\"line\">push    eax             ; eax</span><br><span class=\"line\">lea     ecx, [ebp-44h]  ; ebp-44h12</span><br><span class=\"line\">call    HelloWorld2005!SimpleClass:SimpleClass  ;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SimpleClass a = k;</span><br><span class=\"line\"><span class=\"function\">SimpleClass <span class=\"title\">b</span><span class=\"params\">(k)</span></span>;</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p>:<br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCompareTestAndTestConst.png\" title=\"constconst\"></p>\n<p>ecxconstconstconstthisconstthisconstbugbug</p>\n<p>TestMemberFunc<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push ebp        ; </span><br><span class=\"line\">mov ebp, esp    ; </span><br><span class=\"line\">sub esp, 0C0h   ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push xxx        ; </span><br><span class=\"line\">push ecx        ; this</span><br><span class=\"line\">; </span><br><span class=\"line\">pop ecx         ; this</span><br><span class=\"line\">mov dword ptr [ebp-8], ecx ; this</span><br><span class=\"line\">mov eax, dword ptr [ebp-8] ; thiseax</span><br><span class=\"line\">mov ecx, dword ptr [eax+4] ; a</span><br><span class=\"line\">add ecx, dword ptr [eax+8] ; b</span><br><span class=\"line\">mov dword ptr [eax+4], ecx ; a</span><br><span class=\"line\">pop xxx</span><br><span class=\"line\">pop xxx</span><br><span class=\"line\">pop xxx </span><br><span class=\"line\">mov esp, ebp</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p>:<br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCallTestVirtual.png\" title=\"\"></p>\n<p><code>push</code><code>ecx</code>this</p>\n<p>const</p>\n<p><code>int d = SimpleClass::TestStatic(12, 13)</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/MainCallTestStatic.png\" title=\"\"></p>\n<p></p>\n<p>= =</p>\n<p><code>dt</code><code>SimpleClass</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/DtSimpleClass.png\" title=\"SimpleClass\"></p>\n<p>str<code>00406000</code><code>str</code><code>&quot;joker&quot;</code><code>dd 0040600</code><br><img src=\"/2016/04/21/windbg-windbg-chapter3/dd00406000.png\" title=\"str\"></p>\n<p><code>&quot;joker&quot;</code><code>da 0040412c</code><code>da</code>dump ansi<br><img src=\"/2016/04/21/windbg-windbg-chapter3/da0040412c.png\" title=\"str\"></p>\n<p></p>\n<ol>\n<li>text</li>\n<li>rdata</li>\n<li>data</li>\n<li>rsrc</li>\n</ol>\n<p><code>dh! -s HelloWorld2005</code>dhdump header,-s<br><img src=\"/2016/04/21/windbg-windbg-chapter3/DumpHelloWorldHeaders.png\" title=\"\"></p>\n<p>HelloWorld2005.exe<br><img src=\"/2016/04/21/windbg-windbg-chapter3/lmvmHelloWorld2005.png\" title=\"HelloWorld2005.exe\"></p>\n<p><br><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">text       <span class=\"number\">00401000</span>~<span class=\"number\">0040313C</span></span><br><span class=\"line\">rdata      <span class=\"number\">00404000</span>~<span class=\"number\">0040515C</span></span><br><span class=\"line\">data       <span class=\"number\">00406000</span>~<span class=\"number\">00406418</span></span><br><span class=\"line\">rsrc       <span class=\"number\">00407000</span>~<span class=\"number\">004071B4</span></span><br></pre></td></tr></table></figure></p>\n<p><code>str</code><code>00406000</code>datadata</p>\n<p><code>&quot;joker&quot;</code><code>0040412C</code>rdatardata<code>s -sa HelloWorld2005+4000 L115C</code>rdataANSI<br><img src=\"/2016/04/21/windbg-windbg-chapter3/s-saHelloWorld2005+4000L115C.png\" title=\"rdataANSI\"></p>\n<p><code>&quot;joker&quot;</code></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><ol>\n<li><code>dv</code><code>!</code></li>\n<li><code>dt</code></li>\n<li><code>!dh</code></li>\n<li><code>s</code></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><code>ret 4</code>4</li>\n<li><code>ecx</code>thisthis<code>ebp-8</code></li>\n</ol>\n<h3 id=\"C\"><a href=\"#C\" class=\"headerlink\" title=\"C++\"></a>C++</h3><ol>\n<li>main</li>\n<li></li>\n<li></li>\n<li>this</li>\n<li>constconst</li>\n<li></li>\n<li></li>\n<li><code>data</code></li>\n<li><code>rdata</code></li>\n<li>mainint main(int argc, char<strong> argv, char</strong> envp);</li>\n<li></li>\n</ol>"},{"title":"WinDBG","date":"2016-04-20T05:19:11.000Z","_content":"\n## \nC++releaseexerelease\n\nstructconst\n<!--more-->\n## \n\n```cpp\ntypedef struct Simple\n{\n    int a;\n    int b;\n    char c;\n    short d;\n    unsigned int e;\n} Simple;\n\nvoid TestValue(Simple s)\n{\n\n}\n\nvoid TestReference(Simple& s)\n{\n\n}\n\nvoid TestPointer(Simple* s)\n{\n\n}\n\nvoid TestConstReference(const Simple& s)\n{\n\n}\n\nSimple TestReturn()\n{\n    Simple s;\n    s.a = 10;\n    s.b = 20;\n    s.c = 30;\n    s.d = 40;\n    s.e = 50;\n\n    return s;\n}\n\nint main(int argc, char** argv)\n{\n    Simple s = TestReturn();\n    TestValue(s);\n    TestReference(s);\n    TestPointer(&s);\n    TestConstReference(s);\n\n    Simple e = {0};\n\n    return 0;\n}\n```\n\n\n1. Simple\n2. \n3. constconst\n4. ebp\n5. \n6. Simple e = {0}\n\nwindows\n\nWinDBGHelloWorld2005.exe`bp HelloWorld2005!main`maing`alt+7``Source Mode`\n\nF10`main``TestReturn`\n{% asset_img begin.png  %}\n\n`ebp``ebp~esp``push``lea eax, [ebp-104h]``ebp-104h``eax``mov eax, qword ptr [ebp-104h]``ebp-104h``lea eax, [ebp-104h]``ebp-104``eax``eax`\n\nTestReturnF11\n{% asset_img TestReturnAssembly.png TestReturn %}\n\nWinDBGdtdump type`dt HelloWorld2005!Simple`Simple\n{% asset_img dtHelloWorld2005Simple.png Simple %}\n\nSimple\n{% asset_img SimpleStructMemory.png Simple %}\n\nSimple`p``a``p+0x000``b``p+0x004` `c``d`DWORD`char``short``char`\n\n\n```asm\nmov dword ptr [ebp-14h], 0Ah ; s.a = 10;\nmov dword ptr [ebp-10h], 14h ; s.b = 20;\nmov byte ptr [ebp-0Ch], 1Eh  ; s.c = 30;\nmov word ptr [ebp-0Ah], 28h  ; s.d = 40;\nmov dword ptr [ebp-8], 32h   ; s.e = 50;\n```\n\nC++`Simple s;`s`ebp-14h``ebp-4``Simple``ebp-14h``Simple``s`a`dd ebp-14h L4`L4DWORD\n{% asset_img ddebp-14hL4.png s %}\n\naecdDWORD`0028cc1e`30161eh401628h`0028cc1e`d`cc`windowscwindows`db ebp-14h L10`dbdump bytedwdump worddddump dword:\n{% asset_img dbebp-14hL10.png s %}\n\na`0a 00 00 00`ddwinDBGsDWORDc0x0088`dd ebp-14h+8 L4`cchar`1e`d\n\n`e``a``unsigned`CSAPP\n\ns`ebp-14h``ebp-4`\n```asm\nmov eax, dword ptr [ebp+8]\n\nmov ecx, dword ptr [ebp-14h]\nmov dword ptr [eax], ecx\n\nmov edx, dword ptr [ebp-10h]\nmov dword ptr [eax+4], edx\n\nmov ecx, dword ptr [ebp-0Ch]\nmov dword ptr [eax+8], ecx\n\nmov edx, dword ptr [ebp-8]\nmov dword ptr [eax+0Ch], edx\n```\n\nebp+8main`move ecx, dowrd ptr [ebp-14h]``a``ecx``mov dword ptr [eax], ecx``ecx``a`eax5\n\n`mov eax, dowrd ptr [ebp+8]``ebp+8`eax`ebp+8``Ctrl+Shift+F5`main\n{% asset_img BeforeCallTestReturn.png TestReturn %}\n\n\n{% asset_img BeforeCallTestReturnStack.png TestReturn %}\n\neax\n\n`TestReturn`\n{% asset_img AfterCallTestReturn.png TestReturn %}\n\n\n{% asset_img AfterCallTestReturnStack.png TestReturn %}\n\n`ebp+8`eax0019fe24\n\ns`0019fe24~0019fe24+14h``main``TestReturn`\n\n\n```asm\npush edx\nmov ecx, ebp\npush eax\nlea edx, [HelloWorld2005!TestReturn+0x74]\ncall HelloWorld2005!_RTC_CheckStackVars\n```\n\n`push eax`_RTC_CheckStackVars`eax`\n\n\n```asm\npop eax\npop edx\npop edi\npop esi\npop ebx\nmov esp, ebp\npop ebp\nret\n```\n\n`eax`_RTC_CheckStackVars`mov eax, dowrd ptr [ebp+8]`~~~~`pop edx``push``ret`\n\neax`0019fe24`14h`main`\n{% asset_img AfterTestReturnReturn.png TestReturn %}\n\n\n{% asset_img BeforeCallTestReturnStack.png main %}\n\n`add esp, 4`eax\n\n\n```asm\nmov ecx, dword ptr [eax]\nmov dword ptr [ebp-11Ch], ecx\n\nmov edx, dword ptr [eax+4]\nmov dword ptr [ebp-118h], edx\n\nmov ecx, dword ptr [eax+8]\nmov dword ptr [ebp-114h], ecx\n\nmov edx, dword ptr [eax+0Ch]\nmov dword ptr [ebp-110h], edx\n```\n\n`0019fe24``ebp-11Ch`\n```asm\nmov eax, dword ptr [ebp-11Ch]\nmov dword ptr [ebp-14h], eax\n\nmov ecx, dword ptr [ebp-118h]\nmov dword ptr [ebp-10h], ecx\n\nmov edx, dword ptr [ebp-114h]\nmov dword ptr [ebp-0Ch], edx\n\nmov eax, dword ptr [ebp-110h]\nmov dword ptr [ebp-8], eax\n```\n\n`ebp-11Ch``ebp-14h`release\n\n`ebp-14h~ebp-8`44`TestReturn`\n\n---\n\n`TestValue`s`ebp-14h~ebp-8``TestValue`\n{% asset_img CallTestValue.png TestValue %}\n\n`sub esp, 10h``TestValue`\n```asm\nmov eax, esp\n\nmov ecx, dword ptr [ebp-14h]\nmov dowrd ptr [eax], ecx\n\nmov edx, dword ptr [ebp-10h]\nmov dword ptr [eax+4], edx\n\nmov ecx, dowrd ptr [ebp-0Ch]\nmov dword ptr [eax+8], ecx\n\nmov edx, dword ptr [ebp-8]\nmov dword ptr [eax+0Ch], edx\n```\n\n`eax``esp``esp``s``esp~esp+10h`16s`TestValue``TestValue``TestValue`\n\n`esp+8`\n\n`TestReference`\n{% asset_img CallTestReference.png TestReference %}\n\n`TestValue``add esp, 10h`\n\n`lea eax, [ebp-14h]``ebp-14h`s`eax``push eax``TestReference``esp+8``esp``esp+4``esp+8``s.a=10`\n```asm\nlea eax, [ebp+8]            ;\nmov ecx, 0ah;               ;10ecx\nmov dword ptr [eax], ecx    ;10\n```\n\n\n\n`TestPointer``TestReference`\n{% asset_img CallTestPointer.png TestPointer %}\n\n\n\n`TestConstReference`\n{% asset_img CallTestConstReference.png TestConstReference %}\n\n\n1.  VS2005\n2.  \n3. const \n\nconstC++1\n\n---\n\nconstconstconstbugconstconst\n\n`Simple e = {0}`\n{% asset_img InitSimple.png  %}\n\n\n```asm\nmov dword ptr [ebp-2Ch], 0      ;a\nmov dword ptr [ebp-28h], eax    ;b\nmov dword ptr [ebp-24h], eax    ;cd\nmov dword ptr [ebp-20h], eax    ;e\n```\n\nVSDWORD4`memset`\n\n`eax``xor eax, eax``xor`0eax0`mov eax, 0`\n```asm\nbacccccccc      ;mov     edx,0CCCCCCCCh\n33c0            ;xor     eax,eax\n```\n\n`mov``xor`xor\n\ne`dd ebp-2Ch L4`\n{% asset_img ddebp-2ChL4.png e %}\n\n0\n\nmainreleaserelease\n\n\n\n## \n\n### WinDBG\n\n\n\n### \n1. ebp\n2. ebp+4\n3. ebp+8\n4. `call``eip`ret`pop eip`\n5. `mov eax, 0`5`xor eax, eax`\n6. `lea eax, [ebp+8]``mov eax, dword ptr [ebp+8]`\n\n### C++\n1. `memset`DWORD\n2. VS2005\n3. const","source":"_posts/windbg/windbg-chapter2.md","raw":"---\ntitle: WinDBG\ndate: 2016-04-20 13:19:11\ncategories: windbg\ntags: [windbg,disassembly,c++]\n---\n\n## \nC++releaseexerelease\n\nstructconst\n<!--more-->\n## \n\n```cpp\ntypedef struct Simple\n{\n    int a;\n    int b;\n    char c;\n    short d;\n    unsigned int e;\n} Simple;\n\nvoid TestValue(Simple s)\n{\n\n}\n\nvoid TestReference(Simple& s)\n{\n\n}\n\nvoid TestPointer(Simple* s)\n{\n\n}\n\nvoid TestConstReference(const Simple& s)\n{\n\n}\n\nSimple TestReturn()\n{\n    Simple s;\n    s.a = 10;\n    s.b = 20;\n    s.c = 30;\n    s.d = 40;\n    s.e = 50;\n\n    return s;\n}\n\nint main(int argc, char** argv)\n{\n    Simple s = TestReturn();\n    TestValue(s);\n    TestReference(s);\n    TestPointer(&s);\n    TestConstReference(s);\n\n    Simple e = {0};\n\n    return 0;\n}\n```\n\n\n1. Simple\n2. \n3. constconst\n4. ebp\n5. \n6. Simple e = {0}\n\nwindows\n\nWinDBGHelloWorld2005.exe`bp HelloWorld2005!main`maing`alt+7``Source Mode`\n\nF10`main``TestReturn`\n{% asset_img begin.png  %}\n\n`ebp``ebp~esp``push``lea eax, [ebp-104h]``ebp-104h``eax``mov eax, qword ptr [ebp-104h]``ebp-104h``lea eax, [ebp-104h]``ebp-104``eax``eax`\n\nTestReturnF11\n{% asset_img TestReturnAssembly.png TestReturn %}\n\nWinDBGdtdump type`dt HelloWorld2005!Simple`Simple\n{% asset_img dtHelloWorld2005Simple.png Simple %}\n\nSimple\n{% asset_img SimpleStructMemory.png Simple %}\n\nSimple`p``a``p+0x000``b``p+0x004` `c``d`DWORD`char``short``char`\n\n\n```asm\nmov dword ptr [ebp-14h], 0Ah ; s.a = 10;\nmov dword ptr [ebp-10h], 14h ; s.b = 20;\nmov byte ptr [ebp-0Ch], 1Eh  ; s.c = 30;\nmov word ptr [ebp-0Ah], 28h  ; s.d = 40;\nmov dword ptr [ebp-8], 32h   ; s.e = 50;\n```\n\nC++`Simple s;`s`ebp-14h``ebp-4``Simple``ebp-14h``Simple``s`a`dd ebp-14h L4`L4DWORD\n{% asset_img ddebp-14hL4.png s %}\n\naecdDWORD`0028cc1e`30161eh401628h`0028cc1e`d`cc`windowscwindows`db ebp-14h L10`dbdump bytedwdump worddddump dword:\n{% asset_img dbebp-14hL10.png s %}\n\na`0a 00 00 00`ddwinDBGsDWORDc0x0088`dd ebp-14h+8 L4`cchar`1e`d\n\n`e``a``unsigned`CSAPP\n\ns`ebp-14h``ebp-4`\n```asm\nmov eax, dword ptr [ebp+8]\n\nmov ecx, dword ptr [ebp-14h]\nmov dword ptr [eax], ecx\n\nmov edx, dword ptr [ebp-10h]\nmov dword ptr [eax+4], edx\n\nmov ecx, dword ptr [ebp-0Ch]\nmov dword ptr [eax+8], ecx\n\nmov edx, dword ptr [ebp-8]\nmov dword ptr [eax+0Ch], edx\n```\n\nebp+8main`move ecx, dowrd ptr [ebp-14h]``a``ecx``mov dword ptr [eax], ecx``ecx``a`eax5\n\n`mov eax, dowrd ptr [ebp+8]``ebp+8`eax`ebp+8``Ctrl+Shift+F5`main\n{% asset_img BeforeCallTestReturn.png TestReturn %}\n\n\n{% asset_img BeforeCallTestReturnStack.png TestReturn %}\n\neax\n\n`TestReturn`\n{% asset_img AfterCallTestReturn.png TestReturn %}\n\n\n{% asset_img AfterCallTestReturnStack.png TestReturn %}\n\n`ebp+8`eax0019fe24\n\ns`0019fe24~0019fe24+14h``main``TestReturn`\n\n\n```asm\npush edx\nmov ecx, ebp\npush eax\nlea edx, [HelloWorld2005!TestReturn+0x74]\ncall HelloWorld2005!_RTC_CheckStackVars\n```\n\n`push eax`_RTC_CheckStackVars`eax`\n\n\n```asm\npop eax\npop edx\npop edi\npop esi\npop ebx\nmov esp, ebp\npop ebp\nret\n```\n\n`eax`_RTC_CheckStackVars`mov eax, dowrd ptr [ebp+8]`~~~~`pop edx``push``ret`\n\neax`0019fe24`14h`main`\n{% asset_img AfterTestReturnReturn.png TestReturn %}\n\n\n{% asset_img BeforeCallTestReturnStack.png main %}\n\n`add esp, 4`eax\n\n\n```asm\nmov ecx, dword ptr [eax]\nmov dword ptr [ebp-11Ch], ecx\n\nmov edx, dword ptr [eax+4]\nmov dword ptr [ebp-118h], edx\n\nmov ecx, dword ptr [eax+8]\nmov dword ptr [ebp-114h], ecx\n\nmov edx, dword ptr [eax+0Ch]\nmov dword ptr [ebp-110h], edx\n```\n\n`0019fe24``ebp-11Ch`\n```asm\nmov eax, dword ptr [ebp-11Ch]\nmov dword ptr [ebp-14h], eax\n\nmov ecx, dword ptr [ebp-118h]\nmov dword ptr [ebp-10h], ecx\n\nmov edx, dword ptr [ebp-114h]\nmov dword ptr [ebp-0Ch], edx\n\nmov eax, dword ptr [ebp-110h]\nmov dword ptr [ebp-8], eax\n```\n\n`ebp-11Ch``ebp-14h`release\n\n`ebp-14h~ebp-8`44`TestReturn`\n\n---\n\n`TestValue`s`ebp-14h~ebp-8``TestValue`\n{% asset_img CallTestValue.png TestValue %}\n\n`sub esp, 10h``TestValue`\n```asm\nmov eax, esp\n\nmov ecx, dword ptr [ebp-14h]\nmov dowrd ptr [eax], ecx\n\nmov edx, dword ptr [ebp-10h]\nmov dword ptr [eax+4], edx\n\nmov ecx, dowrd ptr [ebp-0Ch]\nmov dword ptr [eax+8], ecx\n\nmov edx, dword ptr [ebp-8]\nmov dword ptr [eax+0Ch], edx\n```\n\n`eax``esp``esp``s``esp~esp+10h`16s`TestValue``TestValue``TestValue`\n\n`esp+8`\n\n`TestReference`\n{% asset_img CallTestReference.png TestReference %}\n\n`TestValue``add esp, 10h`\n\n`lea eax, [ebp-14h]``ebp-14h`s`eax``push eax``TestReference``esp+8``esp``esp+4``esp+8``s.a=10`\n```asm\nlea eax, [ebp+8]            ;\nmov ecx, 0ah;               ;10ecx\nmov dword ptr [eax], ecx    ;10\n```\n\n\n\n`TestPointer``TestReference`\n{% asset_img CallTestPointer.png TestPointer %}\n\n\n\n`TestConstReference`\n{% asset_img CallTestConstReference.png TestConstReference %}\n\n\n1.  VS2005\n2.  \n3. const \n\nconstC++1\n\n---\n\nconstconstconstbugconstconst\n\n`Simple e = {0}`\n{% asset_img InitSimple.png  %}\n\n\n```asm\nmov dword ptr [ebp-2Ch], 0      ;a\nmov dword ptr [ebp-28h], eax    ;b\nmov dword ptr [ebp-24h], eax    ;cd\nmov dword ptr [ebp-20h], eax    ;e\n```\n\nVSDWORD4`memset`\n\n`eax``xor eax, eax``xor`0eax0`mov eax, 0`\n```asm\nbacccccccc      ;mov     edx,0CCCCCCCCh\n33c0            ;xor     eax,eax\n```\n\n`mov``xor`xor\n\ne`dd ebp-2Ch L4`\n{% asset_img ddebp-2ChL4.png e %}\n\n0\n\nmainreleaserelease\n\n\n\n## \n\n### WinDBG\n\n\n\n### \n1. ebp\n2. ebp+4\n3. ebp+8\n4. `call``eip`ret`pop eip`\n5. `mov eax, 0`5`xor eax, eax`\n6. `lea eax, [ebp+8]``mov eax, dword ptr [ebp+8]`\n\n### C++\n1. `memset`DWORD\n2. VS2005\n3. const","slug":"windbg-windbg-chapter2","published":1,"updated":"2018-06-25T11:14:49.163Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtnh000c2gus6uvwuw1m","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>C++releaseexerelease</p>\n<p>structconst<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Simple</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> c;</span><br><span class=\"line\">    <span class=\"keyword\">short</span> d;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> e;</span><br><span class=\"line\">&#125; Simple;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestValue</span><span class=\"params\">(Simple s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestReference</span><span class=\"params\">(Simple&amp; s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestPointer</span><span class=\"params\">(Simple* s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestConstReference</span><span class=\"params\">(<span class=\"keyword\">const</span> Simple&amp; s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">Simple <span class=\"title\">TestReturn</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Simple s;</span><br><span class=\"line\">    s.a = <span class=\"number\">10</span>;</span><br><span class=\"line\">    s.b = <span class=\"number\">20</span>;</span><br><span class=\"line\">    s.c = <span class=\"number\">30</span>;</span><br><span class=\"line\">    s.d = <span class=\"number\">40</span>;</span><br><span class=\"line\">    s.e = <span class=\"number\">50</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Simple s = TestReturn();</span><br><span class=\"line\">    TestValue(s);</span><br><span class=\"line\">    TestReference(s);</span><br><span class=\"line\">    TestPointer(&amp;s);</span><br><span class=\"line\">    TestConstReference(s);</span><br><span class=\"line\"></span><br><span class=\"line\">    Simple e = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li>Simple</li>\n<li></li>\n<li>constconst</li>\n<li>ebp</li>\n<li></li>\n<li>Simple e = {0}</li>\n</ol>\n<p>windows</p>\n<p>WinDBGHelloWorld2005.exe<code>bp HelloWorld2005!main</code>maing<code>alt+7</code><code>Source Mode</code></p>\n<p>F10<code>main</code><code>TestReturn</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/begin.png\" title=\"\"></p>\n<p><code>ebp</code><code>ebp~esp</code><code>push</code><code>lea eax, [ebp-104h]</code><code>ebp-104h</code><code>eax</code><code>mov eax, qword ptr [ebp-104h]</code><code>ebp-104h</code><code>lea eax, [ebp-104h]</code><code>ebp-104</code><code>eax</code><code>eax</code></p>\n<p>TestReturnF11<br><img src=\"/2016/04/20/windbg-windbg-chapter2/TestReturnAssembly.png\" title=\"TestReturn\"></p>\n<p>WinDBGdtdump type<code>dt HelloWorld2005!Simple</code>Simple<br><img src=\"/2016/04/20/windbg-windbg-chapter2/dtHelloWorld2005Simple.png\" title=\"Simple\"></p>\n<p>Simple<br><img src=\"/2016/04/20/windbg-windbg-chapter2/SimpleStructMemory.png\" title=\"Simple\"></p>\n<p>Simple<code>p</code><code>a</code><code>p+0x000</code><code>b</code><code>p+0x004</code> <code>c</code><code>d</code>DWORD<code>char</code><code>short</code><code>char</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-14h], 0Ah ; s.a = 10;</span><br><span class=\"line\">mov dword ptr [ebp-10h], 14h ; s.b = 20;</span><br><span class=\"line\">mov byte ptr [ebp-0Ch], 1Eh  ; s.c = 30;</span><br><span class=\"line\">mov word ptr [ebp-0Ah], 28h  ; s.d = 40;</span><br><span class=\"line\">mov dword ptr [ebp-8], 32h   ; s.e = 50;</span><br></pre></td></tr></table></figure></p>\n<p>C++<code>Simple s;</code>s<code>ebp-14h</code><code>ebp-4</code><code>Simple</code><code>ebp-14h</code><code>Simple</code><code>s</code>a<code>dd ebp-14h L4</code>L4DWORD<br><img src=\"/2016/04/20/windbg-windbg-chapter2/ddebp-14hL4.png\" title=\"s\"></p>\n<p>aecdDWORD<code>0028cc1e</code>30161eh401628h<code>0028cc1e</code>d<code>cc</code>windowscwindows<code>db ebp-14h L10</code>dbdump bytedwdump worddddump dword:<br></p>\n<p>a<code>0a 00 00 00</code>ddwinDBGsDWORDc0x0088<code>dd ebp-14h+8 L4</code>cchar<code>1e</code>d</p>\n<p><code>e</code><code>a</code><code>unsigned</code>CSAPP</p>\n<p>s<code>ebp-14h</code><code>ebp-4</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp+8]</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dword ptr [eax], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-10h]</span><br><span class=\"line\">mov dword ptr [eax+4], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-0Ch]</span><br><span class=\"line\">mov dword ptr [eax+8], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+0Ch], edx</span><br></pre></td></tr></table></figure></p>\n<p>ebp+8main<code>move ecx, dowrd ptr [ebp-14h]</code><code>a</code><code>ecx</code><code>mov dword ptr [eax], ecx</code><code>ecx</code><code>a</code>eax5</p>\n<p><code>mov eax, dowrd ptr [ebp+8]</code><code>ebp+8</code>eax<code>ebp+8</code><code>Ctrl+Shift+F5</code>main<br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturnStack.png\" title=\"TestReturn\"></p>\n<p>eax</p>\n<p><code>TestReturn</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterCallTestReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterCallTestReturnStack.png\" title=\"TestReturn\"></p>\n<p><code>ebp+8</code>eax0019fe24</p>\n<p>s<code>0019fe24~0019fe24+14h</code><code>main</code><code>TestReturn</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push edx</span><br><span class=\"line\">mov ecx, ebp</span><br><span class=\"line\">push eax</span><br><span class=\"line\">lea edx, [HelloWorld2005!TestReturn+0x74]</span><br><span class=\"line\">call HelloWorld2005!_RTC_CheckStackVars</span><br></pre></td></tr></table></figure></p>\n<p><code>push eax</code>_RTC_CheckStackVars<code>eax</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pop eax</span><br><span class=\"line\">pop edx</span><br><span class=\"line\">pop edi</span><br><span class=\"line\">pop esi</span><br><span class=\"line\">pop ebx</span><br><span class=\"line\">mov esp, ebp</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure></p>\n<p><code>eax</code>_RTC_CheckStackVars<code>mov eax, dowrd ptr [ebp+8]</code>~~~~<code>pop edx</code><code>push</code><code>ret</code></p>\n<p>eax<code>0019fe24</code>14h<code>main</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterTestReturnReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturnStack.png\" title=\"main\"></p>\n<p><code>add esp, 4</code>eax</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [eax]</span><br><span class=\"line\">mov dword ptr [ebp-11Ch], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [eax+4]</span><br><span class=\"line\">mov dword ptr [ebp-118h], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [eax+8]</span><br><span class=\"line\">mov dword ptr [ebp-114h], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [eax+0Ch]</span><br><span class=\"line\">mov dword ptr [ebp-110h], edx</span><br></pre></td></tr></table></figure></p>\n<p><code>0019fe24</code><code>ebp-11Ch</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-11Ch]</span><br><span class=\"line\">mov dword ptr [ebp-14h], eax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-118h]</span><br><span class=\"line\">mov dword ptr [ebp-10h], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-114h]</span><br><span class=\"line\">mov dword ptr [ebp-0Ch], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-110h]</span><br><span class=\"line\">mov dword ptr [ebp-8], eax</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-11Ch</code><code>ebp-14h</code>release</p>\n<p><code>ebp-14h~ebp-8</code>44<code>TestReturn</code></p>\n<hr>\n<p><code>TestValue</code>s<code>ebp-14h~ebp-8</code><code>TestValue</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestValue.png\" title=\"TestValue\"></p>\n<p><code>sub esp, 10h</code><code>TestValue</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, esp</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dowrd ptr [eax], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-10h]</span><br><span class=\"line\">mov dword ptr [eax+4], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dowrd ptr [ebp-0Ch]</span><br><span class=\"line\">mov dword ptr [eax+8], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+0Ch], edx</span><br></pre></td></tr></table></figure></p>\n<p><code>eax</code><code>esp</code><code>esp</code><code>s</code><code>esp~esp+10h</code>16s<code>TestValue</code><code>TestValue</code><code>TestValue</code></p>\n<p><code>esp+8</code></p>\n<p><code>TestReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestReference.png\" title=\"TestReference\"></p>\n<p><code>TestValue</code><code>add esp, 10h</code></p>\n<p><code>lea eax, [ebp-14h]</code><code>ebp-14h</code>s<code>eax</code><code>push eax</code><code>TestReference</code><code>esp+8</code><code>esp</code><code>esp+4</code><code>esp+8</code><code>s.a=10</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea eax, [ebp+8]            ;</span><br><span class=\"line\">mov ecx, 0ah;               ;10ecx</span><br><span class=\"line\">mov dword ptr [eax], ecx    ;10</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>TestPointer</code><code>TestReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestPointer.png\" title=\"TestPointer\"></p>\n<p></p>\n<p><code>TestConstReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestConstReference.png\" title=\"TestConstReference\"></p>\n<p></p>\n<ol>\n<li> VS2005</li>\n<li> </li>\n<li>const </li>\n</ol>\n<p>constC++1</p>\n<hr>\n<p>constconstconstbugconstconst</p>\n<p><code>Simple e = {0}</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/InitSimple.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-2Ch], 0      ;a</span><br><span class=\"line\">mov dword ptr [ebp-28h], eax    ;b</span><br><span class=\"line\">mov dword ptr [ebp-24h], eax    ;cd</span><br><span class=\"line\">mov dword ptr [ebp-20h], eax    ;e</span><br></pre></td></tr></table></figure></p>\n<p>VSDWORD4<code>memset</code></p>\n<p><code>eax</code><code>xor eax, eax</code><code>xor</code>0eax0<code>mov eax, 0</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bacccccccc      ;mov     edx,0CCCCCCCCh</span><br><span class=\"line\">33c0            ;xor     eax,eax</span><br></pre></td></tr></table></figure></p>\n<p><code>mov</code><code>xor</code>xor</p>\n<p>e<code>dd ebp-2Ch L4</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/ddebp-2ChL4.png\" title=\"e\"></p>\n<p>0</p>\n<p>mainreleaserelease</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>ebp</li>\n<li>ebp+4</li>\n<li>ebp+8</li>\n<li><code>call</code><code>eip</code>ret<code>pop eip</code></li>\n<li><code>mov eax, 0</code>5<code>xor eax, eax</code></li>\n<li><code>lea eax, [ebp+8]</code><code>mov eax, dword ptr [ebp+8]</code></li>\n</ol>\n<h3 id=\"C\"><a href=\"#C\" class=\"headerlink\" title=\"C++\"></a>C++</h3><ol>\n<li><code>memset</code>DWORD</li>\n<li>VS2005</li>\n<li>const</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>C++releaseexerelease</p>\n<p>structconst<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Simple</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> c;</span><br><span class=\"line\">    <span class=\"keyword\">short</span> d;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> e;</span><br><span class=\"line\">&#125; Simple;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestValue</span><span class=\"params\">(Simple s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestReference</span><span class=\"params\">(Simple&amp; s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestPointer</span><span class=\"params\">(Simple* s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestConstReference</span><span class=\"params\">(<span class=\"keyword\">const</span> Simple&amp; s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">Simple <span class=\"title\">TestReturn</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Simple s;</span><br><span class=\"line\">    s.a = <span class=\"number\">10</span>;</span><br><span class=\"line\">    s.b = <span class=\"number\">20</span>;</span><br><span class=\"line\">    s.c = <span class=\"number\">30</span>;</span><br><span class=\"line\">    s.d = <span class=\"number\">40</span>;</span><br><span class=\"line\">    s.e = <span class=\"number\">50</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Simple s = TestReturn();</span><br><span class=\"line\">    TestValue(s);</span><br><span class=\"line\">    TestReference(s);</span><br><span class=\"line\">    TestPointer(&amp;s);</span><br><span class=\"line\">    TestConstReference(s);</span><br><span class=\"line\"></span><br><span class=\"line\">    Simple e = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li>Simple</li>\n<li></li>\n<li>constconst</li>\n<li>ebp</li>\n<li></li>\n<li>Simple e = {0}</li>\n</ol>\n<p>windows</p>\n<p>WinDBGHelloWorld2005.exe<code>bp HelloWorld2005!main</code>maing<code>alt+7</code><code>Source Mode</code></p>\n<p>F10<code>main</code><code>TestReturn</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/begin.png\" title=\"\"></p>\n<p><code>ebp</code><code>ebp~esp</code><code>push</code><code>lea eax, [ebp-104h]</code><code>ebp-104h</code><code>eax</code><code>mov eax, qword ptr [ebp-104h]</code><code>ebp-104h</code><code>lea eax, [ebp-104h]</code><code>ebp-104</code><code>eax</code><code>eax</code></p>\n<p>TestReturnF11<br><img src=\"/2016/04/20/windbg-windbg-chapter2/TestReturnAssembly.png\" title=\"TestReturn\"></p>\n<p>WinDBGdtdump type<code>dt HelloWorld2005!Simple</code>Simple<br><img src=\"/2016/04/20/windbg-windbg-chapter2/dtHelloWorld2005Simple.png\" title=\"Simple\"></p>\n<p>Simple<br><img src=\"/2016/04/20/windbg-windbg-chapter2/SimpleStructMemory.png\" title=\"Simple\"></p>\n<p>Simple<code>p</code><code>a</code><code>p+0x000</code><code>b</code><code>p+0x004</code> <code>c</code><code>d</code>DWORD<code>char</code><code>short</code><code>char</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-14h], 0Ah ; s.a = 10;</span><br><span class=\"line\">mov dword ptr [ebp-10h], 14h ; s.b = 20;</span><br><span class=\"line\">mov byte ptr [ebp-0Ch], 1Eh  ; s.c = 30;</span><br><span class=\"line\">mov word ptr [ebp-0Ah], 28h  ; s.d = 40;</span><br><span class=\"line\">mov dword ptr [ebp-8], 32h   ; s.e = 50;</span><br></pre></td></tr></table></figure></p>\n<p>C++<code>Simple s;</code>s<code>ebp-14h</code><code>ebp-4</code><code>Simple</code><code>ebp-14h</code><code>Simple</code><code>s</code>a<code>dd ebp-14h L4</code>L4DWORD<br><img src=\"/2016/04/20/windbg-windbg-chapter2/ddebp-14hL4.png\" title=\"s\"></p>\n<p>aecdDWORD<code>0028cc1e</code>30161eh401628h<code>0028cc1e</code>d<code>cc</code>windowscwindows<code>db ebp-14h L10</code>dbdump bytedwdump worddddump dword:<br></p>\n<p>a<code>0a 00 00 00</code>ddwinDBGsDWORDc0x0088<code>dd ebp-14h+8 L4</code>cchar<code>1e</code>d</p>\n<p><code>e</code><code>a</code><code>unsigned</code>CSAPP</p>\n<p>s<code>ebp-14h</code><code>ebp-4</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp+8]</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dword ptr [eax], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-10h]</span><br><span class=\"line\">mov dword ptr [eax+4], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-0Ch]</span><br><span class=\"line\">mov dword ptr [eax+8], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+0Ch], edx</span><br></pre></td></tr></table></figure></p>\n<p>ebp+8main<code>move ecx, dowrd ptr [ebp-14h]</code><code>a</code><code>ecx</code><code>mov dword ptr [eax], ecx</code><code>ecx</code><code>a</code>eax5</p>\n<p><code>mov eax, dowrd ptr [ebp+8]</code><code>ebp+8</code>eax<code>ebp+8</code><code>Ctrl+Shift+F5</code>main<br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturnStack.png\" title=\"TestReturn\"></p>\n<p>eax</p>\n<p><code>TestReturn</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterCallTestReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterCallTestReturnStack.png\" title=\"TestReturn\"></p>\n<p><code>ebp+8</code>eax0019fe24</p>\n<p>s<code>0019fe24~0019fe24+14h</code><code>main</code><code>TestReturn</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push edx</span><br><span class=\"line\">mov ecx, ebp</span><br><span class=\"line\">push eax</span><br><span class=\"line\">lea edx, [HelloWorld2005!TestReturn+0x74]</span><br><span class=\"line\">call HelloWorld2005!_RTC_CheckStackVars</span><br></pre></td></tr></table></figure></p>\n<p><code>push eax</code>_RTC_CheckStackVars<code>eax</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pop eax</span><br><span class=\"line\">pop edx</span><br><span class=\"line\">pop edi</span><br><span class=\"line\">pop esi</span><br><span class=\"line\">pop ebx</span><br><span class=\"line\">mov esp, ebp</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure></p>\n<p><code>eax</code>_RTC_CheckStackVars<code>mov eax, dowrd ptr [ebp+8]</code>~~~~<code>pop edx</code><code>push</code><code>ret</code></p>\n<p>eax<code>0019fe24</code>14h<code>main</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/AfterTestReturnReturn.png\" title=\"TestReturn\"></p>\n<p><br><img src=\"/2016/04/20/windbg-windbg-chapter2/BeforeCallTestReturnStack.png\" title=\"main\"></p>\n<p><code>add esp, 4</code>eax</p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [eax]</span><br><span class=\"line\">mov dword ptr [ebp-11Ch], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [eax+4]</span><br><span class=\"line\">mov dword ptr [ebp-118h], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [eax+8]</span><br><span class=\"line\">mov dword ptr [ebp-114h], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [eax+0Ch]</span><br><span class=\"line\">mov dword ptr [ebp-110h], edx</span><br></pre></td></tr></table></figure></p>\n<p><code>0019fe24</code><code>ebp-11Ch</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-11Ch]</span><br><span class=\"line\">mov dword ptr [ebp-14h], eax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-118h]</span><br><span class=\"line\">mov dword ptr [ebp-10h], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-114h]</span><br><span class=\"line\">mov dword ptr [ebp-0Ch], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-110h]</span><br><span class=\"line\">mov dword ptr [ebp-8], eax</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-11Ch</code><code>ebp-14h</code>release</p>\n<p><code>ebp-14h~ebp-8</code>44<code>TestReturn</code></p>\n<hr>\n<p><code>TestValue</code>s<code>ebp-14h~ebp-8</code><code>TestValue</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestValue.png\" title=\"TestValue\"></p>\n<p><code>sub esp, 10h</code><code>TestValue</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, esp</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dowrd ptr [eax], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-10h]</span><br><span class=\"line\">mov dword ptr [eax+4], edx</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dowrd ptr [ebp-0Ch]</span><br><span class=\"line\">mov dword ptr [eax+8], ecx</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-8]</span><br><span class=\"line\">mov dword ptr [eax+0Ch], edx</span><br></pre></td></tr></table></figure></p>\n<p><code>eax</code><code>esp</code><code>esp</code><code>s</code><code>esp~esp+10h</code>16s<code>TestValue</code><code>TestValue</code><code>TestValue</code></p>\n<p><code>esp+8</code></p>\n<p><code>TestReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestReference.png\" title=\"TestReference\"></p>\n<p><code>TestValue</code><code>add esp, 10h</code></p>\n<p><code>lea eax, [ebp-14h]</code><code>ebp-14h</code>s<code>eax</code><code>push eax</code><code>TestReference</code><code>esp+8</code><code>esp</code><code>esp+4</code><code>esp+8</code><code>s.a=10</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea eax, [ebp+8]            ;</span><br><span class=\"line\">mov ecx, 0ah;               ;10ecx</span><br><span class=\"line\">mov dword ptr [eax], ecx    ;10</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>TestPointer</code><code>TestReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestPointer.png\" title=\"TestPointer\"></p>\n<p></p>\n<p><code>TestConstReference</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/CallTestConstReference.png\" title=\"TestConstReference\"></p>\n<p></p>\n<ol>\n<li> VS2005</li>\n<li> </li>\n<li>const </li>\n</ol>\n<p>constC++1</p>\n<hr>\n<p>constconstconstbugconstconst</p>\n<p><code>Simple e = {0}</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/InitSimple.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-2Ch], 0      ;a</span><br><span class=\"line\">mov dword ptr [ebp-28h], eax    ;b</span><br><span class=\"line\">mov dword ptr [ebp-24h], eax    ;cd</span><br><span class=\"line\">mov dword ptr [ebp-20h], eax    ;e</span><br></pre></td></tr></table></figure></p>\n<p>VSDWORD4<code>memset</code></p>\n<p><code>eax</code><code>xor eax, eax</code><code>xor</code>0eax0<code>mov eax, 0</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bacccccccc      ;mov     edx,0CCCCCCCCh</span><br><span class=\"line\">33c0            ;xor     eax,eax</span><br></pre></td></tr></table></figure></p>\n<p><code>mov</code><code>xor</code>xor</p>\n<p>e<code>dd ebp-2Ch L4</code><br><img src=\"/2016/04/20/windbg-windbg-chapter2/ddebp-2ChL4.png\" title=\"e\"></p>\n<p>0</p>\n<p>mainreleaserelease</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"WinDBG\"><a href=\"#WinDBG\" class=\"headerlink\" title=\"WinDBG\"></a>WinDBG</h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>ebp</li>\n<li>ebp+4</li>\n<li>ebp+8</li>\n<li><code>call</code><code>eip</code>ret<code>pop eip</code></li>\n<li><code>mov eax, 0</code>5<code>xor eax, eax</code></li>\n<li><code>lea eax, [ebp+8]</code><code>mov eax, dword ptr [ebp+8]</code></li>\n</ol>\n<h3 id=\"C\"><a href=\"#C\" class=\"headerlink\" title=\"C++\"></a>C++</h3><ol>\n<li><code>memset</code>DWORD</li>\n<li>VS2005</li>\n<li>const</li>\n</ol>"},{"title":"WinDBG","date":"2016-04-26T04:22:37.000Z","_content":"\n## \n\n1. \n2. \n3. \n4. \n5. \n6. \n7. \n8. \n9. \n<!--more-->\n## \n\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : e(12)\n        , c(3)\n        , a(12)\n        , b(1)\n        , f('l')\n    {\n        d = 19;\n\n        VirtualFunc1();\n    }\n\n    ~TestBase()\n    {\n        a = 12;\n    }\n\npublic:\n    virtual void VirtualFunc1()\n    {\n        a += 12;\n    }\n\n    virtual void VirtualFunc2()\n    {\n        b += 22;\n    }\n\npublic:\n    void NormalFunc1()\n    {\n        c += 14;\n    }\n\nprotected:\n    int a;\n    int b;\n    char c;\n    char d;\n    short e;\n\nprivate:\n    char f;\n};\n\nclass TestDerive \n    : public TestBase\n{\npublic:\n    TestDerive(int a)\n        : TestBase()\n        , f(a)\n    {\n        VirtualFunc1();\n    }\n\n    ~TestDerive()\n    {\n        b = 12;\n    }\n\npublic:\n    virtual void VirtualFunc1()\n    {\n        a += 99;\n    }\n\npublic:\n    void NormalFunc1()\n    {\n        c += 54;\n    }\n\nprivate:\n    int f;\n};\n\nint main(int argc, char** argv)\n{\n    typedef void (TestBase::*BaseNormalFuncType)();\n    BaseNormalFuncType baseNormalFuncPointer = &TestBase::NormalFunc1;\n\n    typedef void (TestDerive::*DeriveNormalFuncType)();\n    DeriveNormalFuncType deriveNormalFuncPointer = &TestDerive::NormalFunc1;\n\n    typedef void (TestBase::*BaseVirtualFunc1Type)();\n    BaseVirtualFunc1Type baseVirtualFunc1Pointer = &TestBase::VirtualFunc1;\n\n    typedef void (TestBase::*BaseVirtualFunc2Type)();\n    BaseVirtualFunc2Type baseVirtualFunc2Pointer = &TestBase::VirtualFunc2;\n\n    typedef void (TestDerive::*DeriveVirtualFunc1Type)();\n    DeriveVirtualFunc1Type deriveVirtualFunc1Pointer = &TestDerive::VirtualFunc1;\n\n    typedef void (TestDerive::*DeriveVirtualFunc2Type)();\n    DeriveVirtualFunc2Type deriveVirtualFunc2Pointer = &TestDerive::VirtualFunc2;\n\n    TestBase base1;\n    base1.NormalFunc1();\n    base1.VirtualFunc1();\n    base1.VirtualFunc2();\n\n    TestDerive derive1(77);\n    derive1.NormalFunc1();\n    derive1.VirtualFunc1();\n    derive1.VirtualFunc2();\n\n\n    (base1.*baseNormalFuncPointer)();\n    (derive1.*deriveNormalFuncPointer)();\n    (derive1.*baseNormalFuncPointer)();\n    \n    (base1.*baseVirtualFunc1Pointer)();\n    (base1.*baseVirtualFunc2Pointer)();\n    \n    (derive1.*baseVirtualFunc1Pointer)();\n    (derive1.*baseVirtualFunc2Pointer)();\n\n    (derive1.*deriveVirtualFunc1Pointer)();\n    (derive1.*deriveVirtualFunc2Pointer)();\n}\n```\n\nwindbg\n\n`typedef void (TestBase::*BaseNormalFuncType)()`\n{% asset_img AssignMemberFuncPointer.png  %}\n\ngoogle\n\n`this``ecx`\n```asm\nmov dword ptr [ebp-2Ch], offset HelloWorld2005!TestBase::`vcall'{0}'\nmov dword ptr [ebp-38h], offset HelloWorld2005!TestBase::`vcall'{4}'\nmov dword ptr [ebp-44h], offset HelloWorld2005!TestBase::`vcall'{0}'\nmov dword ptr [ebp-50h], offset HelloWorld2005!TestBase::`vcall'{4}'\n```\n\n`TestDerive``TestBase`\n\n\n{% asset_img FirstClassVariable.png TestBase %}\n\n`this``0019febc\n{% asset_img TestBaseConstructor.png TestBase %}\n\n\n1. `this``ebp-8`\n2. `ebp-8``eax`\n3. `this`\n\n`entry``entry``x``TestBase`\n{% asset_img TestBaseVirtualFunctionsAddress.png TestBase %}\n\n`dd eax``this`\n{% asset_img TestBaseLookupThis.png this %}\n\n4`00404130``dd 00404130`\n{% asset_img TestBaseContentOfVirtualTable.png TestBase %}\n\n`hack`\n\n`dt``TestBase`\n{% asset_img dtTestBase.png TestBase %}\n\n\n{% asset_img TestBaseInitSequence.png TestBase %}\n\n\n\n`VirtualFunc1`\n{% asset_img TestBaseVirtualFunc2Function.png VirtualFunc1 %}\n\n`TestDerive``this``0019fe9c`\n{% asset_img TestDeriveConstructor.png TestDerive %}\n\n`dt``TestDerive`\n{% asset_img dtTestDerive.png TestDerive %}\n\n`TestDerive``TestBase``TestDerive``f`\n```asm\nmov dword ptr [ebp-14h], ecx\nmov ecx, dword ptr [ebp-14h]\ncall HelloWorld2005!TestBase::TestBase\n```\n\n`this``ebp-14h``ebp-8`\n{% asset_img TestDeriveCtorBeforeBaseCtorStackMemory.png  %}\n\n= =4`this``ebp-14h`\n\n`TestBase``VirtualFunc1``TestBase``VirtualFunc1``VirtualFunc1`\n\n`mov dword ptr [ebp-4], 0`\n```asm\nmov eax, dword ptr [ebp-14h]\nmov dword ptr [eax], offset HelloWorld2005!TestDerive::`vftable'\n```\n\n`this``00404130`\n{% asset_img TestDeriveAfterAssignVftable.png  %}\n\n`0040413c`\n{% asset_img TestDeriveVtableContent.png  %}\n\n`x`\n{% asset_img TestDeriveVirtualFunctionAddress.png  %}\n\n`VirtualFunc2``x``VirtualFunc1``00401460``VirtualFunc2`\n1. `this`\n2. `this`\n\n\n```asm\nmov eax, dword ptr [ebp-14h]    ;this\nmov ecx, dword ptr [ebp+8]      ;\nmov dword ptr [eax+14h], ecx    ;f\n```\n\n\n\n\n```asm\nmov eax, dword ptr [ebp-14h]                    ;this\ncall HelloWorld2005!TestDerive::VirtualFunc1    ;VirtualFunc1\n```\n\n\n\n`main`\n\n\n```asm\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-14h]\n\nlea ecx, [ebp-8Ch]\ncall dword ptr [ebp-20h]\n\nlea ecx, [ebp-8Ch]\ncall dword ptr [ebp-14h]\n```\n\n`call``this``ecx``x`\n{% asset_img NormalFunc1Addresses.png NormalFunc1 %}\n\n\n\n`TestBase``TestDerive``x``base1``baseVirtualFunc1Pointer``baseVirtualFunc2Pointer`\n```asm\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-2Ch]\n\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-38h]\n```\n\n`call``F11`\n{% asset_img TestBaseVcall0.png  %}\n\n(sha)(bi)\n1. this\n2. (`jmp`)\n\n= =\n\n`TestVirtualFunc2``this`\n\n(cloudy064@gmail.com)\n\n","source":"_posts/windbg/windbg-chapter4.md","raw":"---\ntitle: WinDBG\ndate: 2016-04-26 12:22:37\ncategories: windbg\ntags: [windbg,disassembly,c++]\n---\n\n## \n\n1. \n2. \n3. \n4. \n5. \n6. \n7. \n8. \n9. \n<!--more-->\n## \n\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : e(12)\n        , c(3)\n        , a(12)\n        , b(1)\n        , f('l')\n    {\n        d = 19;\n\n        VirtualFunc1();\n    }\n\n    ~TestBase()\n    {\n        a = 12;\n    }\n\npublic:\n    virtual void VirtualFunc1()\n    {\n        a += 12;\n    }\n\n    virtual void VirtualFunc2()\n    {\n        b += 22;\n    }\n\npublic:\n    void NormalFunc1()\n    {\n        c += 14;\n    }\n\nprotected:\n    int a;\n    int b;\n    char c;\n    char d;\n    short e;\n\nprivate:\n    char f;\n};\n\nclass TestDerive \n    : public TestBase\n{\npublic:\n    TestDerive(int a)\n        : TestBase()\n        , f(a)\n    {\n        VirtualFunc1();\n    }\n\n    ~TestDerive()\n    {\n        b = 12;\n    }\n\npublic:\n    virtual void VirtualFunc1()\n    {\n        a += 99;\n    }\n\npublic:\n    void NormalFunc1()\n    {\n        c += 54;\n    }\n\nprivate:\n    int f;\n};\n\nint main(int argc, char** argv)\n{\n    typedef void (TestBase::*BaseNormalFuncType)();\n    BaseNormalFuncType baseNormalFuncPointer = &TestBase::NormalFunc1;\n\n    typedef void (TestDerive::*DeriveNormalFuncType)();\n    DeriveNormalFuncType deriveNormalFuncPointer = &TestDerive::NormalFunc1;\n\n    typedef void (TestBase::*BaseVirtualFunc1Type)();\n    BaseVirtualFunc1Type baseVirtualFunc1Pointer = &TestBase::VirtualFunc1;\n\n    typedef void (TestBase::*BaseVirtualFunc2Type)();\n    BaseVirtualFunc2Type baseVirtualFunc2Pointer = &TestBase::VirtualFunc2;\n\n    typedef void (TestDerive::*DeriveVirtualFunc1Type)();\n    DeriveVirtualFunc1Type deriveVirtualFunc1Pointer = &TestDerive::VirtualFunc1;\n\n    typedef void (TestDerive::*DeriveVirtualFunc2Type)();\n    DeriveVirtualFunc2Type deriveVirtualFunc2Pointer = &TestDerive::VirtualFunc2;\n\n    TestBase base1;\n    base1.NormalFunc1();\n    base1.VirtualFunc1();\n    base1.VirtualFunc2();\n\n    TestDerive derive1(77);\n    derive1.NormalFunc1();\n    derive1.VirtualFunc1();\n    derive1.VirtualFunc2();\n\n\n    (base1.*baseNormalFuncPointer)();\n    (derive1.*deriveNormalFuncPointer)();\n    (derive1.*baseNormalFuncPointer)();\n    \n    (base1.*baseVirtualFunc1Pointer)();\n    (base1.*baseVirtualFunc2Pointer)();\n    \n    (derive1.*baseVirtualFunc1Pointer)();\n    (derive1.*baseVirtualFunc2Pointer)();\n\n    (derive1.*deriveVirtualFunc1Pointer)();\n    (derive1.*deriveVirtualFunc2Pointer)();\n}\n```\n\nwindbg\n\n`typedef void (TestBase::*BaseNormalFuncType)()`\n{% asset_img AssignMemberFuncPointer.png  %}\n\ngoogle\n\n`this``ecx`\n```asm\nmov dword ptr [ebp-2Ch], offset HelloWorld2005!TestBase::`vcall'{0}'\nmov dword ptr [ebp-38h], offset HelloWorld2005!TestBase::`vcall'{4}'\nmov dword ptr [ebp-44h], offset HelloWorld2005!TestBase::`vcall'{0}'\nmov dword ptr [ebp-50h], offset HelloWorld2005!TestBase::`vcall'{4}'\n```\n\n`TestDerive``TestBase`\n\n\n{% asset_img FirstClassVariable.png TestBase %}\n\n`this``0019febc\n{% asset_img TestBaseConstructor.png TestBase %}\n\n\n1. `this``ebp-8`\n2. `ebp-8``eax`\n3. `this`\n\n`entry``entry``x``TestBase`\n{% asset_img TestBaseVirtualFunctionsAddress.png TestBase %}\n\n`dd eax``this`\n{% asset_img TestBaseLookupThis.png this %}\n\n4`00404130``dd 00404130`\n{% asset_img TestBaseContentOfVirtualTable.png TestBase %}\n\n`hack`\n\n`dt``TestBase`\n{% asset_img dtTestBase.png TestBase %}\n\n\n{% asset_img TestBaseInitSequence.png TestBase %}\n\n\n\n`VirtualFunc1`\n{% asset_img TestBaseVirtualFunc2Function.png VirtualFunc1 %}\n\n`TestDerive``this``0019fe9c`\n{% asset_img TestDeriveConstructor.png TestDerive %}\n\n`dt``TestDerive`\n{% asset_img dtTestDerive.png TestDerive %}\n\n`TestDerive``TestBase``TestDerive``f`\n```asm\nmov dword ptr [ebp-14h], ecx\nmov ecx, dword ptr [ebp-14h]\ncall HelloWorld2005!TestBase::TestBase\n```\n\n`this``ebp-14h``ebp-8`\n{% asset_img TestDeriveCtorBeforeBaseCtorStackMemory.png  %}\n\n= =4`this``ebp-14h`\n\n`TestBase``VirtualFunc1``TestBase``VirtualFunc1``VirtualFunc1`\n\n`mov dword ptr [ebp-4], 0`\n```asm\nmov eax, dword ptr [ebp-14h]\nmov dword ptr [eax], offset HelloWorld2005!TestDerive::`vftable'\n```\n\n`this``00404130`\n{% asset_img TestDeriveAfterAssignVftable.png  %}\n\n`0040413c`\n{% asset_img TestDeriveVtableContent.png  %}\n\n`x`\n{% asset_img TestDeriveVirtualFunctionAddress.png  %}\n\n`VirtualFunc2``x``VirtualFunc1``00401460``VirtualFunc2`\n1. `this`\n2. `this`\n\n\n```asm\nmov eax, dword ptr [ebp-14h]    ;this\nmov ecx, dword ptr [ebp+8]      ;\nmov dword ptr [eax+14h], ecx    ;f\n```\n\n\n\n\n```asm\nmov eax, dword ptr [ebp-14h]                    ;this\ncall HelloWorld2005!TestDerive::VirtualFunc1    ;VirtualFunc1\n```\n\n\n\n`main`\n\n\n```asm\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-14h]\n\nlea ecx, [ebp-8Ch]\ncall dword ptr [ebp-20h]\n\nlea ecx, [ebp-8Ch]\ncall dword ptr [ebp-14h]\n```\n\n`call``this``ecx``x`\n{% asset_img NormalFunc1Addresses.png NormalFunc1 %}\n\n\n\n`TestBase``TestDerive``x``base1``baseVirtualFunc1Pointer``baseVirtualFunc2Pointer`\n```asm\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-2Ch]\n\nlea ecx, [ebp-6Ch]\ncall dword ptr [ebp-38h]\n```\n\n`call``F11`\n{% asset_img TestBaseVcall0.png  %}\n\n(sha)(bi)\n1. this\n2. (`jmp`)\n\n= =\n\n`TestVirtualFunc2``this`\n\n(cloudy064@gmail.com)\n\n","slug":"windbg-windbg-chapter4","published":1,"updated":"2018-06-25T11:14:49.164Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtp8001p2gusswucmssz","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li><a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : e(<span class=\"number\">12</span>)</span><br><span class=\"line\">        , c(<span class=\"number\">3</span>)</span><br><span class=\"line\">        , a(<span class=\"number\">12</span>)</span><br><span class=\"line\">        , b(<span class=\"number\">1</span>)</span><br><span class=\"line\">        , f(<span class=\"string\">'l'</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        d = <span class=\"number\">19</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        VirtualFunc1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~TestBase()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        a = <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        b += <span class=\"number\">22</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        c += <span class=\"number\">14</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> c;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> d;</span><br><span class=\"line\">    <span class=\"keyword\">short</span> e;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> </span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive(<span class=\"keyword\">int</span> a)</span><br><span class=\"line\">        : TestBase()</span><br><span class=\"line\">        , f(a)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VirtualFunc1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~TestDerive()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        b = <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += <span class=\"number\">99</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        c += <span class=\"number\">54</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseNormalFuncType)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseNormalFuncType baseNormalFuncPointer = &amp;TestBase::NormalFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveNormalFuncType)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveNormalFuncType deriveNormalFuncPointer = &amp;TestDerive::NormalFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseVirtualFunc1Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseVirtualFunc1Type baseVirtualFunc1Pointer = &amp;TestBase::VirtualFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseVirtualFunc2Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseVirtualFunc2Type baseVirtualFunc2Pointer = &amp;TestBase::VirtualFunc2;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveVirtualFunc1Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveVirtualFunc1Type deriveVirtualFunc1Pointer = &amp;TestDerive::VirtualFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveVirtualFunc2Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveVirtualFunc2Type deriveVirtualFunc2Pointer = &amp;TestDerive::VirtualFunc2;</span><br><span class=\"line\"></span><br><span class=\"line\">    TestBase base1;</span><br><span class=\"line\">    base1.NormalFunc1();</span><br><span class=\"line\">    base1.VirtualFunc1();</span><br><span class=\"line\">    base1.VirtualFunc2();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">TestDerive <span class=\"title\">derive1</span><span class=\"params\">(<span class=\"number\">77</span>)</span></span>;</span><br><span class=\"line\">    derive1.NormalFunc1();</span><br><span class=\"line\">    derive1.VirtualFunc1();</span><br><span class=\"line\">    derive1.VirtualFunc2();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    (base1.*baseNormalFuncPointer)();</span><br><span class=\"line\">    (derive1.*deriveNormalFuncPointer)();</span><br><span class=\"line\">    (derive1.*baseNormalFuncPointer)();</span><br><span class=\"line\">    </span><br><span class=\"line\">    (base1.*baseVirtualFunc1Pointer)();</span><br><span class=\"line\">    (base1.*baseVirtualFunc2Pointer)();</span><br><span class=\"line\">    </span><br><span class=\"line\">    (derive1.*baseVirtualFunc1Pointer)();</span><br><span class=\"line\">    (derive1.*baseVirtualFunc2Pointer)();</span><br><span class=\"line\"></span><br><span class=\"line\">    (derive1.*deriveVirtualFunc1Pointer)();</span><br><span class=\"line\">    (derive1.*deriveVirtualFunc2Pointer)();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>windbg</p>\n<p><code>typedef void (TestBase::*BaseNormalFuncType)()</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/AssignMemberFuncPointer.png\" title=\"\"></p>\n<p>google</p>\n<p><code>this</code><code>ecx</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-2Ch], offset HelloWorld2005!TestBase::`vcall&apos;&#123;0&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-38h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;4&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-44h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;0&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-50h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;4&#125;&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>TestDerive</code><code>TestBase</code></p>\n<p><br><img src=\"/2016/04/26/windbg-windbg-chapter4/FirstClassVariable.png\" title=\"TestBase\"></p>\n<p><code>this</code>`0019febc<br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseConstructor.png\" title=\"TestBase\"></p>\n<p></p>\n<ol>\n<li><code>this</code><code>ebp-8</code></li>\n<li><code>ebp-8</code><code>eax</code></li>\n<li><code>this</code></li>\n</ol>\n<p><code>entry</code><code>entry</code><code>x</code><code>TestBase</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVirtualFunctionsAddress.png\" title=\"TestBase\"></p>\n<p><code>dd eax</code><code>this</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseLookupThis.png\" title=\"this\"></p>\n<p>4<code>00404130</code><code>dd 00404130</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseContentOfVirtualTable.png\" title=\"TestBase\"></p>\n<p><code>hack</code></p>\n<p><code>dt</code><code>TestBase</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/dtTestBase.png\" title=\"TestBase\"></p>\n<p><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseInitSequence.png\" title=\"TestBase\"></p>\n<p></p>\n<p><code>VirtualFunc1</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVirtualFunc2Function.png\" title=\"VirtualFunc1\"></p>\n<p><code>TestDerive</code><code>this</code><code>0019fe9c</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveConstructor.png\" title=\"TestDerive\"></p>\n<p><code>dt</code><code>TestDerive</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/dtTestDerive.png\" title=\"TestDerive\"></p>\n<p><code>TestDerive</code><code>TestBase</code><code>TestDerive</code><code>f</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-14h], ecx</span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">call HelloWorld2005!TestBase::TestBase</span><br></pre></td></tr></table></figure></p>\n<p><code>this</code><code>ebp-14h</code><code>ebp-8</code><br></p>\n<p>= =4<code>this</code><code>ebp-14h</code></p>\n<p><code>TestBase</code><code>VirtualFunc1</code><code>TestBase</code><code>VirtualFunc1</code><code>VirtualFunc1</code></p>\n<p><code>mov dword ptr [ebp-4], 0</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!TestDerive::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>this</code><code>00404130</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveAfterAssignVftable.png\" title=\"\"></p>\n<p><code>0040413c</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveVtableContent.png\" title=\"\"></p>\n<p><code>x</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveVirtualFunctionAddress.png\" title=\"\"></p>\n<p><code>VirtualFunc2</code><code>x</code><code>VirtualFunc1</code><code>00401460</code><code>VirtualFunc2</code></p>\n<ol>\n<li><code>this</code></li>\n<li><code>this</code></li>\n</ol>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]    ;this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8]      ;</span><br><span class=\"line\">mov dword ptr [eax+14h], ecx    ;f</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]                    ;this</span><br><span class=\"line\">call HelloWorld2005!TestDerive::VirtualFunc1    ;VirtualFunc1</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>main</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-14h]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-8Ch]</span><br><span class=\"line\">call dword ptr [ebp-20h]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-8Ch]</span><br><span class=\"line\">call dword ptr [ebp-14h]</span><br></pre></td></tr></table></figure></p>\n<p><code>call</code><code>this</code><code>ecx</code><code>x</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/NormalFunc1Addresses.png\" title=\"NormalFunc1\"></p>\n<p></p>\n<p><code>TestBase</code><code>TestDerive</code><code>x</code><code>base1</code><code>baseVirtualFunc1Pointer</code><code>baseVirtualFunc2Pointer</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-2Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-38h]</span><br></pre></td></tr></table></figure></p>\n<p><code>call</code><code>F11</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVcall0.png\" title=\"\"></p>\n<p>(sha)(bi)</p>\n<ol>\n<li>this</li>\n<li>(<code>jmp</code>)</li>\n</ol>\n<p>= =</p>\n<p><code>TestVirtualFunc2</code><code>this</code></p>\n<p>(<a href=\"mailto:cloudy064@gmail.com\" target=\"_blank\" rel=\"noopener\">cloudy064@gmail.com</a>)</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : e(<span class=\"number\">12</span>)</span><br><span class=\"line\">        , c(<span class=\"number\">3</span>)</span><br><span class=\"line\">        , a(<span class=\"number\">12</span>)</span><br><span class=\"line\">        , b(<span class=\"number\">1</span>)</span><br><span class=\"line\">        , f(<span class=\"string\">'l'</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        d = <span class=\"number\">19</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        VirtualFunc1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~TestBase()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        a = <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        b += <span class=\"number\">22</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        c += <span class=\"number\">14</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> c;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> d;</span><br><span class=\"line\">    <span class=\"keyword\">short</span> e;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> </span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive(<span class=\"keyword\">int</span> a)</span><br><span class=\"line\">        : TestBase()</span><br><span class=\"line\">        , f(a)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VirtualFunc1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~TestDerive()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        b = <span class=\"number\">12</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        a += <span class=\"number\">99</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        c += <span class=\"number\">54</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseNormalFuncType)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseNormalFuncType baseNormalFuncPointer = &amp;TestBase::NormalFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveNormalFuncType)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveNormalFuncType deriveNormalFuncPointer = &amp;TestDerive::NormalFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseVirtualFunc1Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseVirtualFunc1Type baseVirtualFunc1Pointer = &amp;TestBase::VirtualFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestBase::*BaseVirtualFunc2Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    BaseVirtualFunc2Type baseVirtualFunc2Pointer = &amp;TestBase::VirtualFunc2;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveVirtualFunc1Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveVirtualFunc1Type deriveVirtualFunc1Pointer = &amp;TestDerive::VirtualFunc1;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">void</span> <span class=\"params\">(TestDerive::*DeriveVirtualFunc2Type)</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    DeriveVirtualFunc2Type deriveVirtualFunc2Pointer = &amp;TestDerive::VirtualFunc2;</span><br><span class=\"line\"></span><br><span class=\"line\">    TestBase base1;</span><br><span class=\"line\">    base1.NormalFunc1();</span><br><span class=\"line\">    base1.VirtualFunc1();</span><br><span class=\"line\">    base1.VirtualFunc2();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">TestDerive <span class=\"title\">derive1</span><span class=\"params\">(<span class=\"number\">77</span>)</span></span>;</span><br><span class=\"line\">    derive1.NormalFunc1();</span><br><span class=\"line\">    derive1.VirtualFunc1();</span><br><span class=\"line\">    derive1.VirtualFunc2();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    (base1.*baseNormalFuncPointer)();</span><br><span class=\"line\">    (derive1.*deriveNormalFuncPointer)();</span><br><span class=\"line\">    (derive1.*baseNormalFuncPointer)();</span><br><span class=\"line\">    </span><br><span class=\"line\">    (base1.*baseVirtualFunc1Pointer)();</span><br><span class=\"line\">    (base1.*baseVirtualFunc2Pointer)();</span><br><span class=\"line\">    </span><br><span class=\"line\">    (derive1.*baseVirtualFunc1Pointer)();</span><br><span class=\"line\">    (derive1.*baseVirtualFunc2Pointer)();</span><br><span class=\"line\"></span><br><span class=\"line\">    (derive1.*deriveVirtualFunc1Pointer)();</span><br><span class=\"line\">    (derive1.*deriveVirtualFunc2Pointer)();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>windbg</p>\n<p><code>typedef void (TestBase::*BaseNormalFuncType)()</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/AssignMemberFuncPointer.png\" title=\"\"></p>\n<p>google</p>\n<p><code>this</code><code>ecx</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-2Ch], offset HelloWorld2005!TestBase::`vcall&apos;&#123;0&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-38h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;4&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-44h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;0&#125;&apos;</span><br><span class=\"line\">mov dword ptr [ebp-50h], offset HelloWorld2005!TestBase::`vcall&apos;&#123;4&#125;&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>TestDerive</code><code>TestBase</code></p>\n<p><br><img src=\"/2016/04/26/windbg-windbg-chapter4/FirstClassVariable.png\" title=\"TestBase\"></p>\n<p><code>this</code>`0019febc<br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseConstructor.png\" title=\"TestBase\"></p>\n<p></p>\n<ol>\n<li><code>this</code><code>ebp-8</code></li>\n<li><code>ebp-8</code><code>eax</code></li>\n<li><code>this</code></li>\n</ol>\n<p><code>entry</code><code>entry</code><code>x</code><code>TestBase</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVirtualFunctionsAddress.png\" title=\"TestBase\"></p>\n<p><code>dd eax</code><code>this</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseLookupThis.png\" title=\"this\"></p>\n<p>4<code>00404130</code><code>dd 00404130</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseContentOfVirtualTable.png\" title=\"TestBase\"></p>\n<p><code>hack</code></p>\n<p><code>dt</code><code>TestBase</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/dtTestBase.png\" title=\"TestBase\"></p>\n<p><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseInitSequence.png\" title=\"TestBase\"></p>\n<p></p>\n<p><code>VirtualFunc1</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVirtualFunc2Function.png\" title=\"VirtualFunc1\"></p>\n<p><code>TestDerive</code><code>this</code><code>0019fe9c</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveConstructor.png\" title=\"TestDerive\"></p>\n<p><code>dt</code><code>TestDerive</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/dtTestDerive.png\" title=\"TestDerive\"></p>\n<p><code>TestDerive</code><code>TestBase</code><code>TestDerive</code><code>f</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-14h], ecx</span><br><span class=\"line\">mov ecx, dword ptr [ebp-14h]</span><br><span class=\"line\">call HelloWorld2005!TestBase::TestBase</span><br></pre></td></tr></table></figure></p>\n<p><code>this</code><code>ebp-14h</code><code>ebp-8</code><br></p>\n<p>= =4<code>this</code><code>ebp-14h</code></p>\n<p><code>TestBase</code><code>VirtualFunc1</code><code>TestBase</code><code>VirtualFunc1</code><code>VirtualFunc1</code></p>\n<p><code>mov dword ptr [ebp-4], 0</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!TestDerive::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>this</code><code>00404130</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveAfterAssignVftable.png\" title=\"\"></p>\n<p><code>0040413c</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveVtableContent.png\" title=\"\"></p>\n<p><code>x</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestDeriveVirtualFunctionAddress.png\" title=\"\"></p>\n<p><code>VirtualFunc2</code><code>x</code><code>VirtualFunc1</code><code>00401460</code><code>VirtualFunc2</code></p>\n<ol>\n<li><code>this</code></li>\n<li><code>this</code></li>\n</ol>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]    ;this</span><br><span class=\"line\">mov ecx, dword ptr [ebp+8]      ;</span><br><span class=\"line\">mov dword ptr [eax+14h], ecx    ;f</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-14h]                    ;this</span><br><span class=\"line\">call HelloWorld2005!TestDerive::VirtualFunc1    ;VirtualFunc1</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p><code>main</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-14h]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-8Ch]</span><br><span class=\"line\">call dword ptr [ebp-20h]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-8Ch]</span><br><span class=\"line\">call dword ptr [ebp-14h]</span><br></pre></td></tr></table></figure></p>\n<p><code>call</code><code>this</code><code>ecx</code><code>x</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/NormalFunc1Addresses.png\" title=\"NormalFunc1\"></p>\n<p></p>\n<p><code>TestBase</code><code>TestDerive</code><code>x</code><code>base1</code><code>baseVirtualFunc1Pointer</code><code>baseVirtualFunc2Pointer</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-2Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">lea ecx, [ebp-6Ch]</span><br><span class=\"line\">call dword ptr [ebp-38h]</span><br></pre></td></tr></table></figure></p>\n<p><code>call</code><code>F11</code><br><img src=\"/2016/04/26/windbg-windbg-chapter4/TestBaseVcall0.png\" title=\"\"></p>\n<p>(sha)(bi)</p>\n<ol>\n<li>this</li>\n<li>(<code>jmp</code>)</li>\n</ol>\n<p>= =</p>\n<p><code>TestVirtualFunc2</code><code>this</code></p>\n<p>(<a href=\"mailto:cloudy064@gmail.com\" target=\"_blank\" rel=\"noopener\">cloudy064@gmail.com</a>)</p>"},{"title":"WinDBG","date":"2016-06-15T15:34:06.000Z","_content":"\n## \n`C++99``C++11``hexo`\n<!--more-->\n## \n\n```cpp\nclass Super\n{\npublic:\n    ~Super()\n    {\n\n    }\n\npublic:\n    int NormalFunc1()\n    {\n        return a;\n    }\n\n    virtual int VirtualFunc1()\n    {\n        return a + c;\n    }\n\nprotected:\n    int a;\n    int c;\n};\n\nclass Derive\n    : virtual public Super\n{\npublic:\n    Derive()\n        : a(10)\n        , b(12)\n    {\n        Super::a = 19;\n    }\n\n    ~Derive()\n    {\n\n    }\n\npublic:\n    virtual int VirtualFunc1() override\n    {\n        return Super::a + a + c + b;\n    }\n\nprivate:\n    int a;\n    int b;\n};\n\nint main(int argc, char** argv)\n{\n    Derive d;\n    d.VirtualFunc1();\n    d.NormalFunc1();\n}\n\n```\n\n\n1. `Derive``Super`\n2. `Derive`\n3. `Derive``this`\n\n`windbg``exe``Visual Studio`c++\n{% asset_img vsoptions.png VS1 %}\n{% asset_img linkoptions.png VS2 %}\n\n\n{% asset_img firststep.png  %}\n\n`push 1`\n\n\n```asm\nlea ecx, [ebp-1Ch]\ncall HelloWorld2005!Derive::Derive\n```\n\n`d``this`\n{% asset_img beforedconstructorstack.png  %}\n\n`d``VS``d``this``ebp-1Ch``F11``this``dword ptr [ebp-4]`\n{% asset_img inderiveconstructor.png Derive %}\n\n\n{% asset_img inderiveconstructorstack.png  %}\n\n\n```asm\nmov dword ptr [ebp-48h], 0\ncmp dword ptr [ebp+8], 0\nje HelloWorld2005!Derive::Derive+0x31\nmov eax, dword ptr [ebp-4]\nmov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable'\nmov ecx, dword ptr [ebp-4]\nadd ecx, 10h\ncall HelloWorld2005!Super::Super\n```\n\nTM`ebp+8``1`0`0``Derive::Derive+0x31``u HelloWorld2005+Derive::Derive+0x31`\n{% asset_img jumpoversupercall.png  %}\n\n\n```asm\nmov eax, dword ptr [ebp-4]\nmov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable'\n```\n\n`ebp-4``this``this``vbtable``this``vftable``vbtable``virtual base table``vftable``vbtable`\n\n\n```asm\nmov ecx, dword ptr [ebp-4]\nadd ecx, 10h\ncall HelloWorld2005!Super::Super\n```\n\n`ecx``this``this+10h``this``ecx`\n{% asset_img contentofecx.png this %}\n\n`Super`\n{% asset_img superconstructor.png Super %}\n\n`this``Base``d`\n{% asset_img contentofobjectd.png d %}\n\n\n\n:\n```asm\nor dword ptr [ebp-48h], 1\n```\n\n`ebp-48h`\n\n\n```asm\nmov eax, dword ptr [ebp-4]\nmov ecx, dword ptr [eax]\nmov edx, dword ptr [ecx+4]\nmov eax, dowrd ptr [ebp-4]\nmov dword ptr [eax+edx], offset HelloWorld2005!Derive::`vftable'\n```\n\nT_T\n\n`eax``this``this``ecx`edx`vftable``eax+edx`\n\n\n{% asset_img vbtablecontent.png  %}\n\n`10h``this``10h`\n\n`Derive::vftable`\n\n`this`\n\n\n```asm\nmov eax, dword ptr [ebp-4]        ;this\nmov ecx, dword ptr [eax]          ;vbtable\nmov edx, dword ptr [ecx+4]        ;10hSuper\nsub edx, 10h                      ;0\nmov eax dword ptr [ebp-4]         ;this\nmov ecx, dword ptr [eax]          ;vbtable\nmov eax, dword ptr [ecx+4]        ;10h\nmov ecx, dword ptr [ebp-4]        ;this\nmov dword ptr [ecx+eax-4], edx    ;vftable\n\nmov eax, dword ptr [ebp-4]        ;this\nmov dword ptr [eax+4], 0Ah        ;a:10\n\nmov eax, dword ptr [ebp-4]        ;this\nmov dword ptr [eax+8], 0Ch        ;b:12\n\nmov eax, dowrd ptr [ebp-4]        ;this\nmov ecx, dword ptr [eax]          ;vtable\nmov edx, dword ptr [ecx+4]        ;10h\nmov dword ptr [eax+edx+4], 13h    ;Super4\n```\n\n\n```asm\nlea ecx, [ebp-0Ch]\ncall HelloWorld2005!Derive::VirtualFunc1\n```\n\n`+10h``ebp-0Ch``Derive``Super``this``Derive::VirtualFunc1`\n\n`F11`\n{% asset_img VirtualFunc1Code.png VirtualFunc1 %}\n\n`this``Super::a + a + c + b;`\n```asm\nmov dword ptr [ebp-4], ecx          ; this\nmov eax, dword ptr [ebp-4]          ; thiseax\nmov ecx, dword ptr [eax-10h]        ; eax-10Derivethis\nmov edx, dword ptr [ecx+4]          ; Super10h\nmov eax, dword ptr [eax+edx-0Ch]    ; edx=10hmov eax, dword ptr [eax+4]Superaeax\n\nmov ecx, dword ptr [ebp-4]          ; thisecx\nadd eax, dword ptr [ecx-0Ch]        ; this-0ChDerivea\n\nmov edx, dword ptr [ebp-4]          ; thisedx\nmov ecx, dword ptr [edx-10h]        ; \nmov edx, dword ptr [ecx+4]          ; Super10h\nmov ecx, dword ptr [ebp-4]          ; this\nadd eax, dword ptr [ecx+edx-8]      ; add eax, dword ptr [ecx+8]Superc\n\nmov edx, dword ptr [ebp-4]          ; this\nadd eax, dword ptr [edx-8]          ; Deriveb\n```\n\nDerive\n\n`NormalFunc1`\n```asm\nmov eax, dword ptr [ebp-1Ch]\nmov ecx, dword ptr [eax+4]\nlea ecx, [ebp+ecx-1Ch]\ncall HelloWorld2005!Super::NormalFunc1\n```\n\n`d``ebp-1Ch``ecx``d``this``this`,`lea eax, [ebp-1Ch]``this``Super`\n\n`mov ecx, dword ptr [eax+4]``eax+4``Super``ecx``10h`\n\n`lea ecx, [ebp+ecx-1Ch]``ebp-1Ch``d``this``ecx``d``Super`\n\n\n\n\n\n## \n\n\n","source":"_posts/windbg/windbg-chapter5.md","raw":"---\ntitle: WinDBG\ndate: 2016-06-15 23:34:06\ncategories: windbg\ntags: [windbg,disassembly,c++]\n---\n\n## \n`C++99``C++11``hexo`\n<!--more-->\n## \n\n```cpp\nclass Super\n{\npublic:\n    ~Super()\n    {\n\n    }\n\npublic:\n    int NormalFunc1()\n    {\n        return a;\n    }\n\n    virtual int VirtualFunc1()\n    {\n        return a + c;\n    }\n\nprotected:\n    int a;\n    int c;\n};\n\nclass Derive\n    : virtual public Super\n{\npublic:\n    Derive()\n        : a(10)\n        , b(12)\n    {\n        Super::a = 19;\n    }\n\n    ~Derive()\n    {\n\n    }\n\npublic:\n    virtual int VirtualFunc1() override\n    {\n        return Super::a + a + c + b;\n    }\n\nprivate:\n    int a;\n    int b;\n};\n\nint main(int argc, char** argv)\n{\n    Derive d;\n    d.VirtualFunc1();\n    d.NormalFunc1();\n}\n\n```\n\n\n1. `Derive``Super`\n2. `Derive`\n3. `Derive``this`\n\n`windbg``exe``Visual Studio`c++\n{% asset_img vsoptions.png VS1 %}\n{% asset_img linkoptions.png VS2 %}\n\n\n{% asset_img firststep.png  %}\n\n`push 1`\n\n\n```asm\nlea ecx, [ebp-1Ch]\ncall HelloWorld2005!Derive::Derive\n```\n\n`d``this`\n{% asset_img beforedconstructorstack.png  %}\n\n`d``VS``d``this``ebp-1Ch``F11``this``dword ptr [ebp-4]`\n{% asset_img inderiveconstructor.png Derive %}\n\n\n{% asset_img inderiveconstructorstack.png  %}\n\n\n```asm\nmov dword ptr [ebp-48h], 0\ncmp dword ptr [ebp+8], 0\nje HelloWorld2005!Derive::Derive+0x31\nmov eax, dword ptr [ebp-4]\nmov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable'\nmov ecx, dword ptr [ebp-4]\nadd ecx, 10h\ncall HelloWorld2005!Super::Super\n```\n\nTM`ebp+8``1`0`0``Derive::Derive+0x31``u HelloWorld2005+Derive::Derive+0x31`\n{% asset_img jumpoversupercall.png  %}\n\n\n```asm\nmov eax, dword ptr [ebp-4]\nmov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable'\n```\n\n`ebp-4``this``this``vbtable``this``vftable``vbtable``virtual base table``vftable``vbtable`\n\n\n```asm\nmov ecx, dword ptr [ebp-4]\nadd ecx, 10h\ncall HelloWorld2005!Super::Super\n```\n\n`ecx``this``this+10h``this``ecx`\n{% asset_img contentofecx.png this %}\n\n`Super`\n{% asset_img superconstructor.png Super %}\n\n`this``Base``d`\n{% asset_img contentofobjectd.png d %}\n\n\n\n:\n```asm\nor dword ptr [ebp-48h], 1\n```\n\n`ebp-48h`\n\n\n```asm\nmov eax, dword ptr [ebp-4]\nmov ecx, dword ptr [eax]\nmov edx, dword ptr [ecx+4]\nmov eax, dowrd ptr [ebp-4]\nmov dword ptr [eax+edx], offset HelloWorld2005!Derive::`vftable'\n```\n\nT_T\n\n`eax``this``this``ecx`edx`vftable``eax+edx`\n\n\n{% asset_img vbtablecontent.png  %}\n\n`10h``this``10h`\n\n`Derive::vftable`\n\n`this`\n\n\n```asm\nmov eax, dword ptr [ebp-4]        ;this\nmov ecx, dword ptr [eax]          ;vbtable\nmov edx, dword ptr [ecx+4]        ;10hSuper\nsub edx, 10h                      ;0\nmov eax dword ptr [ebp-4]         ;this\nmov ecx, dword ptr [eax]          ;vbtable\nmov eax, dword ptr [ecx+4]        ;10h\nmov ecx, dword ptr [ebp-4]        ;this\nmov dword ptr [ecx+eax-4], edx    ;vftable\n\nmov eax, dword ptr [ebp-4]        ;this\nmov dword ptr [eax+4], 0Ah        ;a:10\n\nmov eax, dword ptr [ebp-4]        ;this\nmov dword ptr [eax+8], 0Ch        ;b:12\n\nmov eax, dowrd ptr [ebp-4]        ;this\nmov ecx, dword ptr [eax]          ;vtable\nmov edx, dword ptr [ecx+4]        ;10h\nmov dword ptr [eax+edx+4], 13h    ;Super4\n```\n\n\n```asm\nlea ecx, [ebp-0Ch]\ncall HelloWorld2005!Derive::VirtualFunc1\n```\n\n`+10h``ebp-0Ch``Derive``Super``this``Derive::VirtualFunc1`\n\n`F11`\n{% asset_img VirtualFunc1Code.png VirtualFunc1 %}\n\n`this``Super::a + a + c + b;`\n```asm\nmov dword ptr [ebp-4], ecx          ; this\nmov eax, dword ptr [ebp-4]          ; thiseax\nmov ecx, dword ptr [eax-10h]        ; eax-10Derivethis\nmov edx, dword ptr [ecx+4]          ; Super10h\nmov eax, dword ptr [eax+edx-0Ch]    ; edx=10hmov eax, dword ptr [eax+4]Superaeax\n\nmov ecx, dword ptr [ebp-4]          ; thisecx\nadd eax, dword ptr [ecx-0Ch]        ; this-0ChDerivea\n\nmov edx, dword ptr [ebp-4]          ; thisedx\nmov ecx, dword ptr [edx-10h]        ; \nmov edx, dword ptr [ecx+4]          ; Super10h\nmov ecx, dword ptr [ebp-4]          ; this\nadd eax, dword ptr [ecx+edx-8]      ; add eax, dword ptr [ecx+8]Superc\n\nmov edx, dword ptr [ebp-4]          ; this\nadd eax, dword ptr [edx-8]          ; Deriveb\n```\n\nDerive\n\n`NormalFunc1`\n```asm\nmov eax, dword ptr [ebp-1Ch]\nmov ecx, dword ptr [eax+4]\nlea ecx, [ebp+ecx-1Ch]\ncall HelloWorld2005!Super::NormalFunc1\n```\n\n`d``ebp-1Ch``ecx``d``this``this`,`lea eax, [ebp-1Ch]``this``Super`\n\n`mov ecx, dword ptr [eax+4]``eax+4``Super``ecx``10h`\n\n`lea ecx, [ebp+ecx-1Ch]``ebp-1Ch``d``this``ecx``d``Super`\n\n\n\n\n\n## \n\n\n","slug":"windbg-windbg-chapter5","published":1,"updated":"2018-06-25T11:14:49.164Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtpa001q2gusrrjdberd","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>C++99</code><code>C++11</code><code>hexo</code><br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Super</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ~Super()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a + c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Derive</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">public</span> Super</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    Derive()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">        , b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Super::a = <span class=\"number\">19</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~Derive()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Super::a + a + c + b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Derive d;</span><br><span class=\"line\">    d.VirtualFunc1();</span><br><span class=\"line\">    d.NormalFunc1();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li><code>Derive</code><code>Super</code></li>\n<li><code>Derive</code></li>\n<li><code>Derive</code><code>this</code></li>\n</ol>\n<p><code>windbg</code><code>exe</code><code>Visual Studio</code>c++<br><img src=\"/2016/06/15/windbg-windbg-chapter5/vsoptions.png\" title=\"VS1\"><br><img src=\"/2016/06/15/windbg-windbg-chapter5/linkoptions.png\" title=\"VS2\"></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/firststep.png\" title=\"\"></p>\n<p><code>push 1</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-1Ch]</span><br><span class=\"line\">call HelloWorld2005!Derive::Derive</span><br></pre></td></tr></table></figure></p>\n<p><code>d</code><code>this</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/beforedconstructorstack.png\" title=\"\"></p>\n<p><code>d</code><code>VS</code><code>d</code><code>this</code><code>ebp-1Ch</code><code>F11</code><code>this</code><code>dword ptr [ebp-4]</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/inderiveconstructor.png\" title=\"Derive\"></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/inderiveconstructorstack.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-48h], 0</span><br><span class=\"line\">cmp dword ptr [ebp+8], 0</span><br><span class=\"line\">je HelloWorld2005!Derive::Derive+0x31</span><br><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable&apos;</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]</span><br><span class=\"line\">add ecx, 10h</span><br><span class=\"line\">call HelloWorld2005!Super::Super</span><br></pre></td></tr></table></figure></p>\n<p>TM<code>ebp+8</code><code>1</code>0<code>0</code><code>Derive::Derive+0x31</code><code>u HelloWorld2005+Derive::Derive+0x31</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/jumpoversupercall.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-4</code><code>this</code><code>this</code><code>vbtable</code><code>this</code><code>vftable</code><code>vbtable</code><code>virtual base table</code><code>vftable</code><code>vbtable</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp-4]</span><br><span class=\"line\">add ecx, 10h</span><br><span class=\"line\">call HelloWorld2005!Super::Super</span><br></pre></td></tr></table></figure></p>\n<p><code>ecx</code><code>this</code><code>this+10h</code><code>this</code><code>ecx</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/contentofecx.png\" title=\"this\"></p>\n<p><code>Super</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/superconstructor.png\" title=\"Super\"></p>\n<p><code>this</code><code>Base</code><code>d</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/contentofobjectd.png\" title=\"d\"></p>\n<p></p>\n<p>:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">or dword ptr [ebp-48h], 1</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-48h</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov ecx, dword ptr [eax]</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]</span><br><span class=\"line\">mov eax, dowrd ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax+edx], offset HelloWorld2005!Derive::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p>T_T</p>\n<p><code>eax</code><code>this</code><code>this</code><code>ecx</code>edx<code>vftable</code><code>eax+edx</code></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/vbtablecontent.png\" title=\"\"></p>\n<p><code>10h</code><code>this</code><code>10h</code></p>\n<p><code>Derive::vftable</code></p>\n<p><code>this</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vbtable</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]        ;10hSuper</span><br><span class=\"line\">sub edx, 10h                      ;0</span><br><span class=\"line\">mov eax dword ptr [ebp-4]         ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vbtable</span><br><span class=\"line\">mov eax, dword ptr [ecx+4]        ;10h</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [ecx+eax-4], edx    ;vftable</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [eax+4], 0Ah        ;a:10</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [eax+8], 0Ch        ;b:12</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dowrd ptr [ebp-4]        ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vtable</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]        ;10h</span><br><span class=\"line\">mov dword ptr [eax+edx+4], 13h    ;Super4</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-0Ch]</span><br><span class=\"line\">call HelloWorld2005!Derive::VirtualFunc1</span><br></pre></td></tr></table></figure></p>\n<p><code>+10h</code><code>ebp-0Ch</code><code>Derive</code><code>Super</code><code>this</code><code>Derive::VirtualFunc1</code></p>\n<p><code>F11</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/VirtualFunc1Code.png\" title=\"VirtualFunc1\"></p>\n<p><code>this</code><code>Super::a + a + c + b;</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-4], ecx          ; this</span><br><span class=\"line\">mov eax, dword ptr [ebp-4]          ; thiseax</span><br><span class=\"line\">mov ecx, dword ptr [eax-10h]        ; eax-10Derivethis</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]          ; Super10h</span><br><span class=\"line\">mov eax, dword ptr [eax+edx-0Ch]    ; edx=10hmov eax, dword ptr [eax+4]Superaeax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]          ; thisecx</span><br><span class=\"line\">add eax, dword ptr [ecx-0Ch]        ; this-0ChDerivea</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-4]          ; thisedx</span><br><span class=\"line\">mov ecx, dword ptr [edx-10h]        ; </span><br><span class=\"line\">mov edx, dword ptr [ecx+4]          ; Super10h</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]          ; this</span><br><span class=\"line\">add eax, dword ptr [ecx+edx-8]      ; add eax, dword ptr [ecx+8]Superc</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-4]          ; this</span><br><span class=\"line\">add eax, dword ptr [edx-8]          ; Deriveb</span><br></pre></td></tr></table></figure></p>\n<p>Derive</p>\n<p><code>NormalFunc1</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-1Ch]</span><br><span class=\"line\">mov ecx, dword ptr [eax+4]</span><br><span class=\"line\">lea ecx, [ebp+ecx-1Ch]</span><br><span class=\"line\">call HelloWorld2005!Super::NormalFunc1</span><br></pre></td></tr></table></figure></p>\n<p><code>d</code><code>ebp-1Ch</code><code>ecx</code><code>d</code><code>this</code><code>this</code>,<code>lea eax, [ebp-1Ch]</code><code>this</code><code>Super</code></p>\n<p><code>mov ecx, dword ptr [eax+4]</code><code>eax+4</code><code>Super</code><code>ecx</code><code>10h</code></p>\n<p><code>lea ecx, [ebp+ecx-1Ch]</code><code>ebp-1Ch</code><code>d</code><code>this</code><code>ecx</code><code>d</code><code>Super</code></p>\n<p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>C++99</code><code>C++11</code><code>hexo</code><br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Super</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ~Super()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">NormalFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a + c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Derive</span></span></span><br><span class=\"line\"><span class=\"class\">    :</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">public</span> Super</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    Derive()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">        , b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Super::a = <span class=\"number\">19</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ~Derive()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">VirtualFunc1</span><span class=\"params\">()</span> override</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Super::a + a + c + b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Derive d;</span><br><span class=\"line\">    d.VirtualFunc1();</span><br><span class=\"line\">    d.NormalFunc1();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<ol>\n<li><code>Derive</code><code>Super</code></li>\n<li><code>Derive</code></li>\n<li><code>Derive</code><code>this</code></li>\n</ol>\n<p><code>windbg</code><code>exe</code><code>Visual Studio</code>c++<br><img src=\"/2016/06/15/windbg-windbg-chapter5/vsoptions.png\" title=\"VS1\"><br><img src=\"/2016/06/15/windbg-windbg-chapter5/linkoptions.png\" title=\"VS2\"></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/firststep.png\" title=\"\"></p>\n<p><code>push 1</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-1Ch]</span><br><span class=\"line\">call HelloWorld2005!Derive::Derive</span><br></pre></td></tr></table></figure></p>\n<p><code>d</code><code>this</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/beforedconstructorstack.png\" title=\"\"></p>\n<p><code>d</code><code>VS</code><code>d</code><code>this</code><code>ebp-1Ch</code><code>F11</code><code>this</code><code>dword ptr [ebp-4]</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/inderiveconstructor.png\" title=\"Derive\"></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/inderiveconstructorstack.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-48h], 0</span><br><span class=\"line\">cmp dword ptr [ebp+8], 0</span><br><span class=\"line\">je HelloWorld2005!Derive::Derive+0x31</span><br><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable&apos;</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]</span><br><span class=\"line\">add ecx, 10h</span><br><span class=\"line\">call HelloWorld2005!Super::Super</span><br></pre></td></tr></table></figure></p>\n<p>TM<code>ebp+8</code><code>1</code>0<code>0</code><code>Derive::Derive+0x31</code><code>u HelloWorld2005+Derive::Derive+0x31</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/jumpoversupercall.png\" title=\"\"></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax], offset HelloWorld2005!Derive::`vbtable&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-4</code><code>this</code><code>this</code><code>vbtable</code><code>this</code><code>vftable</code><code>vbtable</code><code>virtual base table</code><code>vftable</code><code>vbtable</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov ecx, dword ptr [ebp-4]</span><br><span class=\"line\">add ecx, 10h</span><br><span class=\"line\">call HelloWorld2005!Super::Super</span><br></pre></td></tr></table></figure></p>\n<p><code>ecx</code><code>this</code><code>this+10h</code><code>this</code><code>ecx</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/contentofecx.png\" title=\"this\"></p>\n<p><code>Super</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/superconstructor.png\" title=\"Super\"></p>\n<p><code>this</code><code>Base</code><code>d</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/contentofobjectd.png\" title=\"d\"></p>\n<p></p>\n<p>:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">or dword ptr [ebp-48h], 1</span><br></pre></td></tr></table></figure></p>\n<p><code>ebp-48h</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]</span><br><span class=\"line\">mov ecx, dword ptr [eax]</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]</span><br><span class=\"line\">mov eax, dowrd ptr [ebp-4]</span><br><span class=\"line\">mov dword ptr [eax+edx], offset HelloWorld2005!Derive::`vftable&apos;</span><br></pre></td></tr></table></figure></p>\n<p>T_T</p>\n<p><code>eax</code><code>this</code><code>this</code><code>ecx</code>edx<code>vftable</code><code>eax+edx</code></p>\n<p><br><img src=\"/2016/06/15/windbg-windbg-chapter5/vbtablecontent.png\" title=\"\"></p>\n<p><code>10h</code><code>this</code><code>10h</code></p>\n<p><code>Derive::vftable</code></p>\n<p><code>this</code></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vbtable</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]        ;10hSuper</span><br><span class=\"line\">sub edx, 10h                      ;0</span><br><span class=\"line\">mov eax dword ptr [ebp-4]         ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vbtable</span><br><span class=\"line\">mov eax, dword ptr [ecx+4]        ;10h</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [ecx+eax-4], edx    ;vftable</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [eax+4], 0Ah        ;a:10</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dword ptr [ebp-4]        ;this</span><br><span class=\"line\">mov dword ptr [eax+8], 0Ch        ;b:12</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax, dowrd ptr [ebp-4]        ;this</span><br><span class=\"line\">mov ecx, dword ptr [eax]          ;vtable</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]        ;10h</span><br><span class=\"line\">mov dword ptr [eax+edx+4], 13h    ;Super4</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea ecx, [ebp-0Ch]</span><br><span class=\"line\">call HelloWorld2005!Derive::VirtualFunc1</span><br></pre></td></tr></table></figure></p>\n<p><code>+10h</code><code>ebp-0Ch</code><code>Derive</code><code>Super</code><code>this</code><code>Derive::VirtualFunc1</code></p>\n<p><code>F11</code><br><img src=\"/2016/06/15/windbg-windbg-chapter5/VirtualFunc1Code.png\" title=\"VirtualFunc1\"></p>\n<p><code>this</code><code>Super::a + a + c + b;</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov dword ptr [ebp-4], ecx          ; this</span><br><span class=\"line\">mov eax, dword ptr [ebp-4]          ; thiseax</span><br><span class=\"line\">mov ecx, dword ptr [eax-10h]        ; eax-10Derivethis</span><br><span class=\"line\">mov edx, dword ptr [ecx+4]          ; Super10h</span><br><span class=\"line\">mov eax, dword ptr [eax+edx-0Ch]    ; edx=10hmov eax, dword ptr [eax+4]Superaeax</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]          ; thisecx</span><br><span class=\"line\">add eax, dword ptr [ecx-0Ch]        ; this-0ChDerivea</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-4]          ; thisedx</span><br><span class=\"line\">mov ecx, dword ptr [edx-10h]        ; </span><br><span class=\"line\">mov edx, dword ptr [ecx+4]          ; Super10h</span><br><span class=\"line\">mov ecx, dword ptr [ebp-4]          ; this</span><br><span class=\"line\">add eax, dword ptr [ecx+edx-8]      ; add eax, dword ptr [ecx+8]Superc</span><br><span class=\"line\"></span><br><span class=\"line\">mov edx, dword ptr [ebp-4]          ; this</span><br><span class=\"line\">add eax, dword ptr [edx-8]          ; Deriveb</span><br></pre></td></tr></table></figure></p>\n<p>Derive</p>\n<p><code>NormalFunc1</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov eax, dword ptr [ebp-1Ch]</span><br><span class=\"line\">mov ecx, dword ptr [eax+4]</span><br><span class=\"line\">lea ecx, [ebp+ecx-1Ch]</span><br><span class=\"line\">call HelloWorld2005!Super::NormalFunc1</span><br></pre></td></tr></table></figure></p>\n<p><code>d</code><code>ebp-1Ch</code><code>ecx</code><code>d</code><code>this</code><code>this</code>,<code>lea eax, [ebp-1Ch]</code><code>this</code><code>Super</code></p>\n<p><code>mov ecx, dword ptr [eax+4]</code><code>eax+4</code><code>Super</code><code>ecx</code><code>10h</code></p>\n<p><code>lea ecx, [ebp+ecx-1Ch]</code><code>ebp-1Ch</code><code>d</code><code>this</code><code>ecx</code><code>d</code><code>Super</code></p>\n<p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>"},{"title":"WinDBG[]C","date":"2016-05-02T15:08:05.000Z","_content":"\n## \nCCCCC++\n<!--more-->\n## \n\n1. \n2. \n3. \n\n\n\nC++\n```cpp\nclass TestBase\n{\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\nprivate:\n    int b;\n};\n```\n\nC`class``struct``public`C\n```C\ntypedef struct tagTestBase\n{\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n```\n\nC++\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : a(10)\n    {\n\n    }\n\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\npublic:\n    TestDerive()\n        : b(12)\n    {\n\n    }\n\nprivate:\n    int b;\n};\n```\n\nCcppcCC`this`\n1. `ecx`\n2. `call`\n3. `ecx``ebp-8``ebp-14h`\n4. `ebp-8``eax`\n\n`this`\n\n1. \n2. \n3. \n\n\n```c\ntypedef struct tagTestBase\n{\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(pThis->base);\n    pThis->b = 12;\n}\n```\n\n\n\nC++\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : a(10)\n    {\n\n    }\n\npublic:\n    virtual int add(int k)\n    {\n        return a + k;\n    }\n\n    virtual int sub(int k)\n    {\n        return a - k;\n    }\n\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\npublic:\n    TestDerive()\n        : b(12)\n    {\n\n    }\n\npublic:\n    virtual int add(int k)\n    {\n        return b + k;\n    }\n\n    virtual int sub(int k)\n    {\n        return b - k;\n    }\n\nprivate:\n    int b;\n};\n```\n\nC\n{% asset_img vftables.png  %}\n\n`TestDerive``TestBase``this``vftable``vftable``DWORD``TestDerive``add``DWORD``TestDerive``sub`\n\nCT\n```c\n#include <stdio.h>\n#include <stdlib.h>\n\ntypedef struct tagTestBase\n{\n    void** pVftable;\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nvoid** g_pBaseVftable = 0; // base\nvoid** g_pDeriveVftable = 0; // derive\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->pVftable = g_pBaseVftable; //\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(&pThis->base);\n    pThis->base.pVftable = g_pDeriveVftable; //\n    pThis->b = 12;\n}\n\n// \nint CallVirtualAdd_int(TestBase* pThis, int m)\n{\n    typedef int (*FuncType)(TestBase*, int);\n    FuncType func = (FuncType)pThis->pVftable[0];\n    return func(pThis, m);\n}\n\n// \nint CallVirtualSub_int(TestBase* pThis, int m)\n{\n    typedef int (*FuncType)(TestBase*, int);\n    FuncType func = (FuncType)pThis->pVftable[1];\n    return func(pThis, m);\n}\n\nint TestBaseVirtualAdd_int(TestBase* pThis, int m)\n{\n    return pThis->a + m;\n}\n\nint TestBaseVirtualSub_int(TestBase* pThis, int m)\n{\n    return pThis->a - m;\n}\n\nint TestDeriveVirtualAdd_int(TestDerive* pThis, int m)\n{\n    return pThis->b + m;\n}\n\nint TestDeriveVirtualSub_int(TestDerive* pThis, int m)\n{\n    return pThis->b - m;\n}\n\nvoid InitVftables()\n{\n    // Base\n    g_pBaseVftable = (void**)malloc(sizeof(void*) * 2);\n    g_pBaseVftable[0] = (void*)&TestBaseVirtualAdd_int;\n    g_pBaseVftable[1] = (void*)&TestBaseVirtualSub_int;\n\n    // Derive\n    g_pDeriveVftable = (void**)malloc(sizeof(void*) * 2);\n    g_pDeriveVftable[0] = (void*)TestDeriveVirtualAdd_int;\n    g_pDeriveVftable[1] = (void*)TestDeriveVirtualSub_int;\n}\n\nvoid UninitVftables()\n{\n    free(g_pBaseVftable);\n    free(g_pDeriveVftable);\n}\n\nint main_core(int argc, char** argv)\n{\n    TestDerive d;\n    TestDeriveConstructor(&d);\n    CallVirtualAdd_int((TestBase*)&d, 19);\n\n    return 0;\n}\n\nint main(int argc, char** argv)\n{\n    InitVftables();\n\n    // C\n    // \n    main_core(argc, argv);\n\n    UninitVftables();\n\n    return 0;\n}\n```\n\nC\n\nCncallC\n```c\nstruct tagTestBase;\n\ntypedef int (*AddFuncType)(struct tagTestBase* pThis, int);\ntypedef int (*SubFuncType)(struct tagTestBase* pThis, int);\n\ntypedef struct tagTestBase\n{\n    AddFuncType addFunc;\n    SubFuncType subFunc;\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nint TestBaseVirtualAdd_int(TestBase* pThis, int m)\n{\n    return pThis->a + m;\n}\n\nint TestBaseVirtualSub_int(TestBase* pThis, int m)\n{\n    return pThis->a - m;\n}\n\nint TestDeriveVirtualAdd_int(TestDerive* pThis, int m)\n{\n    return pThis->b + m;\n}\n\nint TestDeriveVirtualSub_int(TestDerive* pThis, int m)\n{\n    return pThis->b - m;\n}\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->addFunc = &TestBaseVirtualAdd_int;\n    pThis->subFunc = &TestBaseVirtualSub_int;\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(&pThis->base);\n    pThis->base.addFunc = (AddFuncType)&TestDeriveVirtualAdd_int;\n    pThis->base.subFunc = (SubFuncType)&TestDeriveVirtualSub_int;\n    pThis->b = 12;\n}\n\n\nint main_core(int argc, char** argv)\n{\n    TestDerive d;\n    TestDeriveConstructor(&d);\n    d.base.addFunc((TestBase*)&d, 19);\n\n    return 0;\n}\n\nint main(int argc, char** argv)\n{\n    main_core(argc, argv);\n\n    return 0;\n}\n```\n\n\n","source":"_posts/windbg/windbg-extra1.md","raw":"---\ntitle: WinDBG[]C\ndate: 2016-05-02 23:08:05\ncategories: windbg\ntags: [windbg,disassembly,c++,c]\n---\n\n## \nCCCCC++\n<!--more-->\n## \n\n1. \n2. \n3. \n\n\n\nC++\n```cpp\nclass TestBase\n{\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\nprivate:\n    int b;\n};\n```\n\nC`class``struct``public`C\n```C\ntypedef struct tagTestBase\n{\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n```\n\nC++\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : a(10)\n    {\n\n    }\n\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\npublic:\n    TestDerive()\n        : b(12)\n    {\n\n    }\n\nprivate:\n    int b;\n};\n```\n\nCcppcCC`this`\n1. `ecx`\n2. `call`\n3. `ecx``ebp-8``ebp-14h`\n4. `ebp-8``eax`\n\n`this`\n\n1. \n2. \n3. \n\n\n```c\ntypedef struct tagTestBase\n{\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(pThis->base);\n    pThis->b = 12;\n}\n```\n\n\n\nC++\n```cpp\nclass TestBase\n{\npublic:\n    TestBase()\n        : a(10)\n    {\n\n    }\n\npublic:\n    virtual int add(int k)\n    {\n        return a + k;\n    }\n\n    virtual int sub(int k)\n    {\n        return a - k;\n    }\n\nprivate:\n    int a;\n};\n\nclass TestDerive : public TestBase\n{\npublic:\n    TestDerive()\n        : b(12)\n    {\n\n    }\n\npublic:\n    virtual int add(int k)\n    {\n        return b + k;\n    }\n\n    virtual int sub(int k)\n    {\n        return b - k;\n    }\n\nprivate:\n    int b;\n};\n```\n\nC\n{% asset_img vftables.png  %}\n\n`TestDerive``TestBase``this``vftable``vftable``DWORD``TestDerive``add``DWORD``TestDerive``sub`\n\nCT\n```c\n#include <stdio.h>\n#include <stdlib.h>\n\ntypedef struct tagTestBase\n{\n    void** pVftable;\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nvoid** g_pBaseVftable = 0; // base\nvoid** g_pDeriveVftable = 0; // derive\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->pVftable = g_pBaseVftable; //\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(&pThis->base);\n    pThis->base.pVftable = g_pDeriveVftable; //\n    pThis->b = 12;\n}\n\n// \nint CallVirtualAdd_int(TestBase* pThis, int m)\n{\n    typedef int (*FuncType)(TestBase*, int);\n    FuncType func = (FuncType)pThis->pVftable[0];\n    return func(pThis, m);\n}\n\n// \nint CallVirtualSub_int(TestBase* pThis, int m)\n{\n    typedef int (*FuncType)(TestBase*, int);\n    FuncType func = (FuncType)pThis->pVftable[1];\n    return func(pThis, m);\n}\n\nint TestBaseVirtualAdd_int(TestBase* pThis, int m)\n{\n    return pThis->a + m;\n}\n\nint TestBaseVirtualSub_int(TestBase* pThis, int m)\n{\n    return pThis->a - m;\n}\n\nint TestDeriveVirtualAdd_int(TestDerive* pThis, int m)\n{\n    return pThis->b + m;\n}\n\nint TestDeriveVirtualSub_int(TestDerive* pThis, int m)\n{\n    return pThis->b - m;\n}\n\nvoid InitVftables()\n{\n    // Base\n    g_pBaseVftable = (void**)malloc(sizeof(void*) * 2);\n    g_pBaseVftable[0] = (void*)&TestBaseVirtualAdd_int;\n    g_pBaseVftable[1] = (void*)&TestBaseVirtualSub_int;\n\n    // Derive\n    g_pDeriveVftable = (void**)malloc(sizeof(void*) * 2);\n    g_pDeriveVftable[0] = (void*)TestDeriveVirtualAdd_int;\n    g_pDeriveVftable[1] = (void*)TestDeriveVirtualSub_int;\n}\n\nvoid UninitVftables()\n{\n    free(g_pBaseVftable);\n    free(g_pDeriveVftable);\n}\n\nint main_core(int argc, char** argv)\n{\n    TestDerive d;\n    TestDeriveConstructor(&d);\n    CallVirtualAdd_int((TestBase*)&d, 19);\n\n    return 0;\n}\n\nint main(int argc, char** argv)\n{\n    InitVftables();\n\n    // C\n    // \n    main_core(argc, argv);\n\n    UninitVftables();\n\n    return 0;\n}\n```\n\nC\n\nCncallC\n```c\nstruct tagTestBase;\n\ntypedef int (*AddFuncType)(struct tagTestBase* pThis, int);\ntypedef int (*SubFuncType)(struct tagTestBase* pThis, int);\n\ntypedef struct tagTestBase\n{\n    AddFuncType addFunc;\n    SubFuncType subFunc;\n    int a;\n} TestBase;\n\ntypedef struct tagTestDerive\n{\n    TestBase base;\n    int b;\n} TestDerive;\n\nint TestBaseVirtualAdd_int(TestBase* pThis, int m)\n{\n    return pThis->a + m;\n}\n\nint TestBaseVirtualSub_int(TestBase* pThis, int m)\n{\n    return pThis->a - m;\n}\n\nint TestDeriveVirtualAdd_int(TestDerive* pThis, int m)\n{\n    return pThis->b + m;\n}\n\nint TestDeriveVirtualSub_int(TestDerive* pThis, int m)\n{\n    return pThis->b - m;\n}\n\nvoid TestBaseConstructor(TestBase* pThis)\n{\n    pThis->addFunc = &TestBaseVirtualAdd_int;\n    pThis->subFunc = &TestBaseVirtualSub_int;\n    pThis->a = 10;\n}\n\nvoid TestDeriveConstructor(TestDerive* pThis)\n{\n    TestBaseConstructor(&pThis->base);\n    pThis->base.addFunc = (AddFuncType)&TestDeriveVirtualAdd_int;\n    pThis->base.subFunc = (SubFuncType)&TestDeriveVirtualSub_int;\n    pThis->b = 12;\n}\n\n\nint main_core(int argc, char** argv)\n{\n    TestDerive d;\n    TestDeriveConstructor(&d);\n    d.base.addFunc((TestBase*)&d, 19);\n\n    return 0;\n}\n\nint main(int argc, char** argv)\n{\n    main_core(argc, argv);\n\n    return 0;\n}\n```\n\n\n","slug":"windbg-windbg-extra1","published":1,"updated":"2018-06-25T11:14:49.164Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjivnhtpc001s2gusk70vz3lq","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CCCCC++<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>C<code>class</code><code>struct</code><code>public</code>C<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br></pre></td></tr></table></figure></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive()</span><br><span class=\"line\">        : b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>CcppcCC<code>this</code></p>\n<ol>\n<li><code>ecx</code></li>\n<li><code>call</code></li>\n<li><code>ecx</code><code>ebp-8</code><code>ebp-14h</code></li>\n<li><code>ebp-8</code><code>eax</code></li>\n</ol>\n<p><code>this</code><br></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p><br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a + k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">sub</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a - k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive()</span><br><span class=\"line\">        : b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b + k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">sub</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b - k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>C<br><img src=\"/2016/05/02/windbg-windbg-extra1/vftables.png\" title=\"\"></p>\n<p><code>TestDerive</code><code>TestBase</code><code>this</code><code>vftable</code><code>vftable</code><code>DWORD</code><code>TestDerive</code><code>add</code><code>DWORD</code><code>TestDerive</code><code>sub</code></p>\n<p>CT<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span>** pVftable;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span>** g_pBaseVftable = <span class=\"number\">0</span>; <span class=\"comment\">// base</span></span><br><span class=\"line\"><span class=\"keyword\">void</span>** g_pDeriveVftable = <span class=\"number\">0</span>; <span class=\"comment\">// derive</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;pVftable = g_pBaseVftable; <span class=\"comment\">//</span></span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(&amp;pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;base.pVftable = g_pDeriveVftable; <span class=\"comment\">//</span></span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CallVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*FuncType)</span><span class=\"params\">(TestBase*, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\">    FuncType func = (FuncType)pThis-&gt;pVftable[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> func(pThis, m);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CallVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*FuncType)</span><span class=\"params\">(TestBase*, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\">    FuncType func = (FuncType)pThis-&gt;pVftable[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> func(pThis, m);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualAdd_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualSub_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">InitVftables</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Base</span></span><br><span class=\"line\">    g_pBaseVftable = (<span class=\"keyword\">void</span>**)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">void</span>*) * <span class=\"number\">2</span>);</span><br><span class=\"line\">    g_pBaseVftable[<span class=\"number\">0</span>] = (<span class=\"keyword\">void</span>*)&amp;TestBaseVirtualAdd_int;</span><br><span class=\"line\">    g_pBaseVftable[<span class=\"number\">1</span>] = (<span class=\"keyword\">void</span>*)&amp;TestBaseVirtualSub_int;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Derive</span></span><br><span class=\"line\">    g_pDeriveVftable = (<span class=\"keyword\">void</span>**)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">void</span>*) * <span class=\"number\">2</span>);</span><br><span class=\"line\">    g_pDeriveVftable[<span class=\"number\">0</span>] = (<span class=\"keyword\">void</span>*)TestDeriveVirtualAdd_int;</span><br><span class=\"line\">    g_pDeriveVftable[<span class=\"number\">1</span>] = (<span class=\"keyword\">void</span>*)TestDeriveVirtualSub_int;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">UninitVftables</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(g_pBaseVftable);</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(g_pDeriveVftable);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main_core</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestDerive d;</span><br><span class=\"line\">    TestDeriveConstructor(&amp;d);</span><br><span class=\"line\">    CallVirtualAdd_int((TestBase*)&amp;d, <span class=\"number\">19</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    InitVftables();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// C</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    main_core(argc, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    UninitVftables();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>C</p>\n<p>CncallC<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*AddFuncType)</span><span class=\"params\">(struct tagTestBase* pThis, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*SubFuncType)</span><span class=\"params\">(struct tagTestBase* pThis, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    AddFuncType addFunc;</span><br><span class=\"line\">    SubFuncType subFunc;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualAdd_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualSub_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;addFunc = &amp;TestBaseVirtualAdd_int;</span><br><span class=\"line\">    pThis-&gt;subFunc = &amp;TestBaseVirtualSub_int;</span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(&amp;pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;base.addFunc = (AddFuncType)&amp;TestDeriveVirtualAdd_int;</span><br><span class=\"line\">    pThis-&gt;base.subFunc = (SubFuncType)&amp;TestDeriveVirtualSub_int;</span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main_core</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestDerive d;</span><br><span class=\"line\">    TestDeriveConstructor(&amp;d);</span><br><span class=\"line\">    d.base.addFunc((TestBase*)&amp;d, <span class=\"number\">19</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    main_core(argc, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CCCCC++<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>C<code>class</code><code>struct</code><code>public</code>C<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br></pre></td></tr></table></figure></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive()</span><br><span class=\"line\">        : b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>CcppcCC<code>this</code></p>\n<ol>\n<li><code>ecx</code></li>\n<li><code>call</code></li>\n<li><code>ecx</code><code>ebp-8</code><code>ebp-14h</code></li>\n<li><code>ebp-8</code><code>eax</code></li>\n</ol>\n<p><code>this</code><br></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p><br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<p>C++<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestBase()</span><br><span class=\"line\">        : a(<span class=\"number\">10</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a + k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">sub</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a - k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDerive</span> :</span> <span class=\"keyword\">public</span> TestBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    TestDerive()</span><br><span class=\"line\">        : b(<span class=\"number\">12</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b + k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">sub</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b - k;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>C<br><img src=\"/2016/05/02/windbg-windbg-extra1/vftables.png\" title=\"\"></p>\n<p><code>TestDerive</code><code>TestBase</code><code>this</code><code>vftable</code><code>vftable</code><code>DWORD</code><code>TestDerive</code><code>add</code><code>DWORD</code><code>TestDerive</code><code>sub</code></p>\n<p>CT<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span>** pVftable;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span>** g_pBaseVftable = <span class=\"number\">0</span>; <span class=\"comment\">// base</span></span><br><span class=\"line\"><span class=\"keyword\">void</span>** g_pDeriveVftable = <span class=\"number\">0</span>; <span class=\"comment\">// derive</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;pVftable = g_pBaseVftable; <span class=\"comment\">//</span></span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(&amp;pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;base.pVftable = g_pDeriveVftable; <span class=\"comment\">//</span></span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CallVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*FuncType)</span><span class=\"params\">(TestBase*, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\">    FuncType func = (FuncType)pThis-&gt;pVftable[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> func(pThis, m);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CallVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*FuncType)</span><span class=\"params\">(TestBase*, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\">    FuncType func = (FuncType)pThis-&gt;pVftable[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> func(pThis, m);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualAdd_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualSub_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">InitVftables</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Base</span></span><br><span class=\"line\">    g_pBaseVftable = (<span class=\"keyword\">void</span>**)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">void</span>*) * <span class=\"number\">2</span>);</span><br><span class=\"line\">    g_pBaseVftable[<span class=\"number\">0</span>] = (<span class=\"keyword\">void</span>*)&amp;TestBaseVirtualAdd_int;</span><br><span class=\"line\">    g_pBaseVftable[<span class=\"number\">1</span>] = (<span class=\"keyword\">void</span>*)&amp;TestBaseVirtualSub_int;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Derive</span></span><br><span class=\"line\">    g_pDeriveVftable = (<span class=\"keyword\">void</span>**)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">void</span>*) * <span class=\"number\">2</span>);</span><br><span class=\"line\">    g_pDeriveVftable[<span class=\"number\">0</span>] = (<span class=\"keyword\">void</span>*)TestDeriveVirtualAdd_int;</span><br><span class=\"line\">    g_pDeriveVftable[<span class=\"number\">1</span>] = (<span class=\"keyword\">void</span>*)TestDeriveVirtualSub_int;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">UninitVftables</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(g_pBaseVftable);</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(g_pDeriveVftable);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main_core</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestDerive d;</span><br><span class=\"line\">    TestDeriveConstructor(&amp;d);</span><br><span class=\"line\">    CallVirtualAdd_int((TestBase*)&amp;d, <span class=\"number\">19</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    InitVftables();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// C</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    main_core(argc, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    UninitVftables();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>C</p>\n<p>CncallC<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*AddFuncType)</span><span class=\"params\">(struct tagTestBase* pThis, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">int</span> <span class=\"params\">(*SubFuncType)</span><span class=\"params\">(struct tagTestBase* pThis, <span class=\"keyword\">int</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestBase</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    AddFuncType addFunc;</span><br><span class=\"line\">    SubFuncType subFunc;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a;</span><br><span class=\"line\">&#125; TestBase;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">tagTestDerive</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    TestBase base;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b;</span><br><span class=\"line\">&#125; TestDerive;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualAdd_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestBaseVirtualSub_int</span><span class=\"params\">(TestBase* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;a - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualAdd_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b + m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">TestDeriveVirtualSub_int</span><span class=\"params\">(TestDerive* pThis, <span class=\"keyword\">int</span> m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pThis-&gt;b - m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestBaseConstructor</span><span class=\"params\">(TestBase* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    pThis-&gt;addFunc = &amp;TestBaseVirtualAdd_int;</span><br><span class=\"line\">    pThis-&gt;subFunc = &amp;TestBaseVirtualSub_int;</span><br><span class=\"line\">    pThis-&gt;a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">TestDeriveConstructor</span><span class=\"params\">(TestDerive* pThis)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestBaseConstructor(&amp;pThis-&gt;base);</span><br><span class=\"line\">    pThis-&gt;base.addFunc = (AddFuncType)&amp;TestDeriveVirtualAdd_int;</span><br><span class=\"line\">    pThis-&gt;base.subFunc = (SubFuncType)&amp;TestDeriveVirtualSub_int;</span><br><span class=\"line\">    pThis-&gt;b = <span class=\"number\">12</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main_core</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    TestDerive d;</span><br><span class=\"line\">    TestDeriveConstructor(&amp;d);</span><br><span class=\"line\">    d.base.addFunc((TestBase*)&amp;d, <span class=\"number\">19</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    main_core(argc, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p></p>"}],"PostAsset":[{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/getrepositoryaddress.png","slug":"getrepositoryaddress.png","post":"cjivnhtn200032gusk1yg1mmp","modified":1,"renderable":0},{"_id":"source/_posts/inject/2016-07-14-remote-inject/explorer_kernel32_address.jpg","slug":"explorer_kernel32_address.jpg","post":"cjivnhtmy00022gus2eqqovmz","modified":1,"renderable":0},{"_id":"source/_posts/windbg/windbg-chapter1/breakpoint.png","slug":"breakpoint.png","post":"cjivnhtnc00082guslinn7z4f","modified":1,"renderable":0},{"_id":"source/_posts/windbg/windbg-chapter1/sourcemode.png","slug":"sourcemode.png","post":"cjivnhtnc00082guslinn7z4f","modified":1,"renderable":0},{"_id":"source/_posts/windbg/windbg-chapter3/ThePlaceWhereCallMain.png","slug":"ThePlaceWhereCallMain.png","post":"cjivnhtne000b2gusea2baouz","modified":1,"renderable":0},{"_id":"source/_posts/inject/2016-07-14-remote-inject/devenv_kernel32_address.jpg","slug":"devenv_kernel32_address.jpg","post":"cjivnhtmy00022gus2eqqovmz","modified":1,"renderable":0},{"_id":"source/_posts/inject/2016-07-14-remote-inject/inject_result.jpg","post":"cjivnhtmy00022gus2eqqovmz","slug":"inject_result.jpg","modified":1,"renderable":1},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/generatesshkey.png","post":"cjivnhtn200032gusk1yg1mmp","slug":"generatesshkey.png","modified":1,"renderable":1},{"_id":"source/_posts/hexo/2016-06-20-build-blog-with-hexo/newrepository.png","post":"cjivnhtn200032gusk1yg1mmp","slug":"newrepository.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/AfterCallTestReturn.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"AfterCallTestReturn.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/AfterCallTestReturnStack.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"AfterCallTestReturnStack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/AfterTestReturnReturn.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"AfterTestReturnReturn.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/BeforeCallTestReturn.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"BeforeCallTestReturn.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/BeforeCallTestReturnStack.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"BeforeCallTestReturnStack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestConstReference.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"CallTestConstReference.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestPointer.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"CallTestPointer.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestReference.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"CallTestReference.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/CallTestValue.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"CallTestValue.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/InitSimple.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"InitSimple.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/SimpleStructMemory.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"SimpleStructMemory.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/TestReturnAssembly.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"TestReturnAssembly.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/begin.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"begin.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/ddebp-14hL4.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"ddebp-14hL4.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/ddebp-2ChL4.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"ddebp-2ChL4.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter2/dtHelloWorld2005Simple.png","post":"cjivnhtnh000c2gus6uvwuw1m","slug":"dtHelloWorld2005Simple.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/aftera10.png","post":"cjivnhtnc00082guslinn7z4f","slug":"aftera10.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/afterda30.png","post":"cjivnhtnc00082guslinn7z4f","slug":"afterda30.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/afterrepstos.png","post":"cjivnhtnc00082guslinn7z4f","slug":"afterrepstos.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/afterrepstosmem.png","post":"cjivnhtnc00082guslinn7z4f","slug":"afterrepstosmem.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/callstack.png","post":"cjivnhtnc00082guslinn7z4f","slug":"callstack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/callstackstatus.png","post":"cjivnhtnc00082guslinn7z4f","slug":"callstackstatus.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/checkesp.png","post":"cjivnhtnc00082guslinn7z4f","slug":"checkesp.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/disassembly.png","post":"cjivnhtnc00082guslinn7z4f","slug":"disassembly.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/pushebp.png","post":"cjivnhtnc00082guslinn7z4f","slug":"pushebp.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/pushebxesiedi.png","post":"cjivnhtnc00082guslinn7z4f","slug":"pushebxesiedi.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/pushresult.png","post":"cjivnhtnc00082guslinn7z4f","slug":"pushresult.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/registers.png","post":"cjivnhtnc00082guslinn7z4f","slug":"registers.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/runexe.png","post":"cjivnhtnc00082guslinn7z4f","slug":"runexe.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/stackmemory.png","post":"cjivnhtnc00082guslinn7z4f","slug":"stackmemory.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter1/testfuncsource.png","post":"cjivnhtnc00082guslinn7z4f","slug":"testfuncsource.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/ActualValueForCmp.png","post":"cjivnhtne000b2gusea2baouz","slug":"ActualValueForCmp.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/AfterCmpOperation.png","post":"cjivnhtne000b2gusea2baouz","slug":"AfterCmpOperation.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/AllRegisters.png","post":"cjivnhtne000b2gusea2baouz","slug":"AllRegisters.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/CmpResult.png","post":"cjivnhtne000b2gusea2baouz","slug":"CmpResult.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/DtSimpleClass.png","post":"cjivnhtne000b2gusea2baouz","slug":"DtSimpleClass.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/DumpHelloWorldHeaders.png","post":"cjivnhtne000b2gusea2baouz","slug":"DumpHelloWorldHeaders.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/DynamicInitializerForK.png","post":"cjivnhtne000b2gusea2baouz","slug":"DynamicInitializerForK.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/GlobalVarCallStack.png","post":"cjivnhtne000b2gusea2baouz","slug":"GlobalVarCallStack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/HelloWorld2005PreCppInit.png","post":"cjivnhtne000b2gusea2baouz","slug":"HelloWorld2005PreCppInit.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/HitConstructorBreakPoint.png","post":"cjivnhtne000b2gusea2baouz","slug":"HitConstructorBreakPoint.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/InInitTermFunction.png","post":"cjivnhtne000b2gusea2baouz","slug":"InInitTermFunction.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/InitTermJmpBackToFuncHead.png","post":"cjivnhtne000b2gusea2baouz","slug":"InitTermJmpBackToFuncHead.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/MainCallTestStatic.png","post":"cjivnhtne000b2gusea2baouz","slug":"MainCallTestStatic.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/MainCallTestVirtual.png","post":"cjivnhtne000b2gusea2baouz","slug":"MainCallTestVirtual.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/MainCompareTestAndTestConst.png","post":"cjivnhtne000b2gusea2baouz","slug":"MainCompareTestAndTestConst.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/MainSimpleClassJ=233.png","post":"cjivnhtne000b2gusea2baouz","slug":"MainSimpleClassJ=233.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/MainSimpleClassJ=233Stack.png","post":"cjivnhtne000b2gusea2baouz","slug":"MainSimpleClassJ=233Stack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/PreCppInitDtValueResult.png","post":"cjivnhtne000b2gusea2baouz","slug":"PreCppInitDtValueResult.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/PreCppInitDvResult.png","post":"cjivnhtne000b2gusea2baouz","slug":"PreCppInitDvResult.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/SetConstructorBreakPoint.png","post":"cjivnhtne000b2gusea2baouz","slug":"SetConstructorBreakPoint.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassConstructorCode.png","post":"cjivnhtne000b2gusea2baouz","slug":"SimpleClassConstructorCode.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassCopyConstructorCode.png","post":"cjivnhtne000b2gusea2baouz","slug":"SimpleClassCopyConstructorCode.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassMemoryMap.png","post":"cjivnhtne000b2gusea2baouz","slug":"SimpleClassMemoryMap.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/SimpleClassThisPointToMemory.png","post":"cjivnhtne000b2gusea2baouz","slug":"SimpleClassThisPointToMemory.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/TestDeriveCtorBeforeBaseCtorStackMemory.png","post":"cjivnhtne000b2gusea2baouz","slug":"TestDeriveCtorBeforeBaseCtorStackMemory.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/da0040412c.png","post":"cjivnhtne000b2gusea2baouz","slug":"da0040412c.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/dd00406000.png","post":"cjivnhtne000b2gusea2baouz","slug":"dd00406000.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/lmvmHelloWorld2005.png","post":"cjivnhtne000b2gusea2baouz","slug":"lmvmHelloWorld2005.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter3/s-saHelloWorld2005+4000L115C.png","post":"cjivnhtne000b2gusea2baouz","slug":"s-saHelloWorld2005+4000L115C.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-extra1/vftables.png","post":"cjivnhtpc001s2gusk70vz3lq","slug":"vftables.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/VirtualFunc1Code.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"VirtualFunc1Code.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/beforedconstructorstack.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"beforedconstructorstack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/contentofecx.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"contentofecx.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/contentofobjectd.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"contentofobjectd.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/firststep.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"firststep.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/inderiveconstructor.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"inderiveconstructor.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/inderiveconstructorstack.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"inderiveconstructorstack.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/jumpoversupercall.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"jumpoversupercall.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/linkoptions.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"linkoptions.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/superconstructor.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"superconstructor.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/vbtablecontent.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"vbtablecontent.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter5/vsoptions.png","post":"cjivnhtpa001q2gusrrjdberd","slug":"vsoptions.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/AssignMemberFuncPointer.png","post":"cjivnhtp8001p2gusswucmssz","slug":"AssignMemberFuncPointer.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/FirstClassVariable.png","post":"cjivnhtp8001p2gusswucmssz","slug":"FirstClassVariable.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/NormalFunc1Addresses.png","post":"cjivnhtp8001p2gusswucmssz","slug":"NormalFunc1Addresses.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseConstructor.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseConstructor.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseContentOfVirtualTable.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseContentOfVirtualTable.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseInitSequence.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseInitSequence.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseLookupThis.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseLookupThis.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVcall0.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseVcall0.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVirtualFunc2Function.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseVirtualFunc2Function.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestBaseVirtualFunctionsAddress.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestBaseVirtualFunctionsAddress.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveAfterAssignVftable.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestDeriveAfterAssignVftable.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveConstructor.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestDeriveConstructor.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveVirtualFunctionAddress.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestDeriveVirtualFunctionAddress.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/TestDeriveVtableContent.png","post":"cjivnhtp8001p2gusswucmssz","slug":"TestDeriveVtableContent.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/dtTestBase.png","post":"cjivnhtp8001p2gusswucmssz","slug":"dtTestBase.png","modified":1,"renderable":1},{"_id":"source/_posts/windbg/windbg-chapter4/dtTestDerive.png","post":"cjivnhtp8001p2gusswucmssz","slug":"dtTestDerive.png","modified":1,"renderable":1}],"PostCategory":[{"post_id":"cjivnhtmy00022gus2eqqovmz","category_id":"cjivnhtn400042guswa4m4mh6","_id":"cjivnhtni000d2guspvc2jea8"},{"post_id":"cjivnhtn200032gusk1yg1mmp","category_id":"cjivnhtnd00092gus234jbe21","_id":"cjivnhtno000g2guspnfbnm7v"},{"post_id":"cjivnhtn600062gusm3dao6ax","category_id":"cjivnhtni000e2gusz775x9pl","_id":"cjivnhtnw000m2gusdloawcdy"},{"post_id":"cjivnhtn800072gustgla2oc0","category_id":"cjivnhtni000e2gusz775x9pl","_id":"cjivnhtny000p2gusda6hfuxr"},{"post_id":"cjivnhtnc00082guslinn7z4f","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhtnz000u2gus1emmpvid"},{"post_id":"cjivnhtne000b2gusea2baouz","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhto0000x2gusgnh9df0w"},{"post_id":"cjivnhtnh000c2gus6uvwuw1m","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhto1000z2gusuotvxd7m"},{"post_id":"cjivnhtp8001p2gusswucmssz","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhtpe001u2gus988qtafy"},{"post_id":"cjivnhtpa001q2gusrrjdberd","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhtpf001x2gus4m62abrc"},{"post_id":"cjivnhtpc001s2gusk70vz3lq","category_id":"cjivnhtnw000l2gusevcup6jm","_id":"cjivnhtpf001z2gus8j0sekbq"}],"PostTag":[{"post_id":"cjivnhtmy00022gus2eqqovmz","tag_id":"cjivnhtn500052gustk9y56z2","_id":"cjivnhtns000j2gusv2269dt6"},{"post_id":"cjivnhtmy00022gus2eqqovmz","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhtnu000k2gusoqt7nm47"},{"post_id":"cjivnhtmy00022gus2eqqovmz","tag_id":"cjivnhtnj000f2gusmgqft8au","_id":"cjivnhtnx000o2gus4c6rcps5"},{"post_id":"cjivnhtn200032gusk1yg1mmp","tag_id":"cjivnhtnq000i2gus8cmavjhd","_id":"cjivnhtnz000s2gus3mtzamco"},{"post_id":"cjivnhtn200032gusk1yg1mmp","tag_id":"cjivnhtnw000n2gus8807dc3l","_id":"cjivnhto0000v2gushmcerdhb"},{"post_id":"cjivnhtn600062gusm3dao6ax","tag_id":"cjivnhtny000r2gusr52xk6w1","_id":"cjivnhto200112gus1q5db3n1"},{"post_id":"cjivnhtn600062gusm3dao6ax","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhto200122gusmmcy6o0f"},{"post_id":"cjivnhtn600062gusm3dao6ax","tag_id":"cjivnhto1000y2gusqhn0o3lz","_id":"cjivnhto200142gusvel128ql"},{"post_id":"cjivnhtn800072gustgla2oc0","tag_id":"cjivnhtny000r2gusr52xk6w1","_id":"cjivnhto300172guslui0bsjy"},{"post_id":"cjivnhtn800072gustgla2oc0","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhto300182gusukcp3rz8"},{"post_id":"cjivnhtn800072gustgla2oc0","tag_id":"cjivnhto1000y2gusqhn0o3lz","_id":"cjivnhto4001a2gus9m601nwq"},{"post_id":"cjivnhtnc00082guslinn7z4f","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhto5001d2gus7dbh7t8b"},{"post_id":"cjivnhtnc00082guslinn7z4f","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhto5001e2gussrlzsllw"},{"post_id":"cjivnhtnc00082guslinn7z4f","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhto5001g2gush92swa36"},{"post_id":"cjivnhtne000b2gusea2baouz","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhto6001i2gusy9zzmpbd"},{"post_id":"cjivnhtne000b2gusea2baouz","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhto6001j2gusppos5rhn"},{"post_id":"cjivnhtne000b2gusea2baouz","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhto7001l2gusb7djsg3d"},{"post_id":"cjivnhtnh000c2gus6uvwuw1m","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhto7001m2gus2p27ve2t"},{"post_id":"cjivnhtnh000c2gus6uvwuw1m","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhto7001n2gus03rypzgn"},{"post_id":"cjivnhtnh000c2gus6uvwuw1m","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhto7001o2gussxi37noz"},{"post_id":"cjivnhtp8001p2gusswucmssz","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhtpb001r2guso7sg9vf8"},{"post_id":"cjivnhtp8001p2gusswucmssz","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhtpd001t2gus11opy1b2"},{"post_id":"cjivnhtp8001p2gusswucmssz","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhtpe001w2gusao8wdkfb"},{"post_id":"cjivnhtpa001q2gusrrjdberd","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhtpf001y2gus67myw9ua"},{"post_id":"cjivnhtpa001q2gusrrjdberd","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhtpf00202guszv899qq1"},{"post_id":"cjivnhtpa001q2gusrrjdberd","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhtpg00212gusn67ujh0z"},{"post_id":"cjivnhtpc001s2gusk70vz3lq","tag_id":"cjivnhto300162gushg5hfi6u","_id":"cjivnhtpg00222gussmc9p4ck"},{"post_id":"cjivnhtpc001s2gusk70vz3lq","tag_id":"cjivnhto300192gusbvyzmc1o","_id":"cjivnhtpg00232gusih4p9coi"},{"post_id":"cjivnhtpc001s2gusk70vz3lq","tag_id":"cjivnhtnd000a2gushpmjcbvl","_id":"cjivnhtph00242gus2iznjycg"},{"post_id":"cjivnhtpc001s2gusk70vz3lq","tag_id":"cjivnhtpe001v2gusy5r06ta5","_id":"cjivnhtph00252gus0m4k0zaw"}],"Tag":[{"name":"windows","_id":"cjivnhtn500052gustk9y56z2"},{"name":"c++","_id":"cjivnhtnd000a2gushpmjcbvl"},{"name":"inject","_id":"cjivnhtnj000f2gusmgqft8au"},{"name":"blog","_id":"cjivnhtnq000i2gus8cmavjhd"},{"name":"hexo","_id":"cjivnhtnw000n2gus8807dc3l"},{"name":"algorithm","_id":"cjivnhtny000r2gusr52xk6w1"},{"name":"leetcode","_id":"cjivnhto1000y2gusqhn0o3lz"},{"name":"windbg","_id":"cjivnhto300162gushg5hfi6u"},{"name":"disassembly","_id":"cjivnhto300192gusbvyzmc1o"},{"name":"c","_id":"cjivnhtpe001v2gusy5r06ta5"}]}}